<!DOCTYPE html>
<html lang="en"><head>
<script src="index_files/libs/clipboard/clipboard.min.js"></script>
<script src="index_files/libs/quarto-html/tabby.min.js"></script>
<script src="index_files/libs/quarto-html/popper.min.js"></script>
<script src="index_files/libs/quarto-html/tippy.umd.min.js"></script>
<link href="index_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="index_files/libs/quarto-html/light-border.css" rel="stylesheet">
<link href="index_files/libs/quarto-html/quarto-html.min.css" rel="stylesheet" data-mode="light">
<link href="index_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles"><meta charset="utf-8">
  <meta name="generator" content="quarto-1.3.450">

  <meta name="dcterms.date" content="2024-05-07">
  <title>NeuronalModelling.jl</title>
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">
  <link rel="stylesheet" href="index_files/libs/revealjs/dist/reset.css">
  <link rel="stylesheet" href="index_files/libs/revealjs/dist/reveal.css">
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      width: 0.8em;
      margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
      vertical-align: middle;
    }
    /* CSS for syntax highlighting */
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      { color: #003b4f; background-color: #f1f3f5; }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span { color: #003b4f; } /* Normal */
    code span.al { color: #ad0000; } /* Alert */
    code span.an { color: #5e5e5e; } /* Annotation */
    code span.at { color: #657422; } /* Attribute */
    code span.bn { color: #ad0000; } /* BaseN */
    code span.bu { } /* BuiltIn */
    code span.cf { color: #003b4f; } /* ControlFlow */
    code span.ch { color: #20794d; } /* Char */
    code span.cn { color: #8f5902; } /* Constant */
    code span.co { color: #5e5e5e; } /* Comment */
    code span.cv { color: #5e5e5e; font-style: italic; } /* CommentVar */
    code span.do { color: #5e5e5e; font-style: italic; } /* Documentation */
    code span.dt { color: #ad0000; } /* DataType */
    code span.dv { color: #ad0000; } /* DecVal */
    code span.er { color: #ad0000; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #ad0000; } /* Float */
    code span.fu { color: #4758ab; } /* Function */
    code span.im { color: #00769e; } /* Import */
    code span.in { color: #5e5e5e; } /* Information */
    code span.kw { color: #003b4f; } /* Keyword */
    code span.op { color: #5e5e5e; } /* Operator */
    code span.ot { color: #003b4f; } /* Other */
    code span.pp { color: #ad0000; } /* Preprocessor */
    code span.sc { color: #5e5e5e; } /* SpecialChar */
    code span.ss { color: #20794d; } /* SpecialString */
    code span.st { color: #20794d; } /* String */
    code span.va { color: #111111; } /* Variable */
    code span.vs { color: #20794d; } /* VerbatimString */
    code span.wa { color: #5e5e5e; font-style: italic; } /* Warning */
  </style>
  <link rel="stylesheet" href="index_files/libs/revealjs/dist/theme/quarto.css">
  <link rel="stylesheet" href="styles.css">
  <link href="index_files/libs/revealjs/plugin/quarto-line-highlight/line-highlight.css" rel="stylesheet">
  <link href="index_files/libs/revealjs/plugin/reveal-menu/menu.css" rel="stylesheet">
  <link href="index_files/libs/revealjs/plugin/reveal-menu/quarto-menu.css" rel="stylesheet">
  <link href="index_files/libs/revealjs/plugin/reveal-chalkboard/font-awesome/css/all.css" rel="stylesheet">
  <link href="index_files/libs/revealjs/plugin/reveal-chalkboard/style.css" rel="stylesheet">
  <link href="index_files/libs/revealjs/plugin/quarto-support/footer.css" rel="stylesheet">
  <style type="text/css">

  .callout {
    margin-top: 1em;
    margin-bottom: 1em;  
    border-radius: .25rem;
  }

  .callout.callout-style-simple { 
    padding: 0em 0.5em;
    border-left: solid #acacac .3rem;
    border-right: solid 1px silver;
    border-top: solid 1px silver;
    border-bottom: solid 1px silver;
    display: flex;
  }

  .callout.callout-style-default {
    border-left: solid #acacac .3rem;
    border-right: solid 1px silver;
    border-top: solid 1px silver;
    border-bottom: solid 1px silver;
  }

  .callout .callout-body-container {
    flex-grow: 1;
  }

  .callout.callout-style-simple .callout-body {
    font-size: 1rem;
    font-weight: 400;
  }

  .callout.callout-style-default .callout-body {
    font-size: 0.9rem;
    font-weight: 400;
  }

  .callout.callout-titled.callout-style-simple .callout-body {
    margin-top: 0.2em;
  }

  .callout:not(.callout-titled) .callout-body {
      display: flex;
  }

  .callout:not(.no-icon).callout-titled.callout-style-simple .callout-content {
    padding-left: 1.6em;
  }

  .callout.callout-titled .callout-header {
    padding-top: 0.2em;
    margin-bottom: -0.2em;
  }

  .callout.callout-titled .callout-title  p {
    margin-top: 0.5em;
    margin-bottom: 0.5em;
  }
    
  .callout.callout-titled.callout-style-simple .callout-content  p {
    margin-top: 0;
  }

  .callout.callout-titled.callout-style-default .callout-content  p {
    margin-top: 0.7em;
  }

  .callout.callout-style-simple div.callout-title {
    border-bottom: none;
    font-size: .9rem;
    font-weight: 600;
    opacity: 75%;
  }

  .callout.callout-style-default  div.callout-title {
    border-bottom: none;
    font-weight: 600;
    opacity: 85%;
    font-size: 0.9rem;
    padding-left: 0.5em;
    padding-right: 0.5em;
  }

  .callout.callout-style-default div.callout-content {
    padding-left: 0.5em;
    padding-right: 0.5em;
  }

  .callout.callout-style-simple .callout-icon::before {
    height: 1rem;
    width: 1rem;
    display: inline-block;
    content: "";
    background-repeat: no-repeat;
    background-size: 1rem 1rem;
  }

  .callout.callout-style-default .callout-icon::before {
    height: 0.9rem;
    width: 0.9rem;
    display: inline-block;
    content: "";
    background-repeat: no-repeat;
    background-size: 0.9rem 0.9rem;
  }

  .callout-title {
    display: flex
  }
    
  .callout-icon::before {
    margin-top: 1rem;
    padding-right: .5rem;
  }

  .callout.no-icon::before {
    display: none !important;
  }

  .callout.callout-titled .callout-body > .callout-content > :last-child {
    margin-bottom: 0.5rem;
  }

  .callout.callout-titled .callout-icon::before {
    margin-top: .5rem;
    padding-right: .5rem;
  }

  .callout:not(.callout-titled) .callout-icon::before {
    margin-top: 1rem;
    padding-right: .5rem;
  }

  /* Callout Types */

  div.callout-note {
    border-left-color: #4582ec !important;
  }

  div.callout-note .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAAEU0lEQVRYCcVXTWhcVRQ+586kSUMMxkyaElstCto2SIhitS5Ek8xUKV2poatCcVHtUlFQk8mbaaziwpWgglJwVaquitBOfhQXFlqlzSJpFSpIYyXNjBNiTCck7x2/8/LeNDOZxDuEkgOXe++553zfefee+/OYLOXFk3+1LLrRdiO81yNqZ6K9cG0P3MeFaMIQjXssE8Z1JzLO9ls20MBZX7oG8w9GxB0goaPrW5aNMp1yOZIa7Wv6o2ykpLtmAPs/vrG14Z+6d4jpbSKuhdcSyq9wGMPXjonwmESXrriLzFGOdDBLB8Y6MNYBu0dRokSygMA/mrun8MGFN3behm6VVAwg4WR3i6FvYK1T7MHo9BK7ydH+1uurECoouk5MPRyVSBrBHMYwVobG2aOXM07sWrn5qgB60rc6mcwIDJtQrnrEr44kmy+UO9r0u9O5/YbkS9juQckLed3DyW2XV/qWBBB3ptvI8EUY3I9p/67OW+g967TNr3Sotn3IuVlfMLVnsBwH4fsnebJvyGm5GeIUA3jljERmrv49SizPYuq+z7c2H/jlGC+Ghhupn/hcapqmcudB9jwJ/3jvnvu6vu5lVzF1fXyZuZZ7U8nRmVzytvT+H3kilYvH09mLWrQdwFSsFEsxFVs5fK7A0g8gMZjbif4ACpKbjv7gNGaD8bUrlk8x+KRflttr22JEMRUbTUwwDQScyzPgedQHZT0xnx7ujw2jfVfExwYHwOsDTjLdJ2ebmeQIlJ7neo41s/DrsL3kl+W2lWvAga0tR3zueGr6GL78M3ifH0rGXrBC2aAR8uYcIA5gwV8zIE8onoh8u0Fca/ciF7j1uOzEnqcIm59sEXoGc0+z6+H45V1CvAvHcD7THztu669cnp+L0okAeIc6zjbM/24LgGM1gZk7jnRu1aQWoU9sfUOuhrmtaPIO3YY1KLLWZaEO5TKUbMY5zx8W9UJ6elpLwKXbsaZ4EFl7B4bMtDv0iRipKoDQT2sNQI9b1utXFdYisi+wzZ/ri/1m7QfDgEuvgUUEIJPq3DhX/5DWNqIXDOweC2wvIR90Oq3lDpdMIgD2r0dXvGdsEW5H6x6HLRJYU7C69VefO1x8Gde1ZFSJLfWS1jbCnhtOPxmpfv2LXOA2Xk2tvnwKKPFuZ/oRmwBwqRQDcKNeVQkYcOjtWVBuM/JuYw5b6isojIkYxyYAFn5K7ZBF10fea52y8QltAg6jnMqNHFBmGkQ1j+U43HMi2xMar1Nv0zGsf1s8nUsmUtPOOrbFIR8bHFDMB5zL13Gmr/kGlCkUzedTzzmzsaJXhYawnA3UmARpiYj5ooJZiUoxFRtK3X6pgNPv+IZVPcnwbOl6f+aBaO1CNvPW9n9LmCp01nuSaTRF2YxHqZ8DYQT6WsXT+RD6eUztwYLZ8rM+rcPxamv1VQzFUkzFXvkiVrySGQgJNvXHJAxiU3/NwiC03rSf05VBaPtu/Z7/B8Yn/w7eguloAAAAAElFTkSuQmCC');
  }

  div.callout-note.callout-style-default .callout-title {
    background-color: #dae6fb
  }

  div.callout-important {
    border-left-color: #d9534f !important;
  }

  div.callout-important .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAAEKklEQVRYCcVXTWhcVRS+575MJym48A+hSRFr00ySRQhURRfd2HYjk2SSTokuBCkU2o0LoSKKraKIBTcuFCoidGFD08nkBzdREbpQ1EDNIv8qSGMFUboImMSZd4/f9zJv8ibJMC8xJQfO3HPPPef7zrvvvnvviIkpC9nsw0UttFunbUhpFzFtarSd6WJkStVMw5xyVqYTvkwfzuf/5FgtkVoB0729j1rjXwThS7Vio+Mo6DNnvLfahoZ+i/o32lULuJ3NNiz7q6+pyAUkJaFF6JwaM2lUJlV0MlnQn5aTRbEu0SEqHUa0A4AdiGuB1kFXRfVyg5d87+Dg4DL6m2TLAub60ilj7A1Ec4odSAc8X95sHh7+ZRPCFo6Fnp7HfU/fBng/hi10CjCnWnJjsxvDNxWw0NfV6Rv5GgP3I3jGWXumdTD/3cbEOP2ZbOZp69yniG3FQ9z1jD7bnBu9Fc2tKGC2q+uAJOQHBDRiZX1x36o7fWBs7J9ownbtO+n0/qWkvW7UPIfc37WgT6ZGR++EOJyeQDSb9UB+DZ1G6DdLDzyS+b/kBCYGsYgJbSQHuThGKRcw5xdeQf8YdNHsc6ePXrlSYMBuSIAFTGAtQo+VuALo4BX83N190NWZWbynBjhOHsmNfFWLeL6v+ynsA58zDvvAC8j5PkbOcXCMg2PZFk3q8MjI7WAG/Dp9AwP7jdGBOOQkAvlFUB+irtm16I1Zw9YBcpGTGXYmk3kQIC/Cds55l+iMI3jqhjAuaoe+am2Jw5GT3Nbz3CkE12NavmzN5+erJW7046n/CH1RO/RVa8lBLozXk9uqykkGAyRXLWlLv5jyp4RFsG5vGVzpDLnIjTWgnRy2Rr+tDKvRc7Y8AyZq10jj8DqXdnIRNtFZb+t/ZRtXcDiVnzpqx8mPcDWxgARUqx0W1QB9MeUZiNrV4qP+Ehc+BpNgATsTX8ozYKL2NtFYAHc84fG7ndxUPr+AR/iQSns7uSUufAymwDOb2+NjK27lEFocm/EE2WpyIy/Hi66MWuMKJn8RvxIcj87IM5Vh9663ziW36kR0HNenXuxmfaD8JC7tfKbrhFr7LiZCrMjrzTeGx+PmkosrkNzW94ObzwocJ7A1HokLolY+AvkTiD/q1H0cN48c5EL8Crkttsa/AXQVDmutfyku0E7jShx49XqV3MFK8IryDhYVbj7Sj2P2eBxwcXoe8T8idsKKPRcnZw1b+slFTubwUwhktrfnAt7J++jwQtLZcm3sr9LQrjRzz6cfMv9aLvgmnAGvpoaGLxM4mAEaLV7iAzQ3oU0IvD5x9ix3yF2RAAuYAOO2f7PEFWCXZ4C9Pb2UsgDeVnFSpbFK7/IWu7TPTvBqzbGdCHOJQSxiEjt6IyZmxQyEJHv6xyQsYk//moVFsN2zP6fRImjfq7/n/wFDguUQFNEwugAAAABJRU5ErkJggg==');
  }

  div.callout-important.callout-style-default .callout-title {
    background-color: #f7dddc
  }

  div.callout-warning {
    border-left-color: #f0ad4e !important;
  }

  div.callout-warning .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAAETklEQVRYCeVWW2gcVRg+58yaTUnizqbipZeX4uWhBEniBaoUX1Ioze52t7sRq6APio9V9MEaoWlVsFasRq0gltaAPuxms8lu0gcviE/FFOstVbSIxgcv6SU7EZqmdc7v9+9mJtNks51NTUH84ed889/PP+cmxP+d5FIbMJmNbpREu4WUkiTtCicKny0l1pIKmBzovF2S+hIJHX8iEu3hZJ5lNZGqyRrGSIQpq15AzF28jgpeY6yk6GVdrfFqdrD6Iw+QlB8g0YS2g7dyQmXM/IDhBhT0UCiRf59lfqmmDvzRt6kByV/m4JjtzuaujMUM2c5Z2d6JdKrRb3K2q6mA+oYVz8JnDdKPmmNthzkAk/lN63sYPgevrguc72aZX/L9C6x09GYyxBgCX4NlvyGUHOKELlm5rXeR1kchuChJt4SSwyddZRXgvwMGvYo4QSlk3/zkHD8UHxwVJA6zjZZqP8v8kK8OWLnIZtLyCAJagYC4rTGW/9Pqj92N/c+LUaAj27movwbi19tk/whRCIE7Q9vyI6yvRpftAKVTdUjOW40X3h5OXsKCdmFcx0xlLJoSuQngnrJe7Kcjm4OMq9FlC7CMmScQANuNvjfP3PjGXDBaUQmbp296S5L4DrpbrHN1T87ZVEZVCzg1FF0Ft+dKrlLukI+/c9ENo+TvlTDbYFvuKPtQ9+l052rXrgKoWkDAFnvh0wTOmYn8R5f4k/jN/fZiCM1tQx9jQQ4ANhqG4hiL0qIFTGViG9DKB7GYzgubnpofgYRwO+DFjh0Zin2m4b/97EDkXkc+f6xYAPX0KK2I/7fUQuwzuwo/L3AkcjugPNixC8cHf0FyPjWlItmLxWw4Ou9YsQCr5fijMGoD/zpdRy95HRysyXA74MWOnscpO4j2y3HAVisw85hX5+AFBRSHt4ShfLFkIMXTqyKFc46xdzQM6XbAi702a7sy04J0+feReMFKp5q9esYLCqAZYw/k14E/xcLLsFElaornTuJB0svMuJINy8xkIYuL+xPAlWRceH6+HX7THJ0djLUom46zREu7tTkxwmf/FdOZ/sh6Q8qvEAiHpm4PJ4a/doJe0gH1t+aHRgCzOvBvJedEK5OFE5jpm4AGP2a8Dxe3gGJ/pAutug9Gp6he92CsSsWBaEcxGx0FHytmIpuqGkOpldqNYQK8cSoXvd+xLxXADw0kf6UkJNFtdo5MOgaLjiQOQHcn+A6h5NuL2s0qsC2LOM75PcF3yr5STuBSAcGG+meA14K/CI21HcS4LBT6tv0QAh8Dr5l93AhZzG5ZJ4VxAqdZUEl9z7WJ4aN+svMvwHHL21UKTd1mqvChH7/Za5xzXBBKrUcB0TQ+Ulgkfbi/H/YT5EptrGzsEK7tR1B7ln9BBwckYfMiuSqklSznIuoIIOM42MQO+QnduCoFCI0bpkzjCjddHPN/F+2Yu+sd9bKNpVwHhbS3LluK/0zgfwD0xYI5dXuzlQAAAABJRU5ErkJggg==');
  }

  div.callout-warning.callout-style-default .callout-title {
    background-color: #fcefdc
  }

  div.callout-tip {
    border-left-color: #02b875 !important;
  }

  div.callout-tip .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAADr0lEQVRYCe1XTWgTQRj9ZjZV8a9SPIkKgj8I1bMHsUWrqYLVg4Ue6v9BwZOxSYsIerFao7UiUryIqJcqgtpimhbBXoSCVxUFe9CTiogUrUp2Pt+3aUI2u5vdNh4dmMzOzHvvezuz8xNFM0mjnbXaNu1MvFWRXkXEyE6aYOYJpdW4IXuA4r0fo8qqSMDBU0v1HJUgVieAXxzCsdE/YJTdFcVIZQNMyhruOMJKXYFoLfIfIvVIMWdsrd+Rpd86ZmyzzjJmLStqRn0v8lzkb4rVIXvnpScOJuAn2ACC65FkPzEdEy4TPWRLJ2h7z4cArXzzaOdKlbOvKKX25Wl00jSnrwVxAg3o4dRxhO13RBSdNvH0xSARv3adTXbBdTf64IWO2vH0LT+cv4GR1DJt+DUItaQogeBX/chhbTBxEiZ6gftlDNXTrvT7co4ub5A6gp9HIcHvzTa46OS5fBeP87Qm0fQkr4FsYgVQ7Qg+ZayaDg9jhg1GkWj8RG6lkeSacrrHgDaxdoBiZPg+NXV/KifMuB6//JmYH4CntVEHy/keA6x4h4CU5oFy8GzrBS18cLJMXcljAKB6INjWsRcuZBWVaS3GDrqB7rdapVIeA+isQ57Eev9eCqzqOa81CY05VLd6SamW2wA2H3SiTbnbSxmzfp7WtKZkqy4mdyAlGx7ennghYf8voqp9cLSgKdqNfa6RdRsAAkPwRuJZNbpByn+RrJi1RXTwdi8RQF6ymDwGMAtZ6TVE+4uoKh+MYkcLsT0Hk8eAienbiGdjJHZTpmNjlbFJNKDVAp2fJlYju6IreQxQ08UJDNYdoLSl6AadO+fFuCQqVMB1NJwPm69T04Wv5WhfcWyfXQB+wXRs1pt+nCknRa0LVzSA/2B+a9+zQJadb7IyyV24YAxKp2Jqs3emZTuNnKxsah+uabKbMk7CbTgJx/zIgQYErIeTKRQ9yD9wxVof5YolPHqaWo7TD6tJlh7jQnK5z2n3+fGdggIOx2kaa2YI9QWarc5Ce1ipNWMKeSG4DysFF52KBmTNMmn5HqCFkwy34rDg05gDwgH3bBi+sgFhN/e8QvRn8kbamCOhgrZ9GJhFDgfcMHzFb6BAtjKpFhzTjwv1KCVuxHvCbsSiEz4CANnj84cwHdFXAbAOJ4LTSAawGWFn5tDhLMYz6nWeU2wJfIhmIJBefcd/A5FWQWGgrWzyORZ3Q6HuV+Jf0Bj+BTX69fm1zWgK7By1YTXchFDORywnfQ7GpzOo6S+qECrsx2ifVQAAAABJRU5ErkJggg==');
  }

  div.callout-tip.callout-style-default .callout-title {
    background-color: #ccf1e3
  }

  div.callout-caution {
    border-left-color: #fd7e14 !important;
  }

  div.callout-caution .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAACV0lEQVRYCdVWzWoUQRCuqp2ICBLJXgITZL1EfQDBW/bkzUMUD7klD+ATSHBEfAIfQO+iXsWDxJsHL96EHAwhgzlkg8nBg25XWb0zIb0zs9muYYWkoKeru+vn664fBqElyZNuyh167NXJ8Ut8McjbmEraKHkd7uAnAFku+VWdb3reSmRV8PKSLfZ0Gjn3a6Xlcq9YGb6tADjn+lUfTXtVmaZ1KwBIvFI11rRXlWlatwIAAv2asaa9mlB9wwygiDX26qaw1yYPzFXg2N1GgG0FMF8Oj+VIx7E/03lHx8UhvYyNZLN7BwSPgekXXLribw7w5/c8EF+DBK5idvDVYtEEwMeYefjjLAdEyQ3M9nfOkgnPTEkYU+sxMq0BxNR6jExrAI31H1rzvLEfRIdgcv1XEdj6QTQAS2wtstEALLG1yEZ3QhH6oDX7ExBSFEkFINXH98NTrme5IOaaA7kIfiu2L8A3qhH9zRbukdCqdsA98TdElyeMe5BI8Rs2xHRIsoTSSVFfCFCWGPn9XHb4cdobRIWABNf0add9jakDjQJpJ1bTXOJXnnRXHRf+dNL1ZV1MBRCXhMbaHqGI1JkKIL7+i8uffuP6wVQAzO7+qVEbF6NbS0LJureYcWXUUhH66nLR5rYmva+2tjRFtojkM2aD76HEGAD3tPtKM309FJg5j/K682ywcWJ3PASCcycH/22u+Bh7Aa0ehM2Fu4z0SAE81HF9RkB21c5bEn4Dzw+/qNOyXr3DCTQDMBOdhi4nAgiFDGCinIa2owCEChUwD8qzd03PG+qdW/4fDzjUMcE1ZpIAAAAASUVORK5CYII=');
  }

  div.callout-caution.callout-style-default .callout-title {
    background-color: #ffe5d0
  }

  </style>
  <style type="text/css">
    .reveal div.sourceCode {
      margin: 0;
      overflow: auto;
    }
    .reveal div.hanging-indent {
      margin-left: 1em;
      text-indent: -1em;
    }
    .reveal .slide:not(.center) {
      height: 100%;
    }
    .reveal .slide.scrollable {
      overflow-y: auto;
    }
    .reveal .footnotes {
      height: 100%;
      overflow-y: auto;
    }
    .reveal .slide .absolute {
      position: absolute;
      display: block;
    }
    .reveal .footnotes ol {
      counter-reset: ol;
      list-style-type: none; 
      margin-left: 0;
    }
    .reveal .footnotes ol li:before {
      counter-increment: ol;
      content: counter(ol) ". "; 
    }
    .reveal .footnotes ol li > p:first-child {
      display: inline-block;
    }
    .reveal .slide ul,
    .reveal .slide ol {
      margin-bottom: 0.5em;
    }
    .reveal .slide ul li,
    .reveal .slide ol li {
      margin-top: 0.4em;
      margin-bottom: 0.2em;
    }
    .reveal .slide ul[role="tablist"] li {
      margin-bottom: 0;
    }
    .reveal .slide ul li > *:first-child,
    .reveal .slide ol li > *:first-child {
      margin-block-start: 0;
    }
    .reveal .slide ul li > *:last-child,
    .reveal .slide ol li > *:last-child {
      margin-block-end: 0;
    }
    .reveal .slide .columns:nth-child(3) {
      margin-block-start: 0.8em;
    }
    .reveal blockquote {
      box-shadow: none;
    }
    .reveal .tippy-content>* {
      margin-top: 0.2em;
      margin-bottom: 0.7em;
    }
    .reveal .tippy-content>*:last-child {
      margin-bottom: 0.2em;
    }
    .reveal .slide > img.stretch.quarto-figure-center,
    .reveal .slide > img.r-stretch.quarto-figure-center {
      display: block;
      margin-left: auto;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-left,
    .reveal .slide > img.r-stretch.quarto-figure-left  {
      display: block;
      margin-left: 0;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-right,
    .reveal .slide > img.r-stretch.quarto-figure-right  {
      display: block;
      margin-left: auto;
      margin-right: 0; 
    }
  </style>
</head>
<body class="quarto-light">
  <div class="reveal">
    <div class="slides">

<section id="title-slide" class="quarto-title-block center">
  <h1 class="title">NeuronalModelling.jl</h1>
  <p class="subtitle">Quantitative Single-Neuron Modelling in Julia</p>

<div class="quarto-title-authors">
<div class="quarto-title-author">
<div class="quarto-title-author-name">
<a href="https://github.com/pitmonticone">Pietro Monticone</a> <a href="https://orcid.org/0000-0002-2731-9623" class="quarto-title-author-orcid"> <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA2ZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDo1N0NEMjA4MDI1MjA2ODExOTk0QzkzNTEzRjZEQTg1NyIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDozM0NDOEJGNEZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDozM0NDOEJGM0ZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ1M1IE1hY2ludG9zaCI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkZDN0YxMTc0MDcyMDY4MTE5NUZFRDc5MUM2MUUwNEREIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjU3Q0QyMDgwMjUyMDY4MTE5OTRDOTM1MTNGNkRBODU3Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+84NovQAAAR1JREFUeNpiZEADy85ZJgCpeCB2QJM6AMQLo4yOL0AWZETSqACk1gOxAQN+cAGIA4EGPQBxmJA0nwdpjjQ8xqArmczw5tMHXAaALDgP1QMxAGqzAAPxQACqh4ER6uf5MBlkm0X4EGayMfMw/Pr7Bd2gRBZogMFBrv01hisv5jLsv9nLAPIOMnjy8RDDyYctyAbFM2EJbRQw+aAWw/LzVgx7b+cwCHKqMhjJFCBLOzAR6+lXX84xnHjYyqAo5IUizkRCwIENQQckGSDGY4TVgAPEaraQr2a4/24bSuoExcJCfAEJihXkWDj3ZAKy9EJGaEo8T0QSxkjSwORsCAuDQCD+QILmD1A9kECEZgxDaEZhICIzGcIyEyOl2RkgwAAhkmC+eAm0TAAAAABJRU5ErkJggg=="></a>
</div>
        <p class="quarto-title-affiliation">
            University of Turin
          </p>
    </div>
<div class="quarto-title-author">
<div class="quarto-title-author-name">
<a href="https://github.com/ClaudMor">Claudio Moroni</a> <a href="https://orcid.org/0000-0003-1274-6937" class="quarto-title-author-orcid"> <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA2ZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDo1N0NEMjA4MDI1MjA2ODExOTk0QzkzNTEzRjZEQTg1NyIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDozM0NDOEJGNEZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDozM0NDOEJGM0ZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ1M1IE1hY2ludG9zaCI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkZDN0YxMTc0MDcyMDY4MTE5NUZFRDc5MUM2MUUwNEREIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjU3Q0QyMDgwMjUyMDY4MTE5OTRDOTM1MTNGNkRBODU3Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+84NovQAAAR1JREFUeNpiZEADy85ZJgCpeCB2QJM6AMQLo4yOL0AWZETSqACk1gOxAQN+cAGIA4EGPQBxmJA0nwdpjjQ8xqArmczw5tMHXAaALDgP1QMxAGqzAAPxQACqh4ER6uf5MBlkm0X4EGayMfMw/Pr7Bd2gRBZogMFBrv01hisv5jLsv9nLAPIOMnjy8RDDyYctyAbFM2EJbRQw+aAWw/LzVgx7b+cwCHKqMhjJFCBLOzAR6+lXX84xnHjYyqAo5IUizkRCwIENQQckGSDGY4TVgAPEaraQr2a4/24bSuoExcJCfAEJihXkWDj3ZAKy9EJGaEo8T0QSxkjSwORsCAuDQCD+QILmD1A9kECEZgxDaEZhICIzGcIyEyOl2RkgwAAhkmC+eAm0TAAAAABJRU5ErkJggg=="></a>
</div>
        <p class="quarto-title-affiliation">
            University of Turin
          </p>
    </div>
</div>

  <p class="date">2024-05-07</p>
</section>
<section class="slide level2">

<!-- # :clapper: Introduction 

::: {.notes}
...
:::

--- -->
</section>
<section id="section" class="slide level2 smaller">
<h2></h2>
<h3 id="outline">Outline</h3>
<!-- :one: [Objectives](#Objectives)

:two: [Motivations](#Motivations) -->
<p><span class="emoji" data-emoji="one">1Ô∏è‚É£</span> <a href="#/Introduction">Introduction</a></p>
<p><span class="emoji" data-emoji="two">2Ô∏è‚É£</span> <a href="#/Methods">Methods</a></p>
<p><span class="emoji" data-emoji="three">3Ô∏è‚É£</span> <a href="#/Tools">Tools</a></p>
<p><span class="emoji" data-emoji="four">4Ô∏è‚É£</span> <a href="#/Results">Results</a></p>
<p><br></p>
<h3 id="resources">Resources</h3>
<p><img data-src="images/logo/JuliaDots.svg" class="absolute" style="left: 0px; bottom: 252px; width: 3.2%; "> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Package: <a href="https://github.com/InPhyT/ModellingFramework.jl">ModellingFramework.jl</a></p>
<p><img data-src="images/logo/JuliaDots.svg" class="absolute" style="left: 0px; bottom: 205px; width: 3.2%; "> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Package: <a href="https://github.com/InPhyT/NeuronalModelling.jl">NeuronalModelling.jl</a></p>
<p><img data-src="images/logo/GitHub.svg" class="absolute" style="left: 0px; bottom: 155px; width: 3.2%; "> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Data: <a href="https://github.com/InPhyT/Quantitative_Single_Neuron_Modeling_Competition_2007">Competition (2007)</a></p>
<p><img data-src="images/logo/GitHub.svg" class="absolute" style="left: 0px; bottom: 107px; width: 3.2%; "> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Data: <a href="https://github.com/InPhyT/Quantitative_Single_Neuron_Modeling_Competition_2009">Competition (2009)</a></p>
<p><img data-src="images/logo/GitHub.svg" class="absolute" style="left: 0px; bottom: 59px; width: 3.2%; "> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Data: <a href="https://github.com/AllenInstitute/AllenSDK">Allen Brain Atlas (2023)</a></p>
<p><img data-src="images/logo/NeuronalModelling.svg" class="absolute" style="bottom: 120px; right: 0px; width: 45%; "></p>
<aside class="notes">
<p>‚Ä¶</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
<!-- https://github.com/quarto-dev/quarto-cli/discussions/4572 -->
<style>
.semi-transparent {
  opacity: 0.3;
}
</style>
</section>
<section id="introduction" class="title-slide slide level1 center">
<h1><span class="emoji" data-emoji="clapper">üé¨</span> Introduction</h1>
<ol type="1">
<li>Objectives</li>
<li>Motivations</li>
</ol>
<!-- # :exclamation: Objectives -->
</section>

<section>
<section id="introduction-1" class="title-slide slide level1 smaller center">
<h1><span class="semi-transparent">Introduction</span></h1>
<ol type="1">
<li><p>Objectives</p></li>
<li><p><span class="semi-transparent">Motivations</span></p></li>
</ol>
</section>
<section id="objectives" class="slide level2 smaller">
<h2>Objectives</h2>
<div class="columns">
<div class="column" style="width:40%;">
<h3 id="theory">Theory</h3>
<p>Flexible and high-performance computational framework for the specification, calibration and simulation of single-neuron models.</p>
<h3 id="application">Application</h3>
<p>Electrophysiological time series inference and prediction for individual neurons.</p>
</div><div class="column" style="width:60%;">
<p><img data-src="images/articles/2009Gerstner.png" class="absolute" style="bottom: 90px; right: -180px; width: 80%; "></p>
</div>
</div>

<aside class="notes">
<p>GENERAL / THEORY / METHODOLOGY</p>
<p>Construction / Development / Implementation of an automatic, high-performance, quantitative single-neuron modelling framework providing a robust specification-calibration-simulation workflow.</p>
<p>SPECIFIC / APPLICATION / DATA</p>
<p>Single-neuron electrophysiological time series inference and prediction.</p>
<p>REFERENCES <a href="https://doi.org/10.1126/science.1181936">Gerstner and Naud (2009)</a>.</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
<!-- # :question: Motivations -->
<aside><div>
<p>Figure from <a href="https://doi.org/10.1126/science.1181936">Gerstner and Naud (2009)</a>.</p>
</div></aside></section></section>
<section>
<section id="introduction-2" class="title-slide slide level1 smaller center">
<h1><span class="semi-transparent">Introduction</span></h1>
<ol type="1">
<li><p><span class="semi-transparent">Objectives</span></p></li>
<li><p>Motivations</p></li>
</ol>
<!-- ## Why Single-Neuron Modelling? {.smaller} -->
</section>
<section id="motivations" class="slide level2 smaller">
<h2>Motivations</h2>
<ul>
<li>Calibrating neuronal models is a long standing issue <sup>1</sup>;</li>
</ul>
<div class="fragment">
<ul>
<li>A lot of <strong>hand tuning</strong> and <strong>domain expertise</strong> is involved in many articles;</li>
</ul>
</div>
<div class="fragment">
<ul>
<li>Currently there is no Julia package that does it fully <sup>2</sup>.</li>
</ul>
<aside class="notes">
<ul>
<li></li>
<li></li>
<li>At the best of our knowledge there are currently no software packages dedicated to the specification, calibration and simulation of single-neuron models implemented in the Julia language apart from NeuronalModelling.jl itself.</li>
</ul>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</div>
<aside><ol class="aside-footnotes"><li id="fn1"><p><a href="https://www.taylorfrancis.com/chapters/edit/10.1201/9781420039290-8/introduction-equation-solving-parameter-fitting">LeMasson and Maex (2001)</a>, <a href="https://doi.org/10.3389/neuro.01.1.1.001.2007">Druckmann et al.&nbsp;(2007)</a>, <a href="https://doi.org/10.1007/s00422-008-0263-8">Pospischil et al.&nbsp;(2008)</a>, <a href="https://doi.org/10.1007/s00422-008-0269-2">Druckmann et al.&nbsp;(2008)</a>, <a href="https://doi.org/10.1371/journal.pcbi.1002133">Druckmann et al.&nbsp;(2011)</a>, <a href="https://doi.org/10.1007/s00422-011-0459-1">Toth et al.&nbsp;(2011)</a>, <a href="https://doi.org/10.1007/978-1-4614-8094-5_28">Druckmann (2013)</a>, <a href="https://doi.org/10.1017/cbo9781107447615">Gerstner et al.&nbsp;(2014)</a>. </p></li><li id="fn2"><p><a href="https://julianeuro.github.io/">JuliaNeuro</a>, <a href="https://github.com/JuliaNeuroscience">JuliaNeuroscience</a></p></li></ol></aside></section>
<section id="motivations-1" class="slide level2 smaller">
<h2>Motivations</h2>
<ul>
<li>An international competition has been proposed <sup>1</sup>;</li>
</ul>
<!-- ::: {.absolute  top=100 left=800} -->
<div class="quarto-layout-panel">
<div class="quarto-layout-row quarto-layout-valign-top">
<div class="quarto-layout-cell" style="flex-basis: 100.0%;justify-content: center;">
<p><img data-src="images/plots/challenge2009input.png" width="480" height="200"> <img data-src="images/plots/challenge2009response.png" width="480" height="200"></p>
</div>
</div>
</div>
<!-- ::: -->
<div class="fragment">
<ul>
<li>Best model was heavily hand-tuned <sup>2</sup>;</li>
</ul>
</div>
<div class="fragment">
<ul>
<li>Little progress the last 10+ years <sup>3</sup>.</li>
</ul>
<aside class="notes">
<ul>
<li></li>
<li><p>E‚Äô un leaky integrate and fire con una soglia dinamica. Solo 3 parametri liberie fittato unicamente rispetto a coincidence factor.</p></li>
<li><p>8% di improvement di abdelaty risp a kobayashi, nessuno dal Lynch2015 all‚Äôabdelaty2022 ha usato i dati della challenge. Non ci sono articoli degni di nota che tacklino la challenge B.</p></li>
</ul>
<p>INTERNATIONAL COMPETITIONS [DESCRIBE WITH MUCH MORE DETAILS AND ADD TO SLIDES!]</p>
<ul>
<li>The above challenge has been turned into a single-neuron modeling competition that was first run by Brain Mind Institute at the Ecole Polytechnique Fe ÃÅde ÃÅrale de Lausanne (EPFL) in Switzerland and was officially handed over to the International Neuroinformatic Coordinating Facility (INCF) in Sweden in 2009.</li>
<li>The idea behind the competition was that a good model can predict neuronal activity based on data that were not adopted in the parameter training / fitting phase.</li>
<li>The first spike timing competition in 2007 used an Ornstein-Uhlenbeck current injection with various means and variance to mimic the combined effect of a large number of synapses. In 2008, the competition was modified to replace the dynamic current by dynamic inhibitory and excitatory conductances using dynamic clamp. Then in 2009 the injected current was changed to a current produced by the simulation of six populations of presynaptic neurons changing their firing rate every 200-500 ms.</li>
<li>Conclusions: High prediction performance is possible in many neuronal systems and <strong>depends strongly on the choice of model structure and calibration method</strong>. One important model feature for high prediction performance is the presence of spike-frequency adaptation. The choice of the model formalism can also influence the fitting method that can be used. High quality prediction is most of the time associated with an efficient and convex fitting method.</li>
<li>‚ÄúThe data of the challenge will remain available in the future for bench-marking purposes, leaving the possibility for such a deed to be accomplished‚Äù.</li>
<li>Among the lessons to be learned from the INCF competition is that every neu- ron is different and one should not think of ‚Äúthe‚Äù model of a pyramidal cell or interneuron. Rather, parameters need to be tuned on a neuron-by-neuron basis. Another lesson is that the quality of a neuron model has to be measured on new data that are not accessible during the phase of parameter tuning.</li>
</ul>
<p>METHODOLOGICAL DEVELOPMENTS</p>
<p>Many recently (and not so recently) developed calibration / optimisation methods (Bayesian, evolutionary, mono- and multi-objective, etc.) are dramatically under-explored in the theoretical and computational neuroscience literature.</p>
<p>LIMITED PROGRESS IN 10+ YEARS</p>
<p>New optimisation / calibration algorithms have been developed (<a href="https://doi.org/10.3389/fninf.2022.771730">AbdelAty et al.&nbsp;(2022)</a>) which improved fitting when compared with the old ones between 5 and 8% (coincidence factor).</p>
<p>REFERENCES</p>
<ul>
<li><a href="https://doi.org/10.1016/j.jneumeth.2007.11.006">Jolivet et al.&nbsp;(2008)</a></li>
<li><a href="https://doi.org/10.1007/s00422-008-0261-x">Jolivet et al.&nbsp;(2008)</a></li>
<li><a href="https://doi.org/10.1126/science.1181936">Gerstner and Naud (2009)</a></li>
<li><a href="https://doi.org/10.3389/fnins.2011.00009">Rossant et al.&nbsp;(2011)</a></li>
<li><a href="https://doi.org/10.1162/neco_a_00208">Naud et al.&nbsp;(2011)</a></li>
<li><a href="https://infoscience.epfl.ch/record/168813?ln=en">Naud et al.&nbsp;(2012)</a></li>
<li><a href="https://doi.org/10.1007/978-1-4614-8094-5_28">Druckmann (2013)</a></li>
<li><a href="https://doi.org/10.1017/cbo9781107447615">Gerstner et al.&nbsp;(2014)</a></li>
<li><a href="https://doi.org/10.1109/ijcnn48605.2020.9206692">Mohacsi et al.&nbsp;(2020)</a></li>
<li><a href="https://doi.org/10.3389/fninf.2022.771730">AbdelAty et al.&nbsp;(2022)</a></li>
</ul>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
<!-- ## hello

![](images/articles/2012Naud.png){.absolute top=78 left=0 width=48%}
![](images/articles/2013Druckmann.png){.absolute bottom=80 left=0 width=48%}
![](images/articles/2011Rossant.png){.absolute top=78 right=0 width=40%}
![](images/articles/2011Naud.png){.absolute bottom=0 right=0 width=45%}

::: {.aside}
<br> <br> <br> <br> 
Figures from [Naud et al. (2011)](https://doi.org/10.1162/neco_a_00208), [Rossant et al. (2011)](https://doi.org/10.3389/fnins.2011.00009), <br> [Naud et al. (2012)](https://infoscience.epfl.ch/record/168813?ln=en) and [Druckmann (2013)](https://doi.org/10.1007/978-1-4614-8094-5_28).
:::

::: {.notes}
WHY NEURONAL MODELLING? / WHY THIS PROJECT? / WHY A SINGLE-NEURON MODELLING FRAMEWORK?  

FOUNDATIONS OF NEUROSCIENCE

- Unraveling and characterising the dynamics of the single neuron, the basic biophysical unit of neural information processing, is one of the most fundamental problems in theoretical, computational and systems neuroscience.
- Single-neuron models often have a large number of free parameters that must be constrained / optimised / estimated. Despite the seemingly straightforward nature of this problem, the main challenge is properly defining and quantifying the match between a given model and a target data set (the similarity / error / distance / loss / cost function).
- Over the last 20 years many researchers have shown that it is not only the temporally averaged firing rate that carries information about the stimulus, but also the exact timing of spikes. Therefore, if spike timing is important, a whole series of questions arises: What is the precision of spike timing if the same stimulus is repeated several times? Do spikes always appear at the same time? What would be a sensible measure of spike timing precision and reliability? Can a neuron model match the spike timing precision of a real neuron? Does it matter which neuron or what stimulus we take? If so, what would be a useful stimulus? More generally: is it possible to predict the spike times of a neuron with millisecond precision?

INTERNATIONAL COMPETITIONS [DESCRIBE WITH MUCH MORE DETAILS AND ADD TO SLIDES!]

- The above challenge has been turned into a single-neuron modeling competition that was first run by Brain Mind Institute at the Ecole Polytechnique Fe ÃÅde ÃÅrale de Lausanne (EPFL) in Switzerland and was officially handed over to the International Neuroinformatic Coordinating Facility (INCF) in Sweden in 2009.
- The idea behind the competition was that a good model can predict neuronal activity based on data that were not adopted in the parameter training / fitting phase. 
- The first spike timing competition in 2007 used an Ornstein-Uhlenbeck current injection with various means and variance to mimic the combined effect of a large number of synapses. In 2008, the competition was modified to replace the dynamic current by dynamic inhibitory and excitatory conductances using dynamic clamp. Then in 2009 the injected current was changed to a current produced by the simulation of six populations of presynaptic neurons changing their firing rate every 200-500 ms.
- Conclusions: High prediction performance is possible in many neuronal systems and **depends strongly on the choice of model structure and calibration method**. One important model feature for high prediction performance is the presence of spike-frequency adaptation. The choice of the model formalism can also influence the fitting method that can be used. High quality prediction is most of the time associated with an efficient and convex fitting method.
- "The data of the challenge will remain available in the future for bench-marking purposes, leaving the possibility for such a deed to be accomplished".
- Among the lessons to be learned from the INCF competition is that every neu- ron is different and one should not think of ‚Äúthe‚Äù model of a pyramidal cell or interneuron. Rather, parameters need to be tuned on a neuron-by-neuron basis. Another lesson is that the quality of a neuron model has to be measured on new data that are not accessible during the phase of parameter tuning.

METHODOLOGICAL DEVELOPMENTS 

Many recently (and not so recently) developed calibration / optimisation methods (Bayesian, evolutionary, mono- and multi-objective, etc.) are dramatically under-explored in the theoretical and computational neuroscience literature.

LIMITED PROGRESS IN 10+ YEARS

New optimisation / calibration algorithms have been developed ([AbdelAty et al. (2022)](https://doi.org/10.3389/fninf.2022.771730)) which improved fitting when compared with the old ones between 5 and 8% (coincidence factor).

REFERENCES 

- [Jolivet et al. (2008)](https://doi.org/10.1016/j.jneumeth.2007.11.006) 
- [Jolivet et al. (2008)](https://doi.org/10.1007/s00422-008-0261-x)
- [Gerstner and Naud (2009)](https://doi.org/10.1126/science.1181936)
- [Rossant et al. (2011)](https://doi.org/10.3389/fnins.2011.00009)
- [Naud et al. (2011)](https://doi.org/10.1162/neco_a_00208)
- [Naud et al. (2012)](https://infoscience.epfl.ch/record/168813?ln=en)
- [Druckmann (2013)](https://doi.org/10.1007/978-1-4614-8094-5_28)
- [Gerstner et al. (2014)](https://doi.org/10.1017/cbo9781107447615)
- [Mohacsi et al. (2020)](https://doi.org/10.1109/ijcnn48605.2020.9206692)
- [AbdelAty et al. (2022)](https://doi.org/10.3389/fninf.2022.771730)
:::
 -->
</div>
<aside><ol class="aside-footnotes"><li id="fn3"><p><a href="https://doi.org/10.1016/j.jneumeth.2007.11.006">Jolivet et al.&nbsp;(2008)</a>, <a href="https://doi.org/10.1007/s00422-008-0261-x">Jolivet et al.&nbsp;(2008)</a>, <a href="https://doi.org/10.1126/science.1181936">Gerstner and Naud (2009)</a>, <a href="https://infoscience.epfl.ch/record/168813?ln=en">Naud et al.&nbsp;(2012)</a>, <a href="https://github.com/InPhyT/Quantitative_Single_Neuron_Modeling_Competition_2007">2007 Training Data</a>, <a href="https://github.com/InPhyT/Quantitative_Single_Neuron_Modeling_Competition_2009">2009 Training Data</a></p></li><li id="fn4"><p><a href="https://doi.org/10.3389/neuro.10.009.2009">Kobayashi et al.&nbsp;(2009)</a></p></li><li id="fn5"><p><a href="https://doi.org/10.3389/fninf.2022.771730">AbdelAty et al.&nbsp;(2022)</a></p></li></ol></aside></section></section>
<section id="methods" class="title-slide slide level1 center">
<h1><span class="emoji" data-emoji="bookmark_tabs">üìë</span> Methods</h1>
<ol type="1">
<li>Models</li>
<li>Calibration</li>
</ol>
<aside class="notes">
<p>Computational neuroscientists use mathematical models built on observational data to investigate what‚Äôs happening in the brain. Models can simulate brain activity from the behavior of a single neuron right through to the patterns of collective activity in whole neural networks. Collecting the experimental data is the first step, then the challenge becomes deciding which computer models best represent the data and can explain the underlying causes of how the brain behaves.</p>
<p>Researchers usually find the right model for their data through trial and error. This involves tweaking a model‚Äôs parameters until the model can reproduce the data of interest. But this process is laborious and not systematic. Moreover, with the ever-increasing complexity of both data and computer models in neuroscience, the old-school approach of building models is starting to show its limitations.</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>

<section>
<section id="methods-1" class="title-slide slide level1 smaller center">
<h1><span class="semi-transparent">Methods</span></h1>
<ol type="1">
<li><p>Models:</p>
<p>2.1 Leaky Integrate and Fire</p>
<p>2.2 Hodgkin-Huxley</p>
<p>2.3 Two Dimensional Reduction</p>
<p>2.4 One Dimensional Reduction</p>
<p>2.5 Exponential NLIF</p>
<p>2.6 AdEx-NLIF</p></li>
<li><p><span class="semi-transparent">Calibration</span></p></li>
</ol>
</section>
<section id="models-leaky-integrate-and-fire" class="slide level2 smaller">
<h2>Models: Leaky integrate and fire</h2>
<ul>
<li>Subthreshold dynamics: <span id="eq-lif"><span class="math display">\[
\tau \frac{du}{dt} = -(u(t) - u_{rest}) + RI(T)
\qquad(1)\]</span></span></li>
</ul>
<p><img data-src="images/books/A2014Gerstner_LIF_circuit.PNG" class="absolute" style="top: 90px; left: 850px; width: 25%; "></p>
<ul>
<li>With firing mechanism:</li>
</ul>
<p><span id="eq-lif_reset"><span class="math display">\[
u(t) \ge \theta \implies u(t+\delta) = u_r
\qquad(2)\]</span></span></p>
<div class="fragment">
<ul>
<li>Cannot describe Bursting, Adaptation, Delayed Response, Inhibitory Rebound etc.</li>
</ul>
</div>
<div class="fragment">
<ul>
<li>Cannot describe spike features such as spike height, width at half height, etc‚Ä¶</li>
</ul>
<aside class="notes">
<p>Comes from considering the neuron as the circuit in fig A.</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</div>
</section>
<section id="models-hodgkin-huxley" class="slide level2 smaller">
<h2>Models: Hodgkin-Huxley</h2>
<p><span id="eq-hh_u"><span class="math display">\[
C\frac{du}{dt} = -\sum\limits_k I_k(t) + I(t)
\qquad(3)\]</span></span></p>
<div class="fragment">
<p>Where, in the simplest case <sup>1</sup>:</p>
<p><span id="eq-hh_currents"><span class="math display">\[
\sum\limits_k I_k(t) = g_{Na}m^3h(u - E_{Na}) + g_Kn^4(u-E_K) + g_L(u-E_L)
\qquad(4)\]</span></span></p>
</div>
<div class="fragment">
<p>Where, setting <span class="math inline">\(x \in \{m,n,h\}\)</span>:</p>
<p><span id="eq-gating_variable_exp_diffeq"><span class="math display">\[
\dot{x} = \alpha_x(u)(1-x) - \beta_x(u)x
\qquad(5)\]</span></span></p>
</div>
<div class="fragment">
<p>Where, for instance:</p>
<p><span id="eq-boltzmann_terms_exp"><span class="math display">\[
\alpha_m(u) = \frac{0.182(u+35)}{1-e^\frac{u+35}{9}} \; , \; \beta_m(u)= \frac{-0.124(u+35)}{1-e^\frac{u+35}{9}}
\qquad(6)\]</span></span></p>
</div>
<aside><ol class="aside-footnotes"><li id="fn6"><p><a href="https://neuronaldynamics.epfl.ch/online/Ch2.S2.html">Gerstner et al.&nbsp;(2014)</a></p></li></ol></aside></section>
<section id="models-hodgkin-huxley-1" class="slide level2 smaller">
<h2>Models: Hodgkin-Huxley</h2>
<p><strong>Unstable</strong> <span class="math inline">\(\rightarrow\)</span> define<sup>1</sup>:</p>
<p><span id="eq-x_0"><span class="math display">\[
x_0(u) := \frac{\alpha_x(u)}{\alpha_x(u) +  \beta_x(u)} = \frac{1}{2}\left(1+\tanh\left(\frac{u - u_x}{\kappa_x}\right)\right)
\qquad(7)\]</span></span> <span id="eq-tau"><span class="math display">\[
\tau_x(u) = \frac{1}{\alpha_x(u) +  \beta_x(u)} = \tau^0_x + \tau^{max}_x\left(1-\tanh\left( \frac{u - u_{\tau,x}}{\sigma_x} \right)^2\right)
\qquad(8)\]</span></span></p>
<div class="fragment">
<p>And then substitute <a href="#/models-hodgkin-huxley">Equation&nbsp;5</a> with:</p>
<p><span id="eq-gating_variables_tanh_diffeq"><span class="math display">\[
\dot{x} = \frac{x_0(u) - x(u)}{\tau_x(u)}
\qquad(9)\]</span></span></p>
</div>
<div class="fragment">
<p><span class="math inline">\(\rightarrow\)</span> solver stability.</p>
<aside class="notes">
<p>The exponential form is numerically unstable ‚Üí we use the <span class="math inline">\(\tanh\)</span> formalism 1. We define:</p>
<p>. . .</p>
<p>Parameters values must then be fitted to the shapes of <a href="#/models-hodgkin-huxley">Equation&nbsp;6</a></p>
<p>. . .</p>
<p>Which achieves solver stability.</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</div>
<aside><ol class="aside-footnotes"><li id="fn7"><p><a href="https://doi.org/10.1007/s00422-011-0459-1">Toth et al.&nbsp;(2011)</a></p></li></ol></aside></section>
<section id="models-two-dimensional-reduction" class="slide level2 smaller">
<h2>Models: two dimensional reduction</h2>
<p>Hodgkin-Huxley models are a bit <strong>unpractical</strong>:</p>
<ul>
<li>No voltage nor current thresholds:</li>
</ul>
<div class="quarto-layout-panel">
<div class="quarto-layout-row quarto-layout-valign-top">
<div class="quarto-layout-cell" style="flex-basis: 100.0%;justify-content: center;">
<p><img data-src="images/books/2014Gerstner_no_voltage_threshold.PNG" width="500" height="300"> <img data-src="images/books/2014Gerstner_no_current_threshold.PNG" width="500" height="300"></p>
</div>
</div>
</div>
<div class="fragment">
<ul>
<li>Impossible to visualize and analyze a 4d+ dynamical system;</li>
</ul>
</div>
<div class="fragment">
<ul>
<li>Best of both worlds <span class="math inline">\(\rightarrow\)</span> <strong>dimensionality reduction</strong>!</li>
</ul>
<aside class="notes">
<ul>
<li>Usually required for intuitiveness</li>
<li></li>
<li>replication of all firing patterns &amp; well-defined threshold, simpler system, parameter identifiability</li>
</ul>
<p>To these, we‚Äôd also add a certain increase in the nuance required to implement and calibrate HH systems w.r.t. NLIF that we‚Äôre about to see.</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</div>
</section>
<section id="models-two-dimensional-reduction-1" class="slide level2 smaller">
<h2>Models: two dimensional reduction</h2>
<p>Note: dynamics of <span class="math inline">\(n\)</span> and <span class="math inline">\(h\)</span> are very slow w.r.t. <span class="math inline">\(m\)</span></p>
<p><img data-src="images/books/2014Gerstner-tau_x.PNG" class="absolute" style="top: 90px; left: 650px; width: 40%; "></p>
<div class="fragment">
<div class="absolute" style="top: 250px; ">
<p><span class="math inline">\(\rightarrow\)</span> define <span class="math inline">\(:w = b-h = an\)</span></p>
<p><span class="math inline">\(\rightarrow\)</span> set: <span class="math inline">\(m(u) = m_0(u)\)</span></p>
<div class="fragment">
<p>So that <a href="#/models-hodgkin-huxley">Equation&nbsp;3</a> becomes: <span class="math display">\[
\frac{du}{dt} = \frac{1}{\tau}(F(u,w) + RI(t))
\]</span></p>
</div>
<div class="fragment">
<p>And <a href="#/models-hodgkin-huxley">Equation&nbsp;5</a> (or <a href="#/models-hodgkin-huxley-1">Equation&nbsp;9</a>) reduce to: <span class="math display">\[
\frac{dw}{dt} = \frac{1}{\tau_w}G(u,w)
\]</span></p>
</div>
<div class="fragment">
<p>Examples: Morris-Lecar model, FitzHugh-Nagumo model</p>
</div>
</div>
</div>
</section>
<section id="models-one-dimensional-reduction" class="slide level2 smaller">
<h2>Models: one dimensional reduction</h2>
<p>Define <span class="math inline">\(\epsilon := \frac{\tau}{\tau_w}\)</span>. If <span class="math inline">\(\tau_w \gt \gt \tau\)</span>:</p>
<p><img data-src="images/books/2014Gerstner-one_dimensional_reduction_firing_mechanism.PNG"><!-- {.absolute top=90 left=650 width=40%} --></p>
<div class="fragment">
<div class="absolute" style="top: 80px; left: 430px; ">
<p>Since:</p>
<ul>
<li>One may <strong>NOT</strong> be interested in spike shape;</li>
</ul>
<div class="fragment">
<ul>
<li>The <span class="math inline">\(w\)</span> variable only varies <strong>after</strong> the voltage has reached its maximum.</li>
</ul>
</div>
</div>
</div>
<div class="fragment">
<p><span class="math inline">\(\rightarrow\)</span> substitute the equation for <span class="math inline">\(\frac{dw}{dt}\)</span> with reset mechanism! <span class="math inline">\(\rightarrow\)</span> <strong>NLIF</strong> models:</p>
<p><span id="eq-NLIF"><span class="math display">\[
\frac{du}{dt} = \frac{1}{\tau}(F(u,w_{rest}) + RI(t)) =: \frac{1}{\tau}(f(u) + RI(t))
\qquad(10)\]</span></span> <span id="eq-one_dimensional_reduction"><span class="math display">\[
u(t) \ge \theta \implies u(t+\delta) = u_r
\qquad(11)\]</span></span></p>
<aside class="notes">
<p>Excitability can now be discussed with the help of Fig. 4.21. A current pulse shifts the state of the system horizontally away from the stable fixed point. If the current pulse is small, the system returns immediately (i.e., on the fast time scale) to the stable fixed point. If the current pulse is large enough so as to put the system beyond the middle branch of the u-nullcline, then the trajectory is pushed toward the right branch of the u-nullcline. The trajectory follows the u-nullcline slowly upward until it jumps back (on the fast time scale) to the left branch of the u-nullcline. The ‚Äòjump‚Äô between the branches of the nullcline corresponds to a rapid voltage change. In terms of neuronal modeling, the jump from the right to the left branch corresponds to the downstroke of the action potential. The middle branch of the u-nullcline (where uÀô&gt;0) acts as a threshold for spike initiation;</p>
<p>. . . - they‚Äôre roughly all the smae -&gt; they carry no information - . . .</p>
<p>w_rest is the w at the intersection of the nullclines. Below is the firing mechanism. <span class="math inline">\(\delta\)</span> can be interpreted as the ‚Äúdead time‚Äù</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</div>
</section>
<section id="models-exponential-nlif" class="slide level2 smaller">
<h2>Models: Exponential NLIF</h2>
<p>How to choose <span class="math inline">\(f(u)\)</span>?</p>
<div class="fragment">
<p><img data-src="images/books/2014Gerstner-AdEx_derivation.PNG" height="200"></p>
<div class="absolute" style="top: 150px; left: 550px; ">
<p><span class="math display">\[
\frac{f(u(t))}{\tau} = \left&lt;\frac{I(t)}{C} - \frac{du}{dt}\right&gt;
\]</span></p>
</div>
</div>
<div class="fragment">
<p><span class="math inline">\(\rightarrow\)</span> best fitting function is: <span class="math inline">\(f(u)= -(u-u_{rest}) + \Delta_T e^{\frac{u-\theta_{rh}}{\Delta_T}}\)</span></p>
</div>
<div class="fragment">
<!-- Would get the same result by approximating the $F(u,w_{rest})$ of a 2-dimensional Hodgkin-Huxley model: -->
<p><img data-src="images/books/2014Gerstner-AdEx_derivation_hh.PNG" height="200"></p>
<div class="absolute" style="top: 500px; left: 550px; ">
<p>Same result from reduced 1d Hodgkin Huxley model.</p>
</div>
<aside class="notes">
<p>By performing experiments:</p>
<p>In order to determine the function f~(u), an experimentalist injects a time-dependent current I(t) into the soma of a neuron while measuring with a second electrode the voltage u(t). From the voltage time course, one finds the voltage derivative du/dt.</p>
<p>A measurement at time t yields a value u(t) (which we use as value along the x-axis of a plot) and a value [(I(t)/C)‚àí(du/dt)] (which we plot along the y axis). With a thousand or more time points per second, the plot fills up rapidly. For each voltage u there are many data points with different values along the y-axis. The best choice of the parameter C is the one that minimizes the width of this distribution. At the end, we average across all points at a given voltage u to find the empirical function (35)</p>
<p>. . .</p>
<p>We find that the empirical function extracted from experiments is well approximated by a combination of a linear and exponential term</p>
<p>. . .</p>
<p>In figure you see a plot of the <span class="math inline">\(F(u, {w_rest})\)</span> of a reduced to 2d HH model where we make the further assumption to make it 1d (separation of time scales). There a 2 fixed points, the leftmost is stable (u_rest), the one in the middle is unstable and denotes the effective threshold. The rightmost one ends the upswing of the spike. One could discard the rightmost and introduce a numerical threshold <span class="math inline">\(\theta_{reset}\)</span> together with a reset mechanism. This way, what‚Äôs left of the <span class="math inline">\(F(u, {w_rest})\)</span> can be approximated with the <span class="math inline">\(f(u)\)</span> of the AdEx above.</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</div>
</section>
<section id="models-adex-nlif" class="slide level2 smaller">
<h2>Models: AdEx-NLIF</h2>
<p>A single <a href="#/models-one-dimensional-reduction">Equation&nbsp;10</a> cannot capture all firing patterns <span class="math inline">\(\rightarrow\)</span> add abstract <strong>linear</strong> current:</p>
<p><span class="math display">\[
\tau\frac{du}{dt} =f(u) -R\sum\limits_k w_k + RI(t) \; , \; \{\tau_k\frac{dw_k}{dt} = a_k(u-u_{rest}) -w_k +b_k\tau_k\sum\limits_{t^{(f)}}\delta(t-t^{(f)})\}
\]</span> <span class="math display">\[
u(t) \ge \theta \implies u(t+\delta) = u_r
\]</span></p>
<div class="fragment">
<p><img data-src="images/books/2014Gerstner-firing_patterns.PNG" width="800" height="300"></p>
<aside class="notes">
<p>The Œ¥-function in the wk equations indicates that, during firing, the adaptation currents wk are increased by an amount bk.The parameters bk are the ‚Äòjump‚Äô of the spike-triggered adaptation.</p>
<p>. . .</p>
<p>Spike-triggered adaptation is controlled by a combination of a and b. The choice of a and b largely determines the firing patterns of the neuron. In figure, you may see al firing patterns as a function of a and b. FOr every pattern, an hight and a low step current are reported.</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</div>
</section></section>
<section>
<section id="methods-2" class="title-slide slide level1 smaller center">
<h1><span class="semi-transparent">Methods</span></h1>
<ol type="1">
<li><p><span class="semi-transparent">Model Specification</span></p></li>
<li><p>Model Calibration:</p>
<p>3.1 Intro</p>
<p>3.2 Objective Functions</p>
<p>3.3 Feature selection</p>
<p>3.4 MOO</p>
<p>3.5 BORG-MOEA</p>
<p>3.6 Pareto-optimal front</p></li>
</ol>
</section>
<section id="calibration-intro" class="slide level2">
<h2>Calibration: Intro</h2>
<ul>
<li><strong>Model calibration</strong> find a parameter set <span class="math inline">\(\vec{w}\)</span> that makes the model <em>match</em> experimental trace;</li>
</ul>
<div class="fragment">
<ul>
<li>The notion of ‚Äúmatching‚Äù will be made precise by the definition of <strong>objective functions</strong> (<strong>loss</strong>);</li>
</ul>
</div>
<div class="fragment">
<ul>
<li>Calibration methods will need to take into account the <strong>intrinsic stochasticity</strong> of neurons.</li>
</ul>
<aside class="notes">
<ul>
<li>‚ÄúModel calibration‚Äù refers to the task of finding a parameter set <span class="math inline">\(\vec{w}\)</span> that makes the model <em>match</em> experimental trace;</li>
<li>i.e.&nbsp;functions that measure the degree to which the model is capable of reproducing experimental traces along certain dimensions;</li>
<li>i.e.&nbsp;their tendency to produce different voltage traces when injected with the same input.</li>
</ul>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</div>
</section>
<section id="calibration-objective-functions" class="slide level2 smaller">
<h2>Calibration: Objective Functions</h2>
<p>Possible candidates are <strong>Trace-to-trace (direct) comparisons</strong>:</p>
<ul>
<li>L2 loss;</li>
<li>Phase plane trajectory distance <sup>1</sup>;</li>
<li>‚Ä¶</li>
</ul>
<div class="fragment">
<p>These usually <sup>2</sup> perform poorly, since:</p>
<ul>
<li>Sub- and supra-threshold dynamics are <em>unbalanced</em>;</li>
</ul>
</div>
<div class="fragment">
<ul>
<li>Small <em>shifts</em> between simulated and measured spikes usually yield large <em>L2</em> errors.</li>
</ul>
</div>
<div class="fragment">
<ul>
<li><em>Intrinsic stochasticity</em> makes the selection of the experimental repetition <span class="math inline">\(r \in R\)</span> to match <em>arbitrary</em>;</li>
</ul>
<aside class="notes">
<ul>
<li></li>
<li></li>
<li></li>
<li><p>True bith for L2 and Lemasson‚Äôs loss</p></li>
<li><p>This can be corrected by using the Lemasson and Maex‚Äôs loss, but one loses all temporal information with it;</p></li>
<li></li>
</ul>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</div>
<aside><ol class="aside-footnotes"><li id="fn8"><p><a href="https://www.taylorfrancis.com/chapters/edit/10.1201/9781420039290-8/introduction-equation-solving-parameter-fitting">LeMasson and Maex (2001)</a></p></li><li id="fn9"><p>We haven‚Äôt yet considered more sophisticated approach like <a href="https://doi.org/10.1152/jn.00007.2014">Brookings et al.&nbsp;(2014)</a></p></li></ol></aside></section>
<section id="calibration-objective-functions-1" class="slide level2">
<h2>Calibration: Objective Functions</h2>
<p><span class="math inline">\(\rightarrow\)</span> use <strong>Feature-based distance functions</strong> <sup>1</sup>:</p>
<ul>
<li>Firing frequency;</li>
<li>Spike height;</li>
<li>Latency;</li>
<li>Accomodation index;</li>
<li>Coincidence factor;</li>
<li>Slope of the fit of the spike peaks;</li>
<li>‚Ä¶</li>
</ul>
<aside><ol class="aside-footnotes"><li id="fn10"><p><a href="https://doi.org/10.3389/neuro.01.1.1.001.2007">Druckmann et al.&nbsp;(2007)</a></p></li></ol></aside></section>
<section id="calibration-objective-functions-2" class="slide level2 smaller">
<h2>Calibration: Objective Functions</h2>
<p>They avoid the previous issues, because</p>
<ul>
<li>They are not point-wise, thus insensitive to <em>regime imbalances</em>;</li>
</ul>
<div class="fragment">
<ul>
<li>They directly make the model reproduce <em>qualitative</em> features of the target neuron;</li>
</ul>
</div>
<div class="fragment">
<ul>
<li>They take into account <em>Intrinsic stochasticity</em>:</li>
</ul>
</div>
<div class="fragment">
<p>By defining the loss relative to feature <span class="math inline">\(f\)</span> w.r.t. repetition set <span class="math inline">\(R\)</span> : <span class="math display">\[L_f(\vec{w}, R) = \frac{|\bar{f}_R - f(s(\vec{w}))|}{\sigma^f_R}\]</span></p>
<!-- $L_f(\vec{w}, R)$   *Intrinsic stochasticity* within repetition set $R$ w.r.t. feature $f$ can be dealt with by defining the loss: -->
</div>
<div class="fragment">
<ul>
<li>We say that we have a good fit when every objective is under 2 SD <sup>1</sup>.</li>
</ul>
<aside class="notes">
<ul>
<li></li>
<li></li>
</ul>
<p>Where:</p>
<ul>
<li><span class="math inline">\(R\)</span> is a set of voltage traces produced by the same neuron injected with the same current</li>
<li><span class="math inline">\(\vec{w}\)</span> is a set of model parameters</li>
<li><span class="math inline">\(s(\vec{w})\)</span> is a voltage trace simulated by the model with parameters <span class="math inline">\(\vec{w}\)</span></li>
<li><span class="math inline">\(\bar{f}_R\)</span> is the average value of feature <span class="math inline">\(f\)</span> over <span class="math inline">\(R\)</span></li>
<li><span class="math inline">\(\sigma^f_R\)</span> is the standard deviation of <span class="math inline">\(f\)</span> over <span class="math inline">\(R\)</span></li>
<li><span class="math inline">\(f(s(\vec{w}))\)</span> is the value of feature <span class="math inline">\(f\)</span> over <span class="math inline">\(s(\vec{w})\)</span></li>
</ul>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</div>
<aside><ol class="aside-footnotes"><li id="fn11"><p><a href="https://doi.org/10.3389/neuro.01.1.1.001.2007">Druckmann et al.&nbsp;(2007)</a></p></li></ol></aside></section>
<section id="calibration-feature-selection" class="slide level2 smaller scrollable">
<h2>Calibration: Feature selection</h2>
<p>Experiments <sup>1</sup> suggest the following associations:</p>
<div class="fragment">
<ul>
<li><p>Square inputs:</p>
<ul>
<li>Firing frequency;</li>
<li>Latency;</li>
<li>Accomodation index;</li>
<li>Width of AP at half height (only for HH models);</li>
<li>Average height of AP;</li>
<li>Slow throughs;</li>
</ul></li>
</ul>
</div>
<div class="fragment">
<ul>
<li><p>Ramp inputs:</p>
<ul>
<li>Average height of AP;</li>
<li>Slow throughs;</li>
<li>Slope of the fit of the spike peaks;</li>
</ul></li>
</ul>
</div>
<div class="fragment">
<ul>
<li><p>Colored noisy inputs:</p>
<ul>
<li>Coincidence factor;</li>
<li>Control-adjusted RMS <sup>2</sup>.</li>
</ul></li>
</ul>
</div>
<aside><ol class="aside-footnotes"><li id="fn12"><p><a href="https://doi.org/10.1371/journal.pcbi.1002133">Druckmann et al.&nbsp;(2011)</a></p></li><li id="fn13"><p><a href="https://doi.org/10.1152/jn.00007.2014">Brookings et al.&nbsp;(2014)</a></p></li></ol></aside></section>
<section id="calibration-moo" class="slide level2">
<h2>Calibration: MOO</h2>
<blockquote>
<p>How to combine the different features?</p>
</blockquote>
<div class="fragment">
<p><strong>Weighted sum</strong>? No:</p>
<ul>
<li>Choice of weights is not obvious;</li>
</ul>
</div>
<div class="fragment">
<ul>
<li>No guarantee on the nature and quality of the compromise;</li>
</ul>
</div>
<div class="fragment">
<p><span class="math inline">\(\rightarrow\)</span> <strong>Multi-Objective Optimization</strong> !</p>
</div>
</section>
<section id="calibration-moo-1" class="slide level2 smaller">
<h2>Calibration: MOO</h2>
<p><strong>Def.</strong> Given the objectives <span class="math inline">\(\{L_{f_1}, L_{f_2}, ..., L_{f_n}\}\)</span>, a set of repetitions <span class="math inline">\(R\)</span> and two parameter sets <span class="math inline">\(\vec{w_1}\)</span> and <span class="math inline">\(\vec{w_2}\)</span> we say that <span class="math inline">\(\vec{w_1}\)</span> <strong>dominates</strong> <span class="math inline">\(\vec{w_2}\)</span> <span class="math inline">\(\iff\)</span>:</p>
<ol type="1">
<li><span class="math inline">\(L_{f_i}(\vec{w_1},R) \leq L_{f_i}(\vec{w_2},R) \qquad \forall i= 1,...,n\)</span></li>
<li><span class="math inline">\(\exists \bar{i} \in \{1,..,n\} | L_{f_\bar{i}}(\vec{w_1},R) \lt L_{f_\bar{i}}(\vec{w_2},R)\)</span></li>
</ol>
<div class="fragment">
<p>MOO purpose: find the set of all <span class="math inline">\(\vec{w}\)</span> that do not dominate each other.</p>
</div>
<div class="fragment">
<p>Such set is the <strong>Pareto-optimal front</strong> (<strong>POF</strong>).</p>
</div>
</section>
<section id="calibration-borg-moea" class="slide level2">
<h2>Calibration: BORG-MOEA</h2>
<ul>
<li>Calibration algorithm: <a href="http://borgmoea.org/">BORG-MOEA</a>;</li>
</ul>
<div class="fragment">
<ul>
<li>It is an evolutionary algorithm with self-tuning capabilities;</li>
</ul>
</div>
<div class="fragment">
<ul>
<li>Pitting it against other algorithms determined its advantage.</li>
</ul>
</div>
</section>
<section id="calibration-pareto-optimal-front-1" class="slide level2 smaller">
<h2>Calibration: Pareto-optimal front #1</h2>
<ul>
<li>The purpose of a <em>MOEA</em> is to approximate the <em>POF</em> by finding some of its elements;</li>
</ul>
<div class="fragment">
<ul>
<li>Projection of the <em>POF</em> set may assume two configurations:</li>
</ul>
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="images/articles/2007Druckmann_POF.PNG" width="800" height="200"></p>
<figcaption>Projections of the Pareto optimal front along two sets of features <sup>1</sup></figcaption>
</figure>
</div>
</div>
<div class="fragment">
<ul>
<li>First configuration <span class="math inline">\(\rightarrow\)</span> the two objectives do not conflict each other;</li>
</ul>
</div>
<div class="fragment">
<ul>
<li>Second configuration <span class="math inline">\(\rightarrow\)</span> the two objectives do conflict each other;</li>
</ul>
</div>
<aside><ol class="aside-footnotes"><li id="fn14"><p><a href="https://doi.org/10.3389/neuro.01.1.1.001.2007">Druckmann et al.&nbsp;(2007)</a></p></li></ol></aside></section>
<section id="calibration-pareto-optimal-front-2" class="slide level2">
<h2>Calibration: Pareto-optimal front #2</h2>
<ul>
<li>Calibration algorithms work better the less objectives they have;</li>
</ul>
<div class="fragment">
<ul>
<li><span class="math inline">\(\rightarrow\)</span> one may think to sum together features repeated across stimuli;</li>
</ul>
</div>
<div class="fragment">
<ul>
<li>Only possible if the two features are <strong>NOT</strong> in a tradeoff <sup>1</sup></li>
</ul>
<aside class="notes">
<ul>
<li></li>
<li></li>
<li>In fact if they are not in a tradeoff the calibration algorithm, can minimize the sum of the two. Instead if they are in a tradeoff, if we sum them the algorithm will find a compromise whose nature and quality we‚Äôre not guaranteed of 8we‚Äôd be bak to the problem in the MOO #1 slide.</li>
</ul>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</div>
<aside><ol class="aside-footnotes"><li id="fn15"><p><a href="https://doi.org/10.1007/s00422-008-0269-2">Druckmann (2013)</a></p></li></ol></aside></section>
<section id="calibration-pareto-optimal-front-3" class="slide level2">
<h2>Calibration: Pareto-optimal front #3</h2>
<ul>
<li>Configuration of the projections of the POF are not known a priori <span class="math inline">\(\rightarrow\)</span> features must be kept separate;</li>
</ul>
<div class="fragment">
<ul>
<li>To anyway reduce the number of features, one may resort to objectives combinations <sup>1</sup>;</li>
</ul>
</div>
<div class="fragment">
<ul>
<li>They consists in substituting two features with the maximum or other combinations of the two.</li>
</ul>
<aside class="notes">

<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</div>
<aside><ol class="aside-footnotes"><li id="fn16"><p><a href="https://doi.org/10.1371/journal.pcbi.1002107">Hay et al.&nbsp;(2011)</a></p></li></ol></aside></section></section>
<section id="neuronalmodeling.jl" class="title-slide slide level1 center">
<h1><span class="emoji" data-emoji="computer">üíª</span> NeuronalModeling.jl</h1>
<ol type="1">
<li>Why Julia?</li>
<li>Overview</li>
<li>Demonstration</li>
<li>Future developments</li>
</ol>
<aside class="notes">

<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>

<section>
<section id="neuronalmodelling.jl" class="title-slide slide level1 center">
<h1><span class="semi-transparent">NeuronalModelling.jl</span></h1>
<ol type="1">
<li><p>Why Julia?</p>
<p>1.1 Performance;</p>
<p>1.2 Metaprogramming;</p>
<p>1.3 Simple Workflow;</p>
<p>1.4 SciML.</p></li>
<li><p><span class="semi-transparent">Overview</span></p></li>
<li><p><span class="semi-transparent">Demonstration</span></p></li>
<li><p><span class="semi-transparent">Future developments</span></p></li>
</ol>
</section>
<section id="why-julia" class="slide level2 smaller">
<h2>Why Julia?</h2>
<p><img data-src="images/articles/2023Roesch-1.webp" class="absolute" style="left: 0px; bottom: 80px; width: 50%; "> <img data-src="images/articles/2023Roesch-2.webp" class="absolute" style="bottom: 120px; right: -200px; width: 65%; "></p>

<aside class="notes">
<p>WHY JULIA?</p>
<ul>
<li>Julia solves the two-language problem: users do not have to choose between ease of use and high performance.</li>
<li>Julia is user friendly. It is easy to code.</li>
<li>Julia is a high performance language. It is fast.</li>
<li>Julia offers a high level of abstraction. It is flexible.</li>
<li>Julia can be used for metaprogramming. It can code automatically.</li>
<li>Julia is not only good in one area but in many. It enables ‚Äúone language‚Äù projects.</li>
<li>Easy to learn due to intuitive semantics and easy to read syntax.</li>
<li>Accessible via various interfaces, REPL, IDE, or Jupyter notebook.</li>
<li>Existing non-Julia code can be easily integrated into new Julia projects via language specific packages (interoperability).</li>
<li>Julia is free, open-source and hosted on GitHub.</li>
<li>Julia offers (generally) excellent documentation, tutorials, and help available directly from active and welcoming community members via various communication channels such as Slack, Discourse, Twitter or Zulip.</li>
<li>Julia‚Äôs package ecosystem provides functionality for a wide range of oft-performed tasks in computational biology research.</li>
<li>Julia code is smoothly extendable which enables and encourages easy contributions and collaborations to/with existing projects, as well as writing, integrating and sharing new, user specific packages.</li>
</ul>
<p>REFERENCES</p>
<p><a href="https://doi.org/10.1038/s41592-023-01832-z">Roesch et al.&nbsp;(2023)</a>.</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
<aside><div>
<p>Figures from <a href="https://doi.org/10.1038/s41592-023-01832-z">Roesch et al.&nbsp;(2023)</a>.</p>
</div></aside></section>
<section id="why-julia-performance" class="slide level2">
<h2>Why Julia?: Performance</h2>
<p><em>Julia writes like Python but executes as fast as C‚Ä¶</em></p>
<div class="absolute" style="top: 300px; ">
<div class="fragment">
<p><em>‚Ä¶assuming you know how to use it.</em><sup>1</sup></p>
</div>
</div>
<aside><ol class="aside-footnotes"><li id="fn17"><p><a href="https://www.youtube.com/playlist?list=PL-G47MxHVTewUm5ywggLvmbUCNOD2RbKA">Holy (2022)</a></p></li></ol></aside></section>
<section id="why-julia-performance-1" class="slide level2 smaller">
<h2>Why Julia?: Performance</h2>
<p>One <strong>function</strong> <span class="math inline">\(\rightarrow\)</span> several <strong>methods</strong>:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode numberSource julia number-lines code-with-copy"><code class="sourceCode julia"><span id="cb1-1"><a href="#cb1-1"></a><span class="fu">methods</span>(<span class="op">+</span>)[<span class="fl">1</span><span class="op">:</span><span class="fl">3</span>] <span class="co"># 206 total methods at the time of writing</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb2"><pre class="sourceCode numberSource nothing number-lines code-with-copy"><code class="sourceCode"><span id="cb2-1"><a href="#cb2-1"></a>[1] +(x::T, y::T) where T&lt;:Union{Int128, Int16, Int32, Int64, Int8, UInt128, UInt16, UInt32, UInt64, UInt8} in Base at int.jl:87</span>
<span id="cb2-2"><a href="#cb2-2"></a>[2] +(x::T, y::T) where T&lt;:Union{Float16, Float32, Float64} in Base at float.jl:383</span>
<span id="cb2-3"><a href="#cb2-3"></a>[3] +(c::Union{UInt16, UInt32, UInt8}, x::BigInt) in Base.GMP at gmp.jl:531     </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="fragment">
<p><strong>Method selection</strong>:</p>
<ol type="1">
<li><p>(Arguments‚Äô) Type Inference;</p></li>
<li><p>Method lookup.</p></li>
</ol>
<aside class="notes">
<p>In programming, usually each function has several methods, one per combination of its arguments‚Äô types:</p>
<p>. . .</p>
<p>Whenever a function is called with certain arguments, the right method has to be selected. The method selection has two parts:</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</div>
</section>
<section id="why-julia-performance-2" class="slide level2 smaller">
<h2>Why Julia?: Performance</h2>
<p><strong>Type Inference</strong>:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode numberSource julia number-lines code-with-copy"><code class="sourceCode julia"><span id="cb3-1"><a href="#cb3-1"></a>julia<span class="op">&gt;</span> <span class="pp">@code_warntype</span>(<span class="fu">loss_square110pA</span>(<span class="fu">Vector</span><span class="dt">{Float64}</span>(initial_parameters_values_AdEx[<span class="fl">2</span><span class="op">:</span><span class="kw">end</span>])))</span>
<span id="cb3-2"><a href="#cb3-2"></a>MethodInstance <span class="cf">for</span> (<span class="op">::</span><span class="dt">RuntimeGeneratedFunctions.RuntimeGeneratedFunction{(:theta,), NeuronalModeling.var"#_RGF_ModTag", NeuronalModeling.var"#_RGF_ModTag", (0xb92b619f, 0x78b8fd2f, 0xcb257d79, 0xdca519fc, 0xc02e6bbc), Expr}</span>)(<span class="op">::</span><span class="dt">Vector{Float64}</span>)</span>
<span id="cb3-3"><a href="#cb3-3"></a>  from (f<span class="op">::</span><span class="dt">RuntimeGeneratedFunctions.RuntimeGeneratedFunction</span>)(args<span class="op">::</span><span class="dt">Vararg{Any, N}</span>) <span class="kw">where</span> N @ RuntimeGeneratedFunctions C<span class="op">:\</span>Users<span class="op">\</span>claud<span class="op">\</span>.julia<span class="op">\</span>packages<span class="op">\</span>RuntimeGeneratedFunctions<span class="op">\</span>mfDmv<span class="op">\</span>src<span class="op">\</span>RuntimeGeneratedFunctions.jl<span class="op">:</span><span class="fl">125</span></span>
<span id="cb3-4"><a href="#cb3-4"></a>Static Parameters</span>
<span id="cb3-5"><a href="#cb3-5"></a>  N <span class="op">=</span> <span class="fl">1</span></span>
<span id="cb3-6"><a href="#cb3-6"></a>Arguments</span>
<span id="cb3-7"><a href="#cb3-7"></a>  f<span class="op">::</span><span class="dt">RuntimeGeneratedFunctions.RuntimeGeneratedFunction{(:theta,), NeuronalModeling.var"#_RGF_ModTag", NeuronalModeling.var"#_RGF_ModTag", (0xb92b619f, 0x78b8fd2f, 0xcb257d79, 0xdca519fc, 0xc02e6bbc), Expr}</span></span>
<span id="cb3-8"><a href="#cb3-8"></a>  args<span class="op">::</span><span class="dt">Tuple{Vector{Float64}}</span></span>
<span id="cb3-9"><a href="#cb3-9"></a>Body<span class="op">::</span><span class="dt">NTuple{7, Float64}</span></span>
<span id="cb3-10"><a href="#cb3-10"></a><span class="fl">1</span> ‚îÄ <span class="op">%</span><span class="fl">1</span> <span class="op">=</span> RuntimeGeneratedFunctions.generated_callfunc<span class="op">::</span><span class="dt">Core.Const</span>(RuntimeGeneratedFunctions.generated_callfunc)</span>
<span id="cb3-11"><a href="#cb3-11"></a>‚îÇ   <span class="op">%</span><span class="fl">2</span> <span class="op">=</span> <span class="bu">Core</span>.<span class="fu">tuple</span>(f)<span class="op">::</span><span class="dt">Tuple{RuntimeGeneratedFunctions.RuntimeGeneratedFunction{(:theta,), NeuronalModeling.var"#_RGF_ModTag", NeuronalModeling.var"#_RGF_ModTag", (0xb92b619f, 0x78b8fd2f, 0xcb257d79, 0xdca519fc, 0xc02e6bbc), Expr}}</span></span>
<span id="cb3-12"><a href="#cb3-12"></a>‚îÇ   <span class="op">%</span><span class="fl">3</span> <span class="op">=</span> <span class="bu">Core</span>.<span class="fu">_apply_iterate</span>(<span class="bu">Base</span>.iterate, <span class="op">%</span><span class="fl">1</span>, <span class="op">%</span><span class="fl">2</span>, args)<span class="op">::</span><span class="dt">NTuple{7, Float64}</span></span>
<span id="cb3-13"><a href="#cb3-13"></a>‚îî‚îÄ‚îÄ      <span class="cf">return</span> <span class="op">%</span><span class="fl">3</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="fragment">
<p>(Successful) Type Inference <span class="math inline">\(\rightarrow\)</span> Method Lookup at compile time</p>
<aside class="notes">
<p>/</p>
<p>. . .</p>
<p>If successful, type inference at compile time will also trigger method lookup at compile time, which has the potential to speed up code by orders of magnitude.</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</div>
</section>
<section id="why-julia-metaprogramming" class="slide level2 smaller">
<h2>Why Julia?: Metaprogramming</h2>
<p>Example from the manual:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode numberSource julia number-lines code-with-copy"><code class="sourceCode julia"><span id="cb4-1"><a href="#cb4-1"></a><span class="cf">for</span> op <span class="op">=</span> (<span class="op">:</span>sin, <span class="op">:</span>cos, <span class="op">:</span>tan, <span class="op">:</span>log, <span class="op">:</span>exp)</span>
<span id="cb4-2"><a href="#cb4-2"></a>    <span class="fu">eval</span>(<span class="kw">quote</span></span>
<span id="cb4-3"><a href="#cb4-3"></a>        <span class="bu">Base</span><span class="op">.$</span><span class="fu">op</span>(a<span class="op">::</span><span class="dt">MyNumber</span>) <span class="op">=</span> <span class="fu">MyNumber</span>(<span class="op">$</span><span class="fu">op</span>(a.x))</span>
<span id="cb4-4"><a href="#cb4-4"></a>    <span class="cf">end</span>)</span>
<span id="cb4-5"><a href="#cb4-5"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="fragment">
<p>Example from NeuronalModeling.jl:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode numberSource julia number-lines code-with-copy"><code class="sourceCode julia"><span id="cb5-1"><a href="#cb5-1"></a><span class="kw">function</span> <span class="fu">borg_moea_loss_closure</span>(hh_model<span class="op">::</span><span class="dt">H</span>, </span>
<span id="cb5-2"><a href="#cb5-2"></a>                                <span class="co"># More arguments...</span></span>
<span id="cb5-3"><a href="#cb5-3"></a>)</span>
<span id="cb5-4"><a href="#cb5-4"></a>    <span class="co"># Code to distinguish feature aggregation...</span></span>
<span id="cb5-5"><a href="#cb5-5"></a></span>
<span id="cb5-6"><a href="#cb5-6"></a>    <span class="co"># We need to generate the loss at runtime since, ar compile time, `num_features`is not known causing it to be not type-stable</span></span>
<span id="cb5-7"><a href="#cb5-7"></a>    loss_expr <span class="op">=</span> <span class="op">:</span>( </span>
<span id="cb5-8"><a href="#cb5-8"></a>        </span>
<span id="cb5-9"><a href="#cb5-9"></a>    <span class="kw">function</span> <span class="fu">borg_moea_loss</span>(theta<span class="op">::</span><span class="dt">Vector{Float64}</span>)<span class="op">::</span><span class="dt">NTuple{$num_features,Float64}</span></span>
<span id="cb5-10"><a href="#cb5-10"></a></span>
<span id="cb5-11"><a href="#cb5-11"></a>        losses_values_by_feature_dict <span class="op">=</span> <span class="fu">hh_neuron_loss_intermediate</span>(<span class="op">$</span>hh_model, theta, <span class="op">$</span>fixed_parameters_indexes, <span class="op">$</span>variable_parameters_indexes, <span class="fu">deepcopy</span>(<span class="op">$</span>fixed_parameters_values), <span class="op">$</span>save_idxs, <span class="op">$</span>filter, <span class="op">$</span>resting_potentials_values_by_type_amplitude, <span class="op">$</span>features_targets_lossKwargs_by_type_amplitude, <span class="op">$</span>opt_trim_associations, <span class="op">$</span>fast_problems_by_type_amplitude_dict, <span class="op">$</span>time_steps_by_type_amplitude_dict, <span class="op">$</span>tstops_by_type_amplitude_dict, <span class="op">$</span>features_counts_dict, <span class="op">$</span>electrophysiology_backend, <span class="op">$</span>aggregation_strategy_of_same_feature_across_different_type_amplitudes)</span>
<span id="cb5-12"><a href="#cb5-12"></a></span>
<span id="cb5-13"><a href="#cb5-13"></a>        <span class="cf">return</span> <span class="fu">NTuple</span><span class="dt">{$num_features,Float64}</span>([loss_val <span class="op">&lt;=</span> <span class="fl">1000.0</span> ? loss_val <span class="op">:</span> <span class="fl">1000.0</span> for loss_val <span class="kw">in</span> <span class="fu">values</span>(losses_values_by_feature_dict)]) <span class="co"># length(losses_values_by_feature_dict)</span></span>
<span id="cb5-14"><a href="#cb5-14"></a>    <span class="kw">end</span></span>
<span id="cb5-15"><a href="#cb5-15"></a>    )</span>
<span id="cb5-16"><a href="#cb5-16"></a></span>
<span id="cb5-17"><a href="#cb5-17"></a>    <span class="cf">return</span> <span class="pp">@RuntimeGeneratedFunction</span>(loss_expr)</span>
<span id="cb5-18"><a href="#cb5-18"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<aside class="notes">
<p>It refers to the set of features that allows a program to generate and execute parts of its code at run time:</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</div>
</section>
<section id="why-julia-simple-workflow" class="slide level2 smaller">
<h2>Why Julia?: Simple Workflow</h2>
<p>It is <em>easy</em> to contribute a package to the Julia‚Äôs ecosystem:</p>
<ol type="1">
<li><code>generate</code> the package‚Äôs structure via PkgTemplates.jl;</li>
</ol>
<div class="fragment">
<ol start="2" type="1">
<li>Write the code;</li>
</ol>
</div>
<div class="fragment">
<ol start="3" type="1">
<li>Publish the repository on GitHub;</li>
</ol>
</div>
<div class="fragment">
<ol start="4" type="1">
<li>Invoke <code>@JuliaRegistrator register</code> in an issue.</li>
</ol>
</div>
<div class="fragment">
<div class="sourceCode" id="cb6"><pre class="sourceCode numberSource julia number-lines code-with-copy"><code class="sourceCode julia"><span id="cb6-1"><a href="#cb6-1"></a>add YourPackage</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<aside class="notes">
<ol type="1">
<li></li>
<li></li>
<li></li>
<li></li>
</ol>
<p>The final command will open a PR to the JuliaRegistries/General public repository, which will make <code>YourPackage.jl</code> available for everyone to be installed via:</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</div>
</section>
<section id="why-julia-sciml" class="slide level2">
<h2>Why Julia? SciML</h2>
<p>It is an <strong>ecosystem</strong> featuring:</p>
<ul>
<li><a href="https://github.com/SciML/DifferentialEquations.jl">DifferentialEquations.jl</a>;</li>
</ul>
<div class="fragment">
<ul>
<li><a href="https://github.com/SciML/ModelingToolkit.jl">ModelingToolkit.jl</a>;</li>
</ul>
</div>
<div class="fragment">
<ul>
<li><a href="https://github.com/SciML/Optimization.jl">Optimization.jl</a>;</li>
</ul>
</div>
<div class="fragment">
<ul>
<li><a href="https://github.com/SciML/DiffEqFlux.jl">DiffeqFlux.jl</a>, <a href="https://github.com/SciML/NeuralPDE.jl">NeuralPDE.jl</a>.</li>
</ul>
<aside class="notes">
<ul>
<li>A state of the art differential equations suite;</li>
<li>Symbolic optimization &amp; modeling;</li>
<li>Suite of optimization algorithms;</li>
<li>Advanced functionalities (scientific machine learning)</li>
</ul>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</div>
</section></section>
<section>
<section id="neuronalmodelling.jl-1" class="title-slide slide level1 center">
<h1><span class="semi-transparent">NeuronalModelling.jl</span></h1>
<ol type="1">
<li><p><span class="semi-transparent">Why Julia?</span></p></li>
<li><p>Overview:</p>
<p>2.1 Model specification;</p>
<p>2.2 Data;</p>
<p>2.3 Features;</p>
<p>2.4 Associations;</p>
<p>2.5 Calibration Pattern;</p></li>
<li><p><span class="semi-transparent">Demonstration</span></p></li>
<li><p><span class="semi-transparent">Future developments</span></p></li>
</ol>
</section>
<section id="overview-model-specification-1" class="slide level2">
<h2>Overview: Model Specification #1</h2>
<p>Nonlinear integrate-and-fire models are specified via the <code>IFModel</code> struct<sup>1</sup>:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode numberSource julia number-lines code-with-copy"><code class="sourceCode julia"><span id="cb7-1"><a href="#cb7-1"></a><span class="kw">mutable struct</span> IFModel <span class="op">&lt;:</span><span class="dt"> AbstractIFModel </span></span>
<span id="cb7-2"><a href="#cb7-2"></a>    name<span class="op">::</span><span class="dt">String</span></span>
<span id="cb7-3"><a href="#cb7-3"></a>    deterministic_dynamic<span class="op">::</span><span class="dt">Function</span></span>
<span id="cb7-4"><a href="#cb7-4"></a>    IC_evaluation_function<span class="op">::</span><span class="dt">Function</span></span>
<span id="cb7-5"><a href="#cb7-5"></a>    calibration_history<span class="op">::</span><span class="dt">Calibration_History</span></span>
<span id="cb7-6"><a href="#cb7-6"></a>    firing_mechanism<span class="op">::</span><span class="dt">Union{DiscreteCallback,ContinuousCallback}</span></span>
<span id="cb7-7"><a href="#cb7-7"></a>    model_kwargs<span class="op">::</span><span class="dt">NamedTuple{&lt;:Any, &lt;:Tuple{Vararg{Any}}}</span></span>
<span id="cb7-8"><a href="#cb7-8"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<aside class="notes">
<ul>
<li><p>The <code>deterministic_dynamics</code> is the system of differential equations describing the neuron;</p></li>
<li><p>The <code>IC_evaluation_function</code> is the function that, given parameters values, initializes the model;</p></li>
<li><p>The <code>firing_mechanism</code> specifies the firing behaviour;</p></li>
<li><p>The <code>calibration_history</code> is a record of all calibration steps. Informally, it keeps track of all parameters‚Äô values and model posterior at every stage of the calibration (we will deal with it later);</p></li>
</ul>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
<aside><ol class="aside-footnotes"><li id="fn18"><p><a href="http://indico.ictp.it/event/a13235/session/99/contribution/371/material/0/1.pdf">Balasubramanian</a></p></li></ol></aside></section>
<section id="overview-model-specification-2" class="slide level2 smaller">
<h2>Overview: Model Specification #2</h2>
<p>Example (AdEx):</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode numberSource julia number-lines code-with-copy"><code class="sourceCode julia"><span id="cb8-1"><a href="#cb8-1"></a><span class="co"># AdEx parameters names. "Dead time" missing due to issue in DifferentialEquations.jl (see links below)</span></span>
<span id="cb8-2"><a href="#cb8-2"></a><span class="kw">const</span> parameters_names_AdEx <span class="op">=</span> [<span class="st">"spike_times"</span>, <span class="st">"V_th"</span>, <span class="st">"u_r"</span>, <span class="st">"b"</span>, <span class="st">"C"</span>, <span class="st">"g_L"</span>, <span class="st">"u_rest"</span>, <span class="st">"Œî_T"</span>, <span class="st">"Œ∏_rh"</span>, <span class="st">"a"</span>, <span class="st">"œÑ_w"</span>]</span>
<span id="cb8-3"><a href="#cb8-3"></a></span>
<span id="cb8-4"><a href="#cb8-4"></a><span class="co"># Initial parameters values for the AdEx model</span></span>
<span id="cb8-5"><a href="#cb8-5"></a><span class="kw">const</span> initial_parameters_values_AdEx_dict <span class="op">=</span> <span class="fu">OrderedDict</span>(<span class="st">"spike_times"</span> <span class="op">=&gt;</span> <span class="dt">Float64</span>[], </span>
<span id="cb8-6"><a href="#cb8-6"></a>                                                        <span class="st">"V_th"</span> <span class="op">=&gt;</span> <span class="op">-</span><span class="fl">60.0</span>, <span class="co"># V_th (mV)</span></span>
<span id="cb8-7"><a href="#cb8-7"></a>                                                        <span class="st">"u_r"</span> <span class="op">=&gt;</span> <span class="op">-</span><span class="fl">71.0</span> , <span class="co">#  u_r (mV)</span></span>
<span id="cb8-8"><a href="#cb8-8"></a>                                                        <span class="st">"b"</span> <span class="op">=&gt;</span> <span class="fl">60e-6</span>, <span class="co">#  b (ŒºA)</span></span>
<span id="cb8-9"><a href="#cb8-9"></a>                                                        <span class="st">"C"</span> <span class="op">=&gt;</span>  (<span class="fl">1</span> <span class="op">/</span> ( <span class="fl">20e-3</span> <span class="op">*</span> <span class="fl">500e6</span>) )<span class="op">*</span><span class="fl">1e4</span>,  <span class="co"># C = 1/ (œÑ_m * R) (ŒºF)</span></span>
<span id="cb8-10"><a href="#cb8-10"></a>                                                        <span class="st">"g_L"</span> <span class="op">=&gt;</span> (<span class="fl">1</span><span class="op">/</span>(<span class="fl">500e6</span>)) <span class="op">*</span> <span class="fl">1e3</span>, <span class="co">#  g_L = 1/R  (mS)</span></span>
<span id="cb8-11"><a href="#cb8-11"></a>                                                        <span class="st">"u_rest"</span> <span class="op">=&gt;</span> <span class="op">-</span><span class="fl">70.0</span> ,  <span class="co">#  u_rest (mV)</span></span>
<span id="cb8-12"><a href="#cb8-12"></a>                                                        <span class="st">"Œî_T"</span> <span class="op">=&gt;</span> <span class="fl">2.0</span>, <span class="co">#  Œî_T (mV)</span></span>
<span id="cb8-13"><a href="#cb8-13"></a>                                                        <span class="st">"Œ∏_rh"</span> <span class="op">=&gt;</span> <span class="op">-</span><span class="fl">65.0</span>, <span class="co"># Œ∏_rh (mV)</span></span>
<span id="cb8-14"><a href="#cb8-14"></a>                                                        <span class="st">"a"</span> <span class="op">=&gt;</span> <span class="fl">0.0</span> <span class="op">*</span> <span class="fl">1e-6</span>,  <span class="co">#  a (mS)</span></span>
<span id="cb8-15"><a href="#cb8-15"></a>                                                        <span class="st">"œÑ_w"</span> <span class="op">=&gt;</span> <span class="fl">30.0</span>) <span class="co">#  œÑ_w (msec)  taken from table 6.1 https://neuronaldynamics.epfl.ch/online/Ch6.S2.html , tonic</span></span>
<span id="cb8-16"><a href="#cb8-16"></a></span>
<span id="cb8-17"><a href="#cb8-17"></a></span>
<span id="cb8-18"><a href="#cb8-18"></a></span>
<span id="cb8-19"><a href="#cb8-19"></a><span class="co"># Function that computes the initial conditions for the AdEx model given the parameters values (cfr Future developments: Hodgkin-Huxley model)</span></span>
<span id="cb8-20"><a href="#cb8-20"></a><span class="fu">get_AdEx_IC</span>(V_rest<span class="op">::</span><span class="dt">Float64</span>, all_parameters_values<span class="op">::</span><span class="dt">Vector{&lt;:Any}</span>) <span class="op">=</span> [V_rest, <span class="fl">0.0</span>]</span>
<span id="cb8-21"><a href="#cb8-21"></a>    </span>
<span id="cb8-22"><a href="#cb8-22"></a></span>
<span id="cb8-23"><a href="#cb8-23"></a><span class="co"># Deterministic dynamics for the AdEx. Implementation features have been chosen via benchmarking multiple approaches</span></span>
<span id="cb8-24"><a href="#cb8-24"></a><span class="kw">function</span> <span class="fu">AdEx_deterministic_dynamic!</span>(input<span class="op">::</span><span class="dt">F</span>) <span class="kw">where</span> {F <span class="op">&lt;:</span><span class="dt"> Function</span>}</span>
<span id="cb8-25"><a href="#cb8-25"></a>    <span class="kw">function</span> <span class="fu">parametrized_AdEx_deterministic_dynamic!</span>(du, u, p, t)</span>
<span id="cb8-26"><a href="#cb8-26"></a>        </span>
<span id="cb8-27"><a href="#cb8-27"></a>        spike_times, V_th, u_r, b, C, g_L, u_rest, Œî_T, Œ∏_rh, a,  œÑ_w <span class="op">=</span> p </span>
<span id="cb8-28"><a href="#cb8-28"></a></span>
<span id="cb8-29"><a href="#cb8-29"></a>        <span class="co"># # State variables</span></span>
<span id="cb8-30"><a href="#cb8-30"></a>        V <span class="op">=</span> <span class="pp">@view</span> u[<span class="fl">1</span>]</span>
<span id="cb8-31"><a href="#cb8-31"></a>        w <span class="op">=</span> <span class="pp">@view</span> u[<span class="fl">2</span>]</span>
<span id="cb8-32"><a href="#cb8-32"></a></span>
<span id="cb8-33"><a href="#cb8-33"></a>        <span class="co"># State variables</span></span>
<span id="cb8-34"><a href="#cb8-34"></a>        dV <span class="op">=</span> <span class="pp">@view</span> du[<span class="fl">1</span>]</span>
<span id="cb8-35"><a href="#cb8-35"></a>        dw <span class="op">=</span> <span class="pp">@view</span> du[<span class="fl">2</span>]</span>
<span id="cb8-36"><a href="#cb8-36"></a></span>
<span id="cb8-37"><a href="#cb8-37"></a>        dV <span class="op">.=</span> (<span class="fl">1</span> <span class="op">./</span>C) <span class="op">.*</span> ( (<span class="op">-</span><span class="fl">1</span>) <span class="op">.*</span> g_L <span class="op">.*</span> (V <span class="op">.-</span> u_rest) <span class="op">.+</span> g_L <span class="op">.*</span> Œî_T <span class="op">.*</span> <span class="fu">exp</span>((V <span class="op">.-</span> Œ∏_rh) <span class="op">./</span> Œî_T) <span class="op">.-</span> w <span class="op">.+</span> <span class="fu">input</span>(t))</span>
<span id="cb8-38"><a href="#cb8-38"></a>        dw <span class="op">.=</span> (<span class="fl">1</span> <span class="op">./</span> œÑ_w) <span class="op">.*</span> (a <span class="op">.*</span> (V <span class="op">.-</span> u_rest)  <span class="op">.-</span> w)</span>
<span id="cb8-39"><a href="#cb8-39"></a></span>
<span id="cb8-40"><a href="#cb8-40"></a>    <span class="kw">end</span></span>
<span id="cb8-41"><a href="#cb8-41"></a><span class="kw">end</span></span>
<span id="cb8-42"><a href="#cb8-42"></a></span>
<span id="cb8-43"><a href="#cb8-43"></a><span class="co"># Firing mechanism</span></span>
<span id="cb8-44"><a href="#cb8-44"></a><span class="kw">function</span> <span class="fu">AdEx_firing_callback_discrete_condition</span>(u,t,integrator)</span>
<span id="cb8-45"><a href="#cb8-45"></a>    u[<span class="fl">1</span>] <span class="op">&gt;=</span> integrator.p[<span class="fl">2</span>]</span>
<span id="cb8-46"><a href="#cb8-46"></a><span class="kw">end</span></span>
<span id="cb8-47"><a href="#cb8-47"></a></span>
<span id="cb8-48"><a href="#cb8-48"></a><span class="kw">function</span> <span class="fu">AdEx_firing_callback_affect!</span>(integrator)</span>
<span id="cb8-49"><a href="#cb8-49"></a>    <span class="fu">push!</span>(integrator.p[<span class="fl">1</span>], integrator.t)</span>
<span id="cb8-50"><a href="#cb8-50"></a>    integrator.u[<span class="fl">1</span>]  <span class="op">=</span> integrator.p[<span class="fl">3</span>]</span>
<span id="cb8-51"><a href="#cb8-51"></a>    integrator.u[<span class="fl">2</span>] <span class="op">+=</span> integrator.p[<span class="fl">4</span>]</span>
<span id="cb8-52"><a href="#cb8-52"></a><span class="kw">end</span></span>
<span id="cb8-53"><a href="#cb8-53"></a></span>
<span id="cb8-54"><a href="#cb8-54"></a></span>
<span id="cb8-55"><a href="#cb8-55"></a><span class="kw">const</span> AdEx_firing_discrete_callback <span class="op">=</span> DifferentialEquations.<span class="fu">DiscreteCallback</span>(AdEx_firing_callback_discrete_condition, AdEx_firing_callback_affect!, save_positions <span class="op">=</span> (<span class="cn">false</span>,<span class="cn">false</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>

<aside><div>
<p><a href="https://github.com/SciML/DifferentialEquations.jl/issues/868">Issue</a>, <a href="https://discourse.julialang.org/t/error-when-trying-to-dynamically-change-tstops-during-solve/81999">Discourse</a></p>
</div></aside></section>
<section id="overview-model-specification-3" class="slide level2 smaller">
<h2>Overview: Model Specification #3</h2>
<p>So that the model can be instantiated as:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode numberSource julia number-lines code-with-copy"><code class="sourceCode julia"><span id="cb9-1"><a href="#cb9-1"></a><span class="co"># Parameters' priors are defined as Uniform distribution around the values provided in `initial_parameters_values_AdEx_dict`</span></span>
<span id="cb9-2"><a href="#cb9-2"></a>parameters_priors_AdEx <span class="op">=</span> <span class="fu">get_uniform_priors</span>(initial_parameters_values_AdEx, range <span class="op">=</span> <span class="fl">1</span> )</span>
<span id="cb9-3"><a href="#cb9-3"></a><span class="co"># Define calibratable and non-calibratable parameters</span></span>
<span id="cb9-4"><a href="#cb9-4"></a>parameters <span class="op">=</span> [name <span class="op">!=</span> <span class="st">"spike_times"</span> ? <span class="fu">Parameter</span>(name, val, prior,<span class="cn">true</span>) <span class="op">:</span> <span class="fu">Parameter</span>(name, val, prior,<span class="cn">false</span>) for (name, val, prior) <span class="kw">in</span> <span class="fu">zip</span>(parameters_names_AdEx, initial_parameters_values_AdEx, parameters_priors_AdEx)]</span>
<span id="cb9-5"><a href="#cb9-5"></a><span class="co"># Outer constructor</span></span>
<span id="cb9-6"><a href="#cb9-6"></a>AdEx <span class="op">=</span> <span class="fu">IFModel</span>( <span class="st">"Adaptive Exponential"</span>,</span>
<span id="cb9-7"><a href="#cb9-7"></a>                AdEx_deterministic_dynamic!,</span>
<span id="cb9-8"><a href="#cb9-8"></a>                get_AdEx_IC,</span>
<span id="cb9-9"><a href="#cb9-9"></a>                parameters,</span>
<span id="cb9-10"><a href="#cb9-10"></a>                AdEx_firing_discrete_callback </span>
<span id="cb9-11"><a href="#cb9-11"></a>);  </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="overview-data-1" class="slide level2">
<h2>Overview: Data #1</h2>
<ul>
<li>Data were taken from the <a href="https://celltypes.brain-map.org/">Allen Brain Atlas</a>;</li>
</ul>
<div class="fragment">
<ul>
<li>Data: voltage recordings of cell responses to input currents (square, multiple square, impulse, ramp, white noise, etc);</li>
</ul>
</div>
<div class="fragment">
<ul>
<li>We selected <a href="http://celltypes.brain-map.org/mouse/experiment/electrophysiology/488697163">one cell</a> in particular because of its characteristics;</li>
</ul>
<aside class="notes">
<ul>
<li></li>
<li>Data consists of voltage recordings of membrane potential responses to multiple types of input current (square, multiple square, impulse, ramp, white noise, etc) at different amplitudes injected in various cells;</li>
<li></li>
</ul>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</div>
</section>
<section id="overview-data-2" class="slide level2 smaller">
<h2>Overview: Data #2</h2>
<p><a href="https://allensdk.readthedocs.io/en/latest/">AllenSDK</a> provides automated download and caching of the data from Allen Brain Atlas.</p>
<div class="fragment">
<p>API for importing data from Allen website:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode numberSource julia number-lines code-with-copy"><code class="sourceCode julia"><span id="cb10-1"><a href="#cb10-1"></a>cell_dataset <span class="op">=</span> <span class="fu">get_cell_dataset</span>(manifest_path,<span class="fl">488697163</span>)</span>
<span id="cb10-2"><a href="#cb10-2"></a>cell_dataset[<span class="st">"data"</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb11"><pre class="sourceCode numberSource nothing number-lines code-with-copy"><code class="sourceCode"><span id="cb11-1"><a href="#cb11-1"></a>Dict{String, Dict{String, Type_Amplitude}} with 8 entries:</span>
<span id="cb11-2"><a href="#cb11-2"></a>  "ramp"                        =&gt; Dict("800.0 pA"=&gt;Type_Amplitude‚Ä¶</span>
<span id="cb11-3"><a href="#cb11-3"></a>  "square - 2s suprathreshold"  =&gt; Dict("190.0 pA"=&gt;Type_Amplitude‚Ä¶</span>
<span id="cb11-4"><a href="#cb11-4"></a>  "test"                        =&gt; Dict("0.0 pA"=&gt;Type_Amplitude‚Ä¶</span>
<span id="cb11-5"><a href="#cb11-5"></a>  "long square"                 =&gt; Dict("-110.0 pA"=&gt;Type_Amplitude‚Ä¶</span>
<span id="cb11-6"><a href="#cb11-6"></a>  "square - 0.5ms subthreshold" =&gt; Dict("-200.0 pA"=&gt;Type_Amplitude‚Ä¶</span>
<span id="cb11-7"><a href="#cb11-7"></a>  "noise 2"                     =&gt; Dict("259.375 pA"=&gt;Type_Amplitude‚Ä¶</span>
<span id="cb11-8"><a href="#cb11-8"></a>  "short square"                =&gt; Dict("800.0 pA"=&gt;Type_Amplitude‚Ä¶</span>
<span id="cb11-9"><a href="#cb11-9"></a>  "noise 1"                     =&gt; Dict("255.0 pA"=&gt;Type_Amplitude‚Ä¶</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="fragment">
<p>Access recordings relative to particular input type:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode numberSource julia number-lines code-with-copy"><code class="sourceCode julia"><span id="cb12-1"><a href="#cb12-1"></a>cell_dataset[<span class="st">"data"</span>][<span class="st">"square - 2s suprathreshold"</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb13"><pre class="sourceCode numberSource nothing number-lines code-with-copy"><code class="sourceCode"><span id="cb13-1"><a href="#cb13-1"></a>Dict{String, Type_Amplitude} with 3 entries:</span>
<span id="cb13-2"><a href="#cb13-2"></a>  "190.0 pA" =&gt; Type_Amplitude‚Ä¶</span>
<span id="cb13-3"><a href="#cb13-3"></a>  "150.0 pA" =&gt; Type_Amplitude‚Ä¶</span>
<span id="cb13-4"><a href="#cb13-4"></a>  "110.0 pA" =&gt; Type_Amplitude‚Ä¶</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<aside class="notes">
<p>Our pipeline automatically converts Allen‚Äôs rather involved data structures in a dictionary of sweeps organized by type and amplitude of the input current:</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</div>
</section>
<section id="overview-data-3" class="slide level2 smaller">
<h2>Overview: Data #3</h2>
<p>Each input type and amplitude has usually been repeated more than once. We collect the corresponding sweeps in a dedicated <code>Type_Amplitude</code> struct:</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode numberSource julia number-lines code-with-copy"><code class="sourceCode julia"><span id="cb14-1"><a href="#cb14-1"></a><span class="kw">struct</span> Type_Amplitude <span class="op">&lt;:</span><span class="dt"> AbstractMeasurement</span></span>
<span id="cb14-2"><a href="#cb14-2"></a>    <span class="kw">type</span><span class="op">::</span><span class="dt">String</span></span>
<span id="cb14-3"><a href="#cb14-3"></a>    amplitude<span class="op">::</span><span class="dt">String</span></span>
<span id="cb14-4"><a href="#cb14-4"></a>    sweeps<span class="op">::</span><span class="dt">Tuple{Vararg{Sweep}}</span></span>
<span id="cb14-5"><a href="#cb14-5"></a>    interpolated_input_closure<span class="op">::</span><span class="dt">Function</span></span>
<span id="cb14-6"><a href="#cb14-6"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="fragment">
<p>Example:</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode numberSource julia number-lines code-with-copy"><code class="sourceCode julia"><span id="cb15-1"><a href="#cb15-1"></a>cell_dataset[<span class="st">"data"</span>][<span class="st">"square - 2s suprathreshold"</span>][<span class="st">"110.0 pA"</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb16"><pre class="sourceCode numberSource nothing number-lines code-with-copy"><code class="sourceCode"><span id="cb16-1"><a href="#cb16-1"></a>Type_Amplitude</span>
<span id="cb16-2"><a href="#cb16-2"></a>‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê</span>
<span id="cb16-3"><a href="#cb16-3"></a>‚îÇ            TYPE            ‚îÇ AMPLITUDE ‚îÇ NUMBER OF SWEEPS ‚îÇ        NAME OF INPUT INTERPOLATION         ‚îÇ</span>
<span id="cb16-4"><a href="#cb16-4"></a>‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§</span>
<span id="cb16-5"><a href="#cb16-5"></a>‚îÇ square - 2s suprathreshold ‚îÇ 110.0 pA  ‚îÇ        4         ‚îÇ square__2s_suprathreshold_110_0_pA_closure ‚îÇ</span>
<span id="cb16-6"><a href="#cb16-6"></a>‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="overview-data-4" class="slide level2 smaller">
<h2>Overview: Data #4</h2>
<p>Every repetition of the same input is called <code>Sweep</code>. Thus, <code>Sweep</code>s contain the raw data, i.e.&nbsp;the time series of input current and voltage response:</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode numberSource julia number-lines code-with-copy"><code class="sourceCode julia"><span id="cb17-1"><a href="#cb17-1"></a><span class="kw">struct</span> Sweep{T}</span>
<span id="cb17-2"><a href="#cb17-2"></a>    name<span class="op">::</span><span class="dt">String</span></span>
<span id="cb17-3"><a href="#cb17-3"></a>    v<span class="op">::</span><span class="dt">Vector{T}</span></span>
<span id="cb17-4"><a href="#cb17-4"></a>    i<span class="op">::</span><span class="dt">Vector{Float64}</span></span>
<span id="cb17-5"><a href="#cb17-5"></a>    t<span class="op">::</span><span class="dt">Vector{Float64}</span></span>
<span id="cb17-6"><a href="#cb17-6"></a>    index_range<span class="op">::</span><span class="dt">Tuple{Int64,Int64}</span></span>
<span id="cb17-7"><a href="#cb17-7"></a>    UOM<span class="op">::</span><span class="dt">NamedTuple{(:v, :i, :t),Tuple{Float64,Float64,Float64}}</span></span>
<span id="cb17-8"><a href="#cb17-8"></a>    extra_data<span class="op">::</span><span class="dt">NamedTuple{&lt;:Any,&lt;:Tuple{Vararg{Any}}}</span></span>
<span id="cb17-9"><a href="#cb17-9"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="fragment">
<p>Example:</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode numberSource julia number-lines code-with-copy"><code class="sourceCode julia"><span id="cb18-1"><a href="#cb18-1"></a>cell_dataset[<span class="st">"data"</span>][<span class="st">"square - 2s suprathreshold"</span>][<span class="st">"110.0 pA"</span>].sweeps[<span class="fl">1</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb19"><pre class="sourceCode numberSource nothing number-lines code-with-copy"><code class="sourceCode"><span id="cb19-1"><a href="#cb19-1"></a>SWEEP Square__2s_Suprathreshold_110_0_pA</span>
<span id="cb19-2"><a href="#cb19-2"></a>‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê</span>
<span id="cb19-3"><a href="#cb19-3"></a>‚îÇ       PROPERTY        ‚îÇ               VALUE                ‚îÇ</span>
<span id="cb19-4"><a href="#cb19-4"></a>‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§</span>
<span id="cb19-5"><a href="#cb19-5"></a>‚îÇ      index_range      ‚îÇ         (150000, 2004000)          ‚îÇ</span>
<span id="cb19-6"><a href="#cb19-6"></a>‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§</span>
<span id="cb19-7"><a href="#cb19-7"></a>‚îÇ Units of Measure (SI) ‚îÇ (v = 0.001, i = 1.0e-6, t = 0.001) ‚îÇ</span>
<span id="cb19-8"><a href="#cb19-8"></a>‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="overview-data-4-1" class="slide level2 smaller">
<h2>Overview: Data #4</h2>
<p>We may visualize the sweeps corresponding to different input currents:</p>
<div class="quarto-layout-panel">
<div class="quarto-layout-row quarto-layout-valign-top">
<div class="quarto-layout-cell" style="flex-basis: 100.0%;justify-content: center;">
<p><img data-src="images/plots/square_110pA_sweeps.png" style="width:45.0%" height="250"> <!--# .absolute bottom=90 right=-20 --> <img data-src="images/plots/ramp_800pA_sweeps.png" style="width:45.0%" height="250"> <img data-src="images/plots/square_110pA_input.png" style="width:45.0%" height="250"> <img data-src="images/plots/ramp_800pA_input.png" style="width:45.0%" height="250"></p>
</div>
</div>
</div>
</section>
<section id="overview-features-1" class="slide level2">
<h2>Overview: Features #1 <!-- {.smaller} --></h2>
<p>Features are implemented via the <code>ElectrophysiologicalFeature</code> construct:</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode numberSource julia number-lines code-with-copy"><code class="sourceCode julia"><span id="cb20-1"><a href="#cb20-1"></a><span class="kw">mutable struct</span> ElectrophysiologicalFeature <span class="op">&lt;:</span><span class="dt"> AbstractElectrophysiologicalFeature</span></span>
<span id="cb20-2"><a href="#cb20-2"></a>    name<span class="op">::</span><span class="dt">String</span></span>
<span id="cb20-3"><a href="#cb20-3"></a>    UOM<span class="op">::</span><span class="dt">Float64</span></span>
<span id="cb20-4"><a href="#cb20-4"></a>    target_evaluation_on_sweep<span class="op">::</span><span class="dt">Function</span></span>
<span id="cb20-5"><a href="#cb20-5"></a>    target_lossKwargs_evaluationKwargs_evaluation_on_typeAmplitude<span class="op">::</span><span class="dt">Function</span></span>
<span id="cb20-6"><a href="#cb20-6"></a>    loss<span class="op">::</span><span class="dt">Function</span></span>
<span id="cb20-7"><a href="#cb20-7"></a>    loss_kwargs<span class="op">::</span><span class="dt">NamedTuple{&lt;:Any, &lt;:Tuple{Vararg{Any}}}</span></span>
<span id="cb20-8"><a href="#cb20-8"></a>    target_lossKwargs_evaluation_kwargs<span class="op">::</span><span class="dt">NamedTuple{&lt;:Any, &lt;:Tuple{Vararg{Any}}}</span></span>
<span id="cb20-9"><a href="#cb20-9"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<aside class="notes">
<p>Features at <code>Sweep</code> and <code>Type_Amplitude</code> level are implemented via the <code>ElectrophysiologicalFeature</code> construct:</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="overview-features-2" class="slide level2 smaller">
<h2>Overview: Features #2</h2>
<p>Example of <code>Sweep</code> level feature, the Firing Frequency:</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode numberSource julia number-lines code-with-copy"><code class="sourceCode julia"><span id="cb21-1"><a href="#cb21-1"></a><span class="co"># Evaluation on NLIF model simulation</span></span>
<span id="cb21-2"><a href="#cb21-2"></a><span class="fu">allen_firing_frequency_Hz_evaluation_on_sweep</span>(sol<span class="op">::</span><span class="dt">OrdinaryDiffEq.ODESolution</span>) <span class="op">=</span> <span class="fu">length</span>(sol.prob.p[<span class="fl">1</span>]) <span class="op">/</span> (<span class="fu">diff</span>(<span class="fu">vcat</span>(sol.prob.tspan<span class="op">...</span>))[<span class="fl">1</span>] <span class="op">*</span> <span class="fl">1e-3</span>)</span>
<span id="cb21-3"><a href="#cb21-3"></a></span>
<span id="cb21-4"><a href="#cb21-4"></a><span class="co"># Evaluation on electrophysiological recordings</span></span>
<span id="cb21-5"><a href="#cb21-5"></a><span class="fu">allen_firing_frequency_Hz_evaluation_on_sweep</span>(ephys_sfe<span class="op">::</span><span class="dt">PyObject</span>) <span class="op">=</span> ephys_sfe.<span class="fu">sweep_feature</span>(<span class="st">"avg_rate"</span>)</span>
<span id="cb21-6"><a href="#cb21-6"></a></span>
<span id="cb21-7"><a href="#cb21-7"></a><span class="co"># Target and loss kwargs evaluation</span></span>
<span id="cb21-8"><a href="#cb21-8"></a><span class="kw">function</span> <span class="fu">allen_firing_frequency_Hz_target_lossKwargs_evaluationKwargs_evaluation_on_typeAmplitude</span>(ephys_sfes<span class="op">::</span><span class="dt">Vector{PyObject}</span>)</span>
<span id="cb21-9"><a href="#cb21-9"></a></span>
<span id="cb21-10"><a href="#cb21-10"></a>    <span class="co"># Evaluate firing frequency for all electrophysiological recordings</span></span>
<span id="cb21-11"><a href="#cb21-11"></a>    sweep_features <span class="op">=</span> <span class="fu">allen_firing_frequency_Hz_evaluation_on_sweep</span>.(ephys_sfes)</span>
<span id="cb21-12"><a href="#cb21-12"></a></span>
<span id="cb21-13"><a href="#cb21-13"></a>    <span class="co"># As per the literature, the target is the mean of the sweep-level features</span></span>
<span id="cb21-14"><a href="#cb21-14"></a>    target <span class="op">=</span> <span class="fu">mean</span>(sweep_features)</span>
<span id="cb21-15"><a href="#cb21-15"></a></span>
<span id="cb21-16"><a href="#cb21-16"></a>    <span class="co"># As per the literature, the loss must be normalized by the experimental standard deviation</span></span>
<span id="cb21-17"><a href="#cb21-17"></a>    experimental_standard_deviation <span class="op">=</span> (<span class="bu">Statistics</span>.<span class="fu">std</span>(sweep_features))</span>
<span id="cb21-18"><a href="#cb21-18"></a></span>
<span id="cb21-19"><a href="#cb21-19"></a>    <span class="co"># If the experimental std is lesser than a certain threshold (e.g. only one sweep is available), then use an empirical value stored elsewhere</span></span>
<span id="cb21-20"><a href="#cb21-20"></a>    standard_deviation <span class="op">=</span> <span class="fu">isnan</span>(experimental_standard_deviation) <span class="op">||</span> experimental_standard_deviation <span class="op">&lt;</span>  allen_default_standard_deviations[<span class="st">"firing_frequency_Hz"</span>] ? allen_default_standard_deviations[<span class="st">"firing_frequency_Hz"</span>] <span class="op">:</span> experimental_standard_deviation</span>
<span id="cb21-21"><a href="#cb21-21"></a></span>
<span id="cb21-22"><a href="#cb21-22"></a>    <span class="cf">return</span> target, (standard_deviation <span class="op">=</span> standard_deviation,), ()</span>
<span id="cb21-23"><a href="#cb21-23"></a></span>
<span id="cb21-24"><a href="#cb21-24"></a><span class="kw">end</span></span>
<span id="cb21-25"><a href="#cb21-25"></a></span>
<span id="cb21-26"><a href="#cb21-26"></a><span class="co"># Define the feature</span></span>
<span id="cb21-27"><a href="#cb21-27"></a><span class="fu">allen_firing_frequency_Hz</span>() <span class="op">=</span> <span class="fu">ElectrophysiologicalFeature</span>(  </span>
<span id="cb21-28"><a href="#cb21-28"></a>                                    <span class="st">"allen_firing_frequency_Hz"</span>,</span>
<span id="cb21-29"><a href="#cb21-29"></a>                                    <span class="fl">1e0</span>,</span>
<span id="cb21-30"><a href="#cb21-30"></a>                                    allen_firing_frequency_Hz_evaluation_on_sweep,</span>
<span id="cb21-31"><a href="#cb21-31"></a>                                    allen_firing_frequency_Hz_target_lossKwargs_evaluationKwargs_evaluation_on_typeAmplitude,</span>
<span id="cb21-32"><a href="#cb21-32"></a>                                    druckmann_loss;</span>
<span id="cb21-33"><a href="#cb21-33"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="overview-features-3" class="slide level2 smaller">
<h2>Overview: Features #3</h2>
<p>Example of <code>Type_Amplitude</code> level feature, the Coincidence Factor:</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode numberSource julia number-lines code-with-copy"><code class="sourceCode julia"><span id="cb22-1"><a href="#cb22-1"></a><span class="co"># Evaluate the coincidence factor between two sweeps (NB: the coincidence factor does not commute w.r.t. the order of the two sweeps)</span></span>
<span id="cb22-2"><a href="#cb22-2"></a><span class="kw">function</span> <span class="fu">coincidence_factor_closure</span>(Œ¥<span class="op">::</span><span class="dt">Int64</span>)</span>
<span id="cb22-3"><a href="#cb22-3"></a></span>
<span id="cb22-4"><a href="#cb22-4"></a>    <span class="kw">function</span> <span class="fu">coincidence_factor</span>(experimental_peaks_t<span class="op">::</span><span class="dt">Vector{Float64}</span>, model_peaks_t<span class="op">::</span><span class="dt">Vector{Float64} </span>) </span>
<span id="cb22-5"><a href="#cb22-5"></a></span>
<span id="cb22-6"><a href="#cb22-6"></a>        interval <span class="op">=</span> experimental_peaks_t[<span class="kw">end</span>] <span class="op">-</span> experimental_peaks_t[<span class="fl">1</span>] <span class="op">+</span> <span class="fl">2</span><span class="op">*</span>Œ¥</span>
<span id="cb22-7"><a href="#cb22-7"></a></span>
<span id="cb22-8"><a href="#cb22-8"></a>        <span class="co"># number of spiked of experimental trace</span></span>
<span id="cb22-9"><a href="#cb22-9"></a>        N_d<span class="op">::</span><span class="dt">Int64 </span><span class="op">=</span> <span class="fu">length</span>(experimental_peaks_t)</span>
<span id="cb22-10"><a href="#cb22-10"></a>        <span class="co"># number of spikes of model</span></span>
<span id="cb22-11"><a href="#cb22-11"></a>        N_m<span class="op">::</span><span class="dt">Int64 </span><span class="op">=</span> <span class="fu">length</span>(model_peaks_t)</span>
<span id="cb22-12"><a href="#cb22-12"></a>        <span class="co"># spike frequency model (in 1/ms, since it is multiplied by Œî ( = 4ms by default) in the return )</span></span>
<span id="cb22-13"><a href="#cb22-13"></a>        f_m<span class="op">::</span><span class="dt">Float64 </span><span class="op">=</span> N_m <span class="op">/</span> interval </span>
<span id="cb22-14"><a href="#cb22-14"></a></span>
<span id="cb22-15"><a href="#cb22-15"></a>        <span class="co"># Count coincidences</span></span>
<span id="cb22-16"><a href="#cb22-16"></a>        N_c<span class="op">::</span><span class="dt">Int64 </span><span class="op">=</span> <span class="fl">0</span> </span>
<span id="cb22-17"><a href="#cb22-17"></a></span>
<span id="cb22-18"><a href="#cb22-18"></a>        <span class="co"># details here: https://citeseerx.ist.psu.edu/document?repid=rep1&amp;type=pdf&amp;doi=675036bde791910851c7bf581ed7220e8f55ac53</span></span>
<span id="cb22-19"><a href="#cb22-19"></a>        <span class="cf">if</span> !<span class="fu">isempty</span>(model_peaks_t)</span>
<span id="cb22-20"><a href="#cb22-20"></a>            experimental_peaks_t_dc <span class="op">=</span> <span class="fu">deepcopy</span>(experimental_peaks_t)</span>
<span id="cb22-21"><a href="#cb22-21"></a>           </span>
<span id="cb22-22"><a href="#cb22-22"></a>            <span class="cf">for</span> sol_t <span class="kw">in</span> model_peaks_t</span>
<span id="cb22-23"><a href="#cb22-23"></a>                differences  <span class="op">=</span> <span class="fu">abs</span>.(experimental_peaks_t_dc <span class="op">.-</span>  sol_t)</span>
<span id="cb22-24"><a href="#cb22-24"></a>                min_index <span class="op">=</span> <span class="fu">argmin</span>(differences)</span>
<span id="cb22-25"><a href="#cb22-25"></a>                <span class="cf">if</span> differences[min_index] <span class="op">&lt;=</span> Œ¥</span>
<span id="cb22-26"><a href="#cb22-26"></a>                    <span class="fu">deleteat!</span>(experimental_peaks_t_dc, min_index)</span>
<span id="cb22-27"><a href="#cb22-27"></a>                    N_c <span class="op">+=</span> <span class="fl">1</span></span>
<span id="cb22-28"><a href="#cb22-28"></a>                    <span class="cf">if</span> <span class="fu">isempty</span>(experimental_peaks_t_dc)</span>
<span id="cb22-29"><a href="#cb22-29"></a>                        <span class="cf">break</span></span>
<span id="cb22-30"><a href="#cb22-30"></a>                    <span class="cf">end</span></span>
<span id="cb22-31"><a href="#cb22-31"></a>                <span class="cf">end</span></span>
<span id="cb22-32"><a href="#cb22-32"></a>            <span class="cf">end</span></span>
<span id="cb22-33"><a href="#cb22-33"></a>           </span>
<span id="cb22-34"><a href="#cb22-34"></a>        <span class="cf">end</span></span>
<span id="cb22-35"><a href="#cb22-35"></a></span>
<span id="cb22-36"><a href="#cb22-36"></a>        </span>
<span id="cb22-37"><a href="#cb22-37"></a>        <span class="cf">return</span> ( (N_c <span class="op">-</span> <span class="fl">2</span> <span class="op">*</span> f_m <span class="op">*</span> N_d <span class="op">*</span> Œ¥ ) <span class="op">/</span> (N_d <span class="op">+</span> N_m) ) <span class="op">*</span> ( <span class="fl">2</span> <span class="op">/</span> ( <span class="fl">1</span> <span class="op">-</span> <span class="fl">2</span> <span class="op">*</span> f_m <span class="op">*</span> Œ¥ )) </span>
<span id="cb22-38"><a href="#cb22-38"></a></span>
<span id="cb22-39"><a href="#cb22-39"></a>    <span class="kw">end</span></span>
<span id="cb22-40"><a href="#cb22-40"></a><span class="kw">end</span></span>
<span id="cb22-41"><a href="#cb22-41"></a></span>
<span id="cb22-42"><a href="#cb22-42"></a></span>
<span id="cb22-43"><a href="#cb22-43"></a><span class="co"># coincidence_factor. used to implement Xu2019: https://ieeexplore.ieee.org/document/8682825</span></span>
<span id="cb22-44"><a href="#cb22-44"></a><span class="kw">function</span> <span class="fu">coincidence_factor_loss_closure</span>(Œ¥<span class="op">::</span><span class="dt">Int64</span>)</span>
<span id="cb22-45"><a href="#cb22-45"></a>    coincidence_factor <span class="op">=</span> <span class="fu">coincidence_factor_closure</span>(Œ¥)</span>
<span id="cb22-46"><a href="#cb22-46"></a>    <span class="kw">function</span> <span class="fu">coincidence_factor_loss</span>(solution_peaks_t<span class="op">::</span><span class="dt">Vector{Float64}</span>, experimental_peaks_ts<span class="op">::</span><span class="dt">Vector{Vector{Float64}}</span>; intrinsic_reliability<span class="op">::</span><span class="dt">Float64 </span>) <span class="co"># interval::Float64 </span></span>
<span id="cb22-47"><a href="#cb22-47"></a></span>
<span id="cb22-48"><a href="#cb22-48"></a>        <span class="co"># Mean the coincidence factors between the simulation and all the sweeps</span></span>
<span id="cb22-49"><a href="#cb22-49"></a>        coincidence <span class="op">=</span> <span class="fu">mean</span>([<span class="fu">coincidence_factor</span>(experimental_peaks_t, solution_peaks_t) for experimental_peaks_t <span class="kw">in</span> experimental_peaks_ts])</span>
<span id="cb22-50"><a href="#cb22-50"></a></span>
<span id="cb22-51"><a href="#cb22-51"></a>        <span class="co"># return 1 - the coincidence factor, so it is coherent with minimization (rather than maximization). Recall that the coincidence factor is at most 1. Negative values indicate that the simulated sweep reproduces spike times more consistently than the physical neuron intrinsic reliability, thus we may confidently return 0.  </span></span>
<span id="cb22-52"><a href="#cb22-52"></a>        <span class="cf">return</span> <span class="fu">maximum</span>([<span class="fl">1.0</span> <span class="op">-</span> coincidence <span class="op">/</span> intrinsic_reliability, <span class="fl">0.0</span>])</span>
<span id="cb22-53"><a href="#cb22-53"></a></span>
<span id="cb22-54"><a href="#cb22-54"></a>    <span class="kw">end</span></span>
<span id="cb22-55"><a href="#cb22-55"></a><span class="kw">end</span></span>
<span id="cb22-56"><a href="#cb22-56"></a></span>
<span id="cb22-57"><a href="#cb22-57"></a><span class="co"># Evaluation on electrophysiological recordings</span></span>
<span id="cb22-58"><a href="#cb22-58"></a><span class="fu">coincidence_factor_evaluation_on_sweep</span>(ephys_sfe<span class="op">::</span><span class="dt">PyObject</span>) <span class="op">=</span> ephys_sfe.<span class="fu">spike_feature</span>(<span class="st">"peak_t"</span>) <span class="op">.*</span> <span class="fl">1e3</span></span>
<span id="cb22-59"><a href="#cb22-59"></a></span>
<span id="cb22-60"><a href="#cb22-60"></a><span class="co"># Evaluation on model simulation</span></span>
<span id="cb22-61"><a href="#cb22-61"></a><span class="fu">coincidence_factor_evaluation_on_sweep</span>(sol<span class="op">::</span><span class="dt">OrdinaryDiffEq.ODESolution</span>) <span class="op">=</span> sol.prob.p[<span class="fl">1</span>]</span>
<span id="cb22-62"><a href="#cb22-62"></a></span>
<span id="cb22-63"><a href="#cb22-63"></a><span class="co"># Evaluate target and intrinsic variability</span></span>
<span id="cb22-64"><a href="#cb22-64"></a><span class="kw">function</span> <span class="fu">coincidence_factor_target_lossKwargs_evaluationKwargs_evaluation_on_typeAmplitude_closure</span>(Œ¥<span class="op">::</span><span class="dt">Int64</span>)</span>
<span id="cb22-65"><a href="#cb22-65"></a></span>
<span id="cb22-66"><a href="#cb22-66"></a>    coincidence_factor <span class="op">=</span> <span class="fu">coincidence_factor_closure</span>(Œ¥)</span>
<span id="cb22-67"><a href="#cb22-67"></a></span>
<span id="cb22-68"><a href="#cb22-68"></a>    <span class="kw">function</span> <span class="fu">coincidence_factor_target_lossKwargs_evaluationKwargs_evaluation_on_typeAmplitude</span>(ephys_sfes<span class="op">::</span><span class="dt">Vector{PyObject}</span>)</span>
<span id="cb22-69"><a href="#cb22-69"></a></span>
<span id="cb22-70"><a href="#cb22-70"></a>        experimental_peaks_ts <span class="op">=</span> <span class="fu">coincidence_factor_evaluation_on_sweep</span>.(ephys_sfes) </span>
<span id="cb22-71"><a href="#cb22-71"></a>        experimental_coincidence_factors <span class="op">=</span> [<span class="fu">coincidence_factor</span>(experimental_spike_times_1, experimental_spike_times_2) for (experimental_spike_times_1,experimental_spike_times_2) <span class="kw">in</span> <span class="bu">Iterators</span>.<span class="fu">product</span>(experimental_peaks_ts,experimental_peaks_ts)]</span>
<span id="cb22-72"><a href="#cb22-72"></a></span>
<span id="cb22-73"><a href="#cb22-73"></a>        intrinsic_reliability <span class="op">=</span> <span class="fu">mean</span>(experimental_coincidence_factors)</span>
<span id="cb22-74"><a href="#cb22-74"></a></span>
<span id="cb22-75"><a href="#cb22-75"></a>        <span class="cf">return</span> experimental_peaks_ts, (intrinsic_reliability <span class="op">=</span> intrinsic_reliability,), ()</span>
<span id="cb22-76"><a href="#cb22-76"></a></span>
<span id="cb22-77"><a href="#cb22-77"></a>    <span class="kw">end</span></span>
<span id="cb22-78"><a href="#cb22-78"></a><span class="kw">end</span></span>
<span id="cb22-79"><a href="#cb22-79"></a></span>
<span id="cb22-80"><a href="#cb22-80"></a><span class="co"># Instantiate the features which depends on the interval Œ¥ (msec)</span></span>
<span id="cb22-81"><a href="#cb22-81"></a><span class="fu">coincidence_factor_msec</span>(Œ¥<span class="op">::</span><span class="dt">Int64 </span><span class="op">=</span> <span class="fl">2</span>) <span class="op">=</span> <span class="fu">ElectrophysiologicalFeature</span>(</span>
<span id="cb22-82"><a href="#cb22-82"></a>                            <span class="st">"coincidence_factor_msec"</span>,</span>
<span id="cb22-83"><a href="#cb22-83"></a>                            <span class="fl">1e-3</span>,</span>
<span id="cb22-84"><a href="#cb22-84"></a>                            coincidence_factor_evaluation_on_sweep,</span>
<span id="cb22-85"><a href="#cb22-85"></a>                            <span class="fu">coincidence_factor_target_lossKwargs_evaluationKwargs_evaluation_on_typeAmplitude_closure</span>(Œ¥), <span class="co">#ephys_sfe::PyObject -&gt; ephys_sfe.spike_feature("peak_t") .* 1e3,</span></span>
<span id="cb22-86"><a href="#cb22-86"></a>                            <span class="fu">coincidence_factor_loss_closure</span>(Œ¥),</span>
<span id="cb22-87"><a href="#cb22-87"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="overview-features-4" class="slide level2 smaller scrollable">
<h2>Overview: Features #4</h2>
<p>Other implemented features are:</p>
<ul>
<li><p>Well established:</p>
<ul>
<li>allen_action_potential_peak_mV;</li>
<li>allen_fast_trough_depth_mV;</li>
<li>allen_slow_troughs_depth_mV;</li>
<li>allen_time_of_slow_troughs_fraction;</li>
<li>allen_AP_width_hh_msec;</li>
<li>allen_resting_potential_mV;</li>
<li>allen_latency_to_first_spike_msec;</li>
<li>allen_duration_of_first_isi_msec;</li>
<li>allen_isi_cv;</li>
<li>allen_adaptation_index;</li>
<li>allen_average_isi_msec;</li>
<li>allen_last_spike_latency_msec;</li>
<li>slope_after_stim_mV_msec;</li>
<li>custom_ISI_log_slope_msec;</li>
<li>spike_height_slope_mV;</li>
<li>slow_troughs_slope_mV;</li>
</ul></li>
<li><p>Experimental:</p>
<ul>
<li>phase_plane_trajectory;</li>
<li>phase_plane_trajectory_druck;</li>
<li>custom_voltage_base_mV_druck;</li>
<li>custom_voltage_base_mV_l2;</li>
<li>custom_voltage_base_mV_mean;</li>
<li>custom_voltage_after_stim_mV_druck;</li>
<li>custom_voltage_after_stim_mV_l2;</li>
<li>custom_voltage_after_stim_mV_mean;</li>
<li>custom_steady_state_voltage_stimend_mV_druck;</li>
<li>custom_steady_state_voltage_stimend_mV_l2;</li>
<li>custom_steady_state_voltage_stimend_mV_mean;</li>
</ul></li>
</ul>
</section>
<section id="overview-associations-1" class="slide level2 smaller">
<h2>Overview: Associations #1</h2>
<ul>
<li>Different <code>Type_Amplitude</code>s may be calibrated w.r.t. different <code>Feature</code>s;</li>
</ul>
<div class="fragment">
<ul>
<li>E.g. it would make sense to calibrate the slope of the slow throughs w.r.t a ramp input, less so for a square input where such coefficient should be 0;</li>
</ul>
</div>
<div class="fragment">
<ul>
<li>Thus, the <code>Association</code> struct has been implemented to perform such assignments:</li>
</ul>
<div class="sourceCode" id="cb23"><pre class="sourceCode numberSource julia number-lines code-with-copy"><code class="sourceCode julia"><span id="cb23-1"><a href="#cb23-1"></a><span class="kw">struct</span> Association <span class="op">&lt;:</span><span class="dt"> AbstractData</span></span>
<span id="cb23-2"><a href="#cb23-2"></a>    name<span class="op">::</span><span class="dt">String</span></span>
<span id="cb23-3"><a href="#cb23-3"></a>    data<span class="op">::</span><span class="dt">Type_Amplitude</span></span>
<span id="cb23-4"><a href="#cb23-4"></a>    features<span class="op">::</span><span class="dt">Tuple{Vararg{ElectrophysiologicalFeature}}</span></span>
<span id="cb23-5"><a href="#cb23-5"></a>    objectives_combinations<span class="op">::</span><span class="dt">Dict{&lt;:Tuple{Vararg{String}},&lt;:Function}</span></span>
<span id="cb23-6"><a href="#cb23-6"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="fragment">
<ul>
<li>The <code>objectives_combinations</code> tells the inner functions how to combine losses associated sets of features of related semantics, as in <a href="https://journals.plos.org/ploscompbiol/article?id=10.1371/journal.pcbi.1002107#s5">Hay 2011</a> (supporting <a href="https://view.officeapps.live.com/op/view.aspx?src=https%3A%2F%2Fstorage.googleapis.com%2Fplos-corpus-prod%2F10.1371%2Fjournal.pcbi.1002107%2F1%2Fpcbi.1002107.s010.doc%3FX-Goog-Algorithm%3DGOOG4-RSA-SHA256%26X-Goog-Credential%3Dwombat-sa%2540plos-prod.iam.gserviceaccount.com%252F20230611%252Fauto%252Fstorage%252Fgoog4_request%26X-Goog-Date%3D20230611T174507Z%26X-Goog-Expires%3D86400%26X-Goog-SignedHeaders%3Dhost%26X-Goog-Signature%3D7cfbbdf952e769f5c51c6fcd4f61c01081dd2b1113222e08ebeceb92596c6cda4158208df4100cfba21216dd2db8f5a1709305746b6d24f465dd176dfa69a4055d45ed4b4f2938876a2b434bfb925adf70f7dfbeecbe24d05f8e26630703880fe87a6c16a018d381d8edf7daf19c27ca284d90c4e96d94c5b5d91131c8e90d50955cc54255ef9b6b8437f1764b3f51f28dbf56d0388917477619c84942f6e69dcea9d4a336f86a3d239976864d8b61cca122d9f5c9468fe59c0610575ef447eab7266c7e61f5e2d6ed6507817570ebc8b3638f5e0e20a1bc2f8cfc429f9cbcacb6649c3a2a55707eba07fc2015a821d94cb7cef83d7249da9f74999ad9cb0f44&amp;wdOrigin=BROWSELINK">Text S2</a>)</li>
</ul>
</div>
</section>
<section id="overview-associations-2" class="slide level2">
<h2>Overview: Associations #2</h2>
<p>Example <code>Association</code>s:</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode numberSource julia number-lines code-with-copy"><code class="sourceCode julia"><span id="cb24-1"><a href="#cb24-1"></a><span class="kw">const</span> cell_dataset <span class="op">=</span> <span class="fu">get_cell_dataset</span>(manifest_path,<span class="fl">488697163</span>)</span>
<span id="cb24-2"><a href="#cb24-2"></a></span>
<span id="cb24-3"><a href="#cb24-3"></a><span class="co"># Square</span></span>
<span id="cb24-4"><a href="#cb24-4"></a><span class="kw">const</span> square_110pA           <span class="op">=</span> cell_dataset[<span class="st">"data"</span>][<span class="st">"square - 2s suprathreshold"</span>][<span class="st">"110.0 pA"</span>];</span>
<span id="cb24-5"><a href="#cb24-5"></a></span>
<span id="cb24-6"><a href="#cb24-6"></a><span class="kw">const</span> square_features <span class="op">=</span> (<span class="fu">allen_firing_frequency_Hz</span>(),<span class="fu">allen_resting_potential_mV</span>(), <span class="fu">allen_latency_to_first_spike_msec</span>(),<span class="fu">allen_last_spike_latency_msec</span>(),<span class="fu">allen_average_isi_msec</span>(), <span class="fu">allen_slow_troughs_depth_mV</span>(), <span class="fu">coincidence_factor_msec</span>(<span class="fl">2</span>))</span>
<span id="cb24-7"><a href="#cb24-7"></a></span>
<span id="cb24-8"><a href="#cb24-8"></a><span class="kw">const</span> square_110_allen_association <span class="op">=</span> <span class="fu">Association</span>(<span class="st">"square_110_allen_association"</span>,square_110pA, square_features)</span>
<span id="cb24-9"><a href="#cb24-9"></a></span>
<span id="cb24-10"><a href="#cb24-10"></a><span class="co"># Ramp</span></span>
<span id="cb24-11"><a href="#cb24-11"></a><span class="kw">const</span> ramp_800pA <span class="op">=</span> <span class="fu">get_type_amplitude</span>(cell_dataset, <span class="st">"ramp"</span>, <span class="st">"800.0 pA"</span>)</span>
<span id="cb24-12"><a href="#cb24-12"></a></span>
<span id="cb24-13"><a href="#cb24-13"></a><span class="kw">const</span> ramp_features <span class="op">=</span> (<span class="fu">allen_firing_frequency_Hz</span>(),<span class="fu">allen_resting_potential_mV</span>(), <span class="fu">allen_latency_to_first_spike_msec</span>(),<span class="fu">allen_last_spike_latency_msec</span>(),<span class="fu">allen_average_isi_msec</span>(), <span class="fu">allen_slow_troughs_depth_mV</span>(), <span class="fu">coincidence_factor_msec</span>(<span class="fl">2</span>), <span class="fu">slow_troughs_slope_mV</span>())</span>
<span id="cb24-14"><a href="#cb24-14"></a></span>
<span id="cb24-15"><a href="#cb24-15"></a><span class="kw">const</span> ramp_800_allen_association <span class="op">=</span> <span class="fu">Association</span>(<span class="st">"ramp_800_allen_association"</span>,ramp_800pA, ramp_features)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="overview-calibration-pattern-1" class="slide level2 smaller">
<h2>Overview: Calibration Pattern #1</h2>
<ul>
<li>The model has <code>Parameter</code>s and <code>Initial_Condition</code>s. Since either of them may be tuned, they both subtype <code>Calibratable</code>:</li>
</ul>
<div class="sourceCode" id="cb25"><pre class="sourceCode numberSource julia number-lines code-with-copy"><code class="sourceCode julia"><span id="cb25-1"><a href="#cb25-1"></a><span class="kw">abstract type</span> Calibratable{T,P} <span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb26"><pre class="sourceCode numberSource julia number-lines code-with-copy"><code class="sourceCode julia"><span id="cb26-1"><a href="#cb26-1"></a><span class="kw">mutable struct</span> Parameter{T,P} <span class="op">&lt;:</span><span class="dt"> AbstractParameter{T,P}</span></span>
<span id="cb26-2"><a href="#cb26-2"></a>    name<span class="op">::</span><span class="dt">String</span></span>
<span id="cb26-3"><a href="#cb26-3"></a>    value<span class="op">::</span><span class="dt">T</span></span>
<span id="cb26-4"><a href="#cb26-4"></a>    prior<span class="op">::</span><span class="dt">P</span></span>
<span id="cb26-5"><a href="#cb26-5"></a>    calibratable<span class="op">::</span><span class="dt">Bool</span></span>
<span id="cb26-6"><a href="#cb26-6"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb27"><pre class="sourceCode numberSource julia number-lines code-with-copy"><code class="sourceCode julia"><span id="cb27-1"><a href="#cb27-1"></a><span class="kw">mutable struct</span> Initial_Condition{T,P} <span class="op">&lt;:</span><span class="dt"> AbstractInitialCondition{T,P}</span></span>
<span id="cb27-2"><a href="#cb27-2"></a>    name<span class="op">::</span><span class="dt">String</span></span>
<span id="cb27-3"><a href="#cb27-3"></a>    value<span class="op">::</span><span class="dt">T</span></span>
<span id="cb27-4"><a href="#cb27-4"></a>    prior<span class="op">::</span><span class="dt">P</span></span>
<span id="cb27-5"><a href="#cb27-5"></a>    calibratable<span class="op">::</span><span class="dt">Bool</span></span>
<span id="cb27-6"><a href="#cb27-6"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="fragment">
<ul>
<li>All model <code>Parameter</code>s and <code>Initial_Condition</code>s form a <code>Configuration</code>:</li>
</ul>
<div class="sourceCode" id="cb28"><pre class="sourceCode numberSource julia number-lines code-with-copy"><code class="sourceCode julia"><span id="cb28-1"><a href="#cb28-1"></a><span class="kw">struct</span> Configuration <span class="op">&lt;:</span><span class="dt"> AbstractConfiguration</span></span>
<span id="cb28-2"><a href="#cb28-2"></a>    initial_conditions<span class="op">::</span><span class="dt">Union{ Nothing, Array{&lt;:Initial_Condition} }</span></span>
<span id="cb28-3"><a href="#cb28-3"></a>    parameters<span class="op">::</span><span class="dt">Array{&lt;:Parameter}</span></span>
<span id="cb28-4"><a href="#cb28-4"></a>    model_posterior<span class="op">::</span><span class="dt">Model_Posterior</span></span>
<span id="cb28-5"><a href="#cb28-5"></a><span class="kw">end</span></span>
<span id="cb28-6"><a href="#cb28-6"></a><span class="co"># Where the `Model_Posterior` is the joint posterior over parameters and initial conditions</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="overview-calibration-pattern-2" class="slide level2 smaller">
<h2>Overview: Calibration Pattern #2</h2>
<ul>
<li>The optimization algorithm and/or method and calibration metadata are specified in the <code>Step</code> struct from <code>ModelingFramework.jl</code>:</li>
</ul>
<div class="sourceCode" id="cb29"><pre class="sourceCode numberSource julia number-lines code-with-copy"><code class="sourceCode julia"><span id="cb29-1"><a href="#cb29-1"></a><span class="kw">mutable struct</span> Step <span class="op">&lt;:</span><span class="dt"> AbstractStep</span></span>
<span id="cb29-2"><a href="#cb29-2"></a>    name<span class="op">::</span><span class="dt">String     </span><span class="co"># The name of the step. It is used as a key in the Calibration_History of the model</span></span>
<span id="cb29-3"><a href="#cb29-3"></a>    method<span class="op">::</span><span class="dt">Function </span><span class="co"># The step method. It must have signature (data::D, Model::M; kwargs...) where {D &lt;: Tuple{Vararg{&lt;:AbstractData}}, M &lt;: AbstractModel}, and must return a valid Configuration.</span></span>
<span id="cb29-4"><a href="#cb29-4"></a>    kwargs           <span class="co"># Step kwargs. It is a NamedTuple containing all extra named arguments to be passed to Step.method</span></span>
<span id="cb29-5"><a href="#cb29-5"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="fragment">
<ul>
<li><code>Parameter</code>s and <code>Initial_Condition</code>s‚Äô priors are allowed to change between <code>Phase</code>s, which also serve as collection of <code>Step</code>s. For neuronal models, usually just one <code>Phase</code> is enough:</li>
</ul>
<div class="sourceCode" id="cb30"><pre class="sourceCode numberSource julia number-lines code-with-copy"><code class="sourceCode julia"><span id="cb30-1"><a href="#cb30-1"></a><span class="kw">mutable struct</span> Phase{S <span class="op">&lt;:</span><span class="dt"> Tuple{Vararg{&lt;:AbstractStep}}</span>, D <span class="op">&lt;:</span><span class="dt"> Union{Nothing,Tuple{Vararg{&lt;:AbstractData}}} </span>} <span class="op">&lt;:</span><span class="dt"> AbstractPhase</span></span>
<span id="cb30-2"><a href="#cb30-2"></a>    name<span class="op">::</span><span class="dt">String</span></span>
<span id="cb30-3"><a href="#cb30-3"></a>    steps<span class="op">::</span><span class="dt">S</span></span>
<span id="cb30-4"><a href="#cb30-4"></a>    priors<span class="op">::</span><span class="dt">Vector{&lt;:Union{&lt;: Nothing, &lt;: Distribution{Univariate, Continuous}, &lt;: BallTreeDensity} }</span></span>
<span id="cb30-5"><a href="#cb30-5"></a>    start<span class="op">::</span><span class="dt">Union{Nothing,Float64}</span></span>
<span id="cb30-6"><a href="#cb30-6"></a>    finish<span class="op">::</span><span class="dt">Union{Nothing,Float64}</span></span>
<span id="cb30-7"><a href="#cb30-7"></a>    time_scale<span class="op">::</span><span class="dt">Union{Nothing,Float64}</span></span>
<span id="cb30-8"><a href="#cb30-8"></a>    data<span class="op">::</span><span class="dt">D </span><span class="co"># For multiphase calibration</span></span>
<span id="cb30-9"><a href="#cb30-9"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="overview-calibration-pattern-3" class="slide level2 smaller">
<h2>Overview: Calibration Pattern #3</h2>
<p>An example of a <code>Step</code>‚Äôs method that uses the BORG-MOEA algorithm to perform multi-objective evolutionary calibration:</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode numberSource julia number-lines code-with-copy"><code class="sourceCode julia"><span id="cb31-1"><a href="#cb31-1"></a><span class="kw">function</span> <span class="fu">bbo_borgmoea_method</span>(associations<span class="op">::</span><span class="dt">Tuple{Vararg{Association}}</span>,</span>
<span id="cb31-2"><a href="#cb31-2"></a>                             model<span class="op">::</span><span class="dt">M</span>; </span>
<span id="cb31-3"><a href="#cb31-3"></a>                             variable_parameters_names<span class="op">::</span><span class="dt">Vector{String}</span>, </span>
<span id="cb31-4"><a href="#cb31-4"></a>                             save_idxs<span class="op">::</span><span class="dt">Vector{Int64}</span>, </span>
<span id="cb31-5"><a href="#cb31-5"></a>                             modelingtoolkit<span class="op">::</span><span class="dt">Bool </span><span class="op">=</span> <span class="cn">true</span>, </span>
<span id="cb31-6"><a href="#cb31-6"></a>                             cell_dataset_optimization<span class="op">::</span><span class="dt">Cell_Dataset_Optimization </span><span class="op">=</span> <span class="fu">Cell_Dataset_Optimization</span>( trimming <span class="op">=</span> <span class="cn">false</span>, mode <span class="op">=</span> <span class="cn">nothing</span>), plot_optimized_sweeps<span class="op">::</span><span class="dt">Bool </span><span class="op">=</span> <span class="cn">false</span>, </span>
<span id="cb31-7"><a href="#cb31-7"></a>                             maxtime <span class="op">=</span> <span class="fl">1</span>, </span>
<span id="cb31-8"><a href="#cb31-8"></a>                             populationsize <span class="op">=</span> <span class="fl">10</span><span class="op">*</span> <span class="fu">length</span>(<span class="fu">unique</span>(<span class="fu">combine_objectives_names</span>(associations))),</span>
<span id="cb31-9"><a href="#cb31-9"></a>                             verbose<span class="op">::</span><span class="dt">Bool </span><span class="op">=</span> <span class="cn">false</span> ) <span class="kw">where</span> {M<span class="op">&lt;:</span><span class="dt"> Union{HH_model, IFModel}</span>}</span>
<span id="cb31-10"><a href="#cb31-10"></a></span>
<span id="cb31-11"><a href="#cb31-11"></a>    <span class="co"># Group parameters into variable and fixed sets</span></span>
<span id="cb31-12"><a href="#cb31-12"></a>    all_parameters_names <span class="op">=</span>  <span class="fu">get_last_parameters_names</span>(model.calibration_history)</span>
<span id="cb31-13"><a href="#cb31-13"></a>    variable_parameters <span class="op">=</span>  <span class="fu">select_calibratables</span>(<span class="fu">get_last_parameters</span>(model.calibration_history),variable_parameters_names) </span>
<span id="cb31-14"><a href="#cb31-14"></a>    variable_parameters_indexes <span class="op">=</span> [<span class="fu">findfirst</span>(all_sym <span class="op">-&gt;</span> all_sym <span class="op">==</span> var_sym, all_parameters_names  ) for var_sym <span class="kw">in</span> variable_parameters_names ]</span>
<span id="cb31-15"><a href="#cb31-15"></a>    fixed_parameters_indexes <span class="op">=</span> <span class="fu">setdiff</span>(<span class="fu">collect</span>(<span class="fl">1</span><span class="op">:</span><span class="fu">length</span>(all_parameters_names)), variable_parameters_indexes )</span>
<span id="cb31-16"><a href="#cb31-16"></a>    fixed_parameters_values<span class="op">=</span> <span class="fu">get_calibratables_values</span>( <span class="fu">select_calibratables</span>(<span class="fu">get_last_parameters</span>(model.calibration_history),<span class="fu">setdiff</span>(all_parameters_names,variable_parameters_names))  )</span>
<span id="cb31-17"><a href="#cb31-17"></a>    variable_parameters_bounds<span class="op">::</span><span class="dt">Vector{Tuple{Float64, Float64}} </span><span class="op">=</span> [<span class="fu">get_bounds_from_prior</span>(prior, (<span class="fl">0.0</span>,<span class="fl">1.0</span>)) for prior <span class="kw">in</span> <span class="fu">get_calibratables_priors</span>(variable_parameters)]</span>
<span id="cb31-18"><a href="#cb31-18"></a></span>
<span id="cb31-19"><a href="#cb31-19"></a>    <span class="co"># Instantiate the loss. Note that in the "borg_moea" case, it is generated run time in order fo it to be type-stable;</span></span>
<span id="cb31-20"><a href="#cb31-20"></a>    <span class="co"># `modelingtoolkit` controls symbolic rewriting of the deterministic_dynamics of the model to improve performance;</span></span>
<span id="cb31-21"><a href="#cb31-21"></a>    <span class="co"># `cell_dataset_optimization` controls sweep truncation (and other deprecated behaviors) to improve performance;</span></span>
<span id="cb31-22"><a href="#cb31-22"></a>    loss_neuro <span class="op">=</span> <span class="fu">neuron_optim_loss_closure</span>(model, associations, variable_parameters_names,  save_idxs, <span class="st">"borg_moea"</span>; modelingtoolkit <span class="op">=</span> modelingtoolkit, cell_dataset_optimization  <span class="op">=</span> cell_dataset_optimization, plot_optimized_sweeps <span class="op">=</span>  plot_optimized_sweeps, verbose <span class="op">=</span> verbose)</span>
<span id="cb31-23"><a href="#cb31-23"></a></span>
<span id="cb31-24"><a href="#cb31-24"></a>    <span class="co"># Launch multi-threaded calibration. The BORG-MOEA algorithm will auto-tune its hyperparameters, making it a suitable choice for black-box optimization</span></span>
<span id="cb31-25"><a href="#cb31-25"></a>    dimensions <span class="op">=</span> <span class="fu">length</span>(<span class="fu">unique</span>(<span class="fu">combine_objectives_names</span>(associations)))</span>
<span id="cb31-26"><a href="#cb31-26"></a>    res <span class="op">=</span> <span class="fu">bboptimize</span>(   loss_neuro; Method<span class="op">=:</span>borg_moea, FitnessScheme<span class="op">=</span><span class="fu">ParetoFitnessScheme</span><span class="dt">{dimensions}</span>(is_minimizing<span class="op">=</span><span class="cn">true</span>), SearchRange<span class="op">=</span>variable_parameters_bounds, œµ<span class="op">=</span><span class="fl">0.05</span>, TraceInterval<span class="op">=</span><span class="fl">1.0</span>, TraceMode<span class="op">=:</span>verbose, MaxTime <span class="op">=</span> maxtime, PopulationSize <span class="op">=</span> populationsize, NThreads<span class="op">=</span><span class="bu">Threads</span>.<span class="fu">nthreads</span>()<span class="op">-</span><span class="fl">1</span>  );</span>
<span id="cb31-27"><a href="#cb31-27"></a></span>
<span id="cb31-28"><a href="#cb31-28"></a>    <span class="co"># Construct and return new Configuration</span></span>
<span id="cb31-29"><a href="#cb31-29"></a>    all_calibrated_parameters_values <span class="op">=</span> [couple[<span class="fl">2</span>] for couple <span class="kw">in</span> <span class="fu">sort</span>(<span class="fu">collect</span>(<span class="fu">zip</span>(<span class="fu">vcat</span>(fixed_parameters_indexes, variable_parameters_indexes), <span class="fu">vcat</span>(fixed_parameters_values, <span class="fu">best_candidate</span>(res)))); by<span class="op">=</span>first)]</span>
<span id="cb31-30"><a href="#cb31-30"></a>    all_calibrated_parameters        <span class="op">=</span> <span class="fu">change_values</span>(<span class="fu">get_last_parameters</span>(model.calibration_history),all_calibrated_parameters_values)</span>
<span id="cb31-31"><a href="#cb31-31"></a>    previous_model_posterior         <span class="op">=</span> <span class="fu">get_last_model_posterior</span>(model.calibration_history)</span>
<span id="cb31-32"><a href="#cb31-32"></a>    new_model_posterior              <span class="op">=</span> <span class="fu">Model_Posterior</span>([<span class="fu">Ordered_Multivariate</span>(<span class="fu">point_distribution</span>(par.value), [par.name] ) for par <span class="kw">in</span> all_calibrated_parameters if par.calibratable ], previous_model_posterior.initial_conditions_size, previous_model_posterior.parameters_size  )</span>
<span id="cb31-33"><a href="#cb31-33"></a>    new_configuration                <span class="op">=</span> <span class="fu">Configuration</span>(<span class="fu">get_last_initial_conditions</span>(model.calibration_history),all_calibrated_parameters, new_model_posterior)</span>
<span id="cb31-34"><a href="#cb31-34"></a></span>
<span id="cb31-35"><a href="#cb31-35"></a>    <span class="cf">return</span> ((res <span class="op">=</span> res,), new_configuration)</span>
<span id="cb31-36"><a href="#cb31-36"></a></span>
<span id="cb31-37"><a href="#cb31-37"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="overview-calibration-pattern-4" class="slide level2 smaller">
<h2>Overview: Calibration Pattern #4</h2>
<ul>
<li>So the main <code>Step</code> will be constructed as:</li>
</ul>
<div class="sourceCode" id="cb32"><pre class="sourceCode numberSource julia number-lines code-with-copy"><code class="sourceCode julia"><span id="cb32-1"><a href="#cb32-1"></a>borgmoea_step <span class="op">=</span> <span class="fu">Step</span>( <span class="st">"borgmoea_step"</span>, bbo_borgmoea_method, kwargs<span class="op">...</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="fragment">
<ul>
<li>We furthermore define some simpler <code>Step</code>s that will set a few parameters as they can be measured directly from the electrophysiological recordings:</li>
</ul>
<div class="sourceCode" id="cb33"><pre class="sourceCode numberSource julia number-lines code-with-copy"><code class="sourceCode julia"><span id="cb33-1"><a href="#cb33-1"></a>fix_urest_step <span class="op">=</span> <span class="fu">Step</span>(<span class="st">"fix_urest_step"</span>, fix_calibratable_method, (variable_parameter_name <span class="op">=</span> <span class="st">"u_rest"</span>, feature <span class="op">=</span> <span class="fu">allen_resting_potential_mV</span>()))</span>
<span id="cb33-2"><a href="#cb33-2"></a>fix_V_th_step  <span class="op">=</span> <span class="fu">Step</span>(<span class="st">"fix_V_th_step"</span>,  fix_calibratable_method, (variable_parameter_name <span class="op">=</span> <span class="st">"V_th"</span>,   feature <span class="op">=</span> <span class="fu">allen_action_potential_peak_mV</span>()))</span>
<span id="cb33-3"><a href="#cb33-3"></a>fix_u_r_step   <span class="op">=</span> <span class="fu">Step</span>(<span class="st">"fix_u_r_step"</span>,   fix_calibratable_method, (variable_parameter_name <span class="op">=</span> <span class="st">"u_r"</span>,    feature <span class="op">=</span> <span class="fu">allen_fast_trough_depth_mV</span>()))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="fragment">
<ul>
<li>In this setting, calibration is initiated via:</li>
</ul>
<div class="sourceCode" id="cb34"><pre class="sourceCode numberSource julia number-lines code-with-copy"><code class="sourceCode julia"><span id="cb34-1"><a href="#cb34-1"></a><span class="fu">multi_step_calibration!</span>((square_110_allen_association,), AdEx, (fix_urest_step, fix_V_th_step, fix_u_r_step, bbo_borgmoea_step))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="overview-calibration-pattern-5" class="slide level2 smaller">
<h2>Overview: Calibration Pattern #5</h2>
<p>A <code>Step_Record</code> object si created every time a calibration <code>Step</code> is completed:</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode numberSource julia number-lines code-with-copy"><code class="sourceCode julia"><span id="cb35-1"><a href="#cb35-1"></a><span class="kw">struct</span> Step_Record{T <span class="op">&lt;:</span><span class="dt"> Union{Nothing,AbstractStep} </span>} <span class="op">&lt;:</span><span class="dt"> AbstractStepRecord</span></span>
<span id="cb35-2"><a href="#cb35-2"></a>    step<span class="op">::</span><span class="dt">T</span></span>
<span id="cb35-3"><a href="#cb35-3"></a>    configuration<span class="op">::</span><span class="dt">Configuration</span></span>
<span id="cb35-4"><a href="#cb35-4"></a>    extras<span class="op">::</span><span class="dt">NamedTuple</span></span>
<span id="cb35-5"><a href="#cb35-5"></a><span class="kw">end</span></span>
<span id="cb35-6"><a href="#cb35-6"></a><span class="co"># The `configuration` field contains the new model Configuration after the `step` has been performed.</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="fragment">
<p><code>Step_Record</code>s are then collected in <code>Phase_Record</code>s (usually neuronal models only have one phase and thus one <code>Phase_Record</code>):</p>
<div class="sourceCode" id="cb36"><pre class="sourceCode numberSource julia number-lines code-with-copy"><code class="sourceCode julia"><span id="cb36-1"><a href="#cb36-1"></a><span class="kw">mutable struct</span> Phase_Record{P <span class="op">&lt;:</span><span class="dt"> Union{Nothing,AbstractPhase} </span>} <span class="op">&lt;:</span><span class="dt"> AbstractPhaseRecord</span></span>
<span id="cb36-2"><a href="#cb36-2"></a>    phase<span class="op">::</span><span class="dt">P</span></span>
<span id="cb36-3"><a href="#cb36-3"></a>    steps_records<span class="op">::</span><span class="dt">OrderedDict{&lt;: String, &lt;: AbstractStepRecord}</span></span>
<span id="cb36-4"><a href="#cb36-4"></a>    extras<span class="op">::</span><span class="dt">NamedTuple</span></span>
<span id="cb36-5"><a href="#cb36-5"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="fragment">
<p>Whose collection constitutes the model‚Äôs <code>Calibration_History</code>:</p>
<div class="sourceCode" id="cb37"><pre class="sourceCode numberSource julia number-lines code-with-copy"><code class="sourceCode julia"><span id="cb37-1"><a href="#cb37-1"></a><span class="kw">mutable struct</span> Calibration_History <span class="op">&lt;:</span><span class="dt"> AbstractCalibrationHistory</span></span>
<span id="cb37-2"><a href="#cb37-2"></a>    phases_records<span class="op">::</span><span class="dt">OrderedDict{&lt;:String,&lt;:Phase_Record}</span></span>
<span id="cb37-3"><a href="#cb37-3"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>That contains all <code>Configuration</code>s saved at every <code>Step</code> of every <code>Phase</code>.</p>
</div>
</section></section>
<section>
<section id="neuronalmodelling.jl-2" class="title-slide slide level1 center">
<h1><span class="semi-transparent">NeuronalModelling.jl</span></h1>
<ol type="1">
<li><p><span class="semi-transparent">Why Julia?</span></p></li>
<li><p><span class="semi-transparent">Overview;</span></p></li>
<li><p>Demonstration:</p>
<p>3.1 First Example;</p>
<p>3.2 Second Example.</p></li>
<li><p><span class="semi-transparent">Future developments;</span></p></li>
</ol>
</section>
<section id="demonstration-first-example-1" class="slide level2 smaller">
<h2>Demonstration: First Example #1</h2>
<p>A complete example where we calibrate on <code>square_110pA</code> (for around 15 minutes) and test on <code>square_150pA</code>:</p>
<div class="sourceCode" id="cb38"><pre class="sourceCode numberSource julia number-lines code-with-copy"><code class="sourceCode julia"><span id="cb38-1"><a href="#cb38-1"></a><span class="im">using</span> <span class="bu">NeuronalModeling</span></span>
<span id="cb38-2"><a href="#cb38-2"></a></span>
<span id="cb38-3"><a href="#cb38-3"></a><span class="kw">const</span> manifest_path <span class="op">=</span> <span class="st">"path/to/allensdk/manifest"</span></span>
<span id="cb38-4"><a href="#cb38-4"></a></span>
<span id="cb38-5"><a href="#cb38-5"></a><span class="kw">const</span> initial_parameters_values_AdEx <span class="op">=</span> <span class="fu">collect</span>(<span class="fu">values</span>(NeuronalModeling.initial_parameters_values_AdEx_dict))</span>
<span id="cb38-6"><a href="#cb38-6"></a><span class="kw">const</span> parameters_priors_AdEx <span class="op">=</span> <span class="fu">get_uniform_priors</span>(initial_parameters_values_AdEx, range <span class="op">=</span> <span class="fl">1</span> )</span>
<span id="cb38-7"><a href="#cb38-7"></a></span>
<span id="cb38-8"><a href="#cb38-8"></a><span class="kw">const</span> cell_dataset <span class="op">=</span> <span class="fu">get_cell_dataset</span>(manifest_path,<span class="fl">488697163</span>)</span>
<span id="cb38-9"><a href="#cb38-9"></a></span>
<span id="cb38-10"><a href="#cb38-10"></a><span class="co"># Plot Sweeps and Input corresponding to a Type_Amplitude</span></span>
<span id="cb38-11"><a href="#cb38-11"></a>p_sweeps_square, p_input_square  <span class="op">=</span> <span class="fu">plot_type_amplitude</span>(cell_dataset[<span class="st">"data"</span>][<span class="st">"square - 2s suprathreshold"</span>][<span class="st">"110.0 pA"</span>]);</span>
<span id="cb38-12"><a href="#cb38-12"></a></span>
<span id="cb38-13"><a href="#cb38-13"></a><span class="co"># AdEx model</span></span>
<span id="cb38-14"><a href="#cb38-14"></a>AdEx <span class="op">=</span> <span class="fu">IFModel</span>( <span class="st">"Adaptive Exponential"</span>,</span>
<span id="cb38-15"><a href="#cb38-15"></a>                NeuronalModeling.AdEx_deterministic_dynamic!,</span>
<span id="cb38-16"><a href="#cb38-16"></a>                NeuronalModeling.get_AdEx_IC,</span>
<span id="cb38-17"><a href="#cb38-17"></a>                [name <span class="op">!=</span> <span class="st">"spike_times"</span> ? <span class="fu">Parameter</span>(name, val, prior,<span class="cn">true</span>) <span class="op">:</span> <span class="fu">Parameter</span>(name, val, prior,<span class="cn">false</span>) for (name, val, prior) <span class="kw">in</span> <span class="fu">zip</span>(NeuronalModeling.parameters_names_AdEx, initial_parameters_values_AdEx, parameters_priors_AdEx)],</span>
<span id="cb38-18"><a href="#cb38-18"></a>                NeuronalModeling.AdEx_firing_discrete_callback </span>
<span id="cb38-19"><a href="#cb38-19"></a>);  </span>
<span id="cb38-20"><a href="#cb38-20"></a></span>
<span id="cb38-21"><a href="#cb38-21"></a></span>
<span id="cb38-22"><a href="#cb38-22"></a><span class="co"># Type_Amplitudes</span></span>
<span id="cb38-23"><a href="#cb38-23"></a><span class="kw">const</span> square_110pA           <span class="op">=</span> cell_dataset[<span class="st">"data"</span>][<span class="st">"square - 2s suprathreshold"</span>][<span class="st">"110.0 pA"</span>];</span>
<span id="cb38-24"><a href="#cb38-24"></a><span class="kw">const</span> square_150pA           <span class="op">=</span> cell_dataset[<span class="st">"data"</span>][<span class="st">"square - 2s suprathreshold"</span>][<span class="st">"150.0 pA"</span>];</span>
<span id="cb38-25"><a href="#cb38-25"></a></span>
<span id="cb38-26"><a href="#cb38-26"></a><span class="co"># Features</span></span>
<span id="cb38-27"><a href="#cb38-27"></a><span class="kw">const</span> square_simple_features <span class="op">=</span> (<span class="fu">allen_firing_frequency_Hz</span>(),<span class="fu">allen_resting_potential_mV</span>(), <span class="fu">allen_latency_to_first_spike_msec</span>(),<span class="fu">allen_last_spike_latency_msec</span>(),<span class="fu">allen_average_isi_msec</span>(), <span class="fu">allen_slow_troughs_depth_mV</span>(), <span class="fu">coincidence_factor_msec</span>(<span class="fl">2</span>))</span>
<span id="cb38-28"><a href="#cb38-28"></a></span>
<span id="cb38-29"><a href="#cb38-29"></a><span class="co"># Associations</span></span>
<span id="cb38-30"><a href="#cb38-30"></a><span class="kw">const</span> square_110_allen_association <span class="op">=</span> <span class="fu">Association</span>(<span class="st">"square_110_allen_association"</span>,square_110pA, square_simple_features)</span>
<span id="cb38-31"><a href="#cb38-31"></a></span>
<span id="cb38-32"><a href="#cb38-32"></a></span>
<span id="cb38-33"><a href="#cb38-33"></a><span class="co"># Define which parameters are fixed and which are variable</span></span>
<span id="cb38-34"><a href="#cb38-34"></a><span class="kw">const</span> variable_parameters_names <span class="op">=</span> [par_name for par_name <span class="kw">in</span> NeuronalModeling.parameters_names_AdEx if par_name <span class="op">‚àâ</span> [<span class="st">"spike_times"</span>, <span class="st">"u_rest"</span>, <span class="st">"V_th"</span>, <span class="st">"u_r"</span>] ]</span>
<span id="cb38-35"><a href="#cb38-35"></a><span class="kw">const</span> all_variable_parameters_names <span class="op">=</span> [par_name for par_name <span class="kw">in</span> NeuronalModeling.parameters_names_AdEx if par_name <span class="op">‚àâ</span> [<span class="st">"spike_times"</span>] ]</span>
<span id="cb38-36"><a href="#cb38-36"></a></span>
<span id="cb38-37"><a href="#cb38-37"></a><span class="co"># Define multi-objective evolutionary step</span></span>
<span id="cb38-38"><a href="#cb38-38"></a><span class="kw">const</span> cell_dataset_optimization <span class="op">=</span> <span class="fu">Cell_Dataset_Optimization</span>( <span class="cn">true</span>, <span class="cn">nothing</span>,  excluded_features <span class="op">=</span> (<span class="st">"custom_voltage_base_mV_druck"</span>,<span class="st">"custom_voltage_base_mV_l2"</span>,<span class="st">"custom_steady_state_voltage_stimend_mV_druck"</span>, <span class="st">"custom_steady_state_voltage_stimend_mV_l2"</span>, <span class="st">"custom_voltage_after_stim_mV_druck"</span>, <span class="st">"custom_voltage_after_stim_mV_l2"</span>, <span class="st">"spike_times_msec"</span>))</span>
<span id="cb38-39"><a href="#cb38-39"></a>bbo_borgmoea_step <span class="op">=</span> <span class="fu">Step</span>(   <span class="st">"bbo_borgmoea_step"</span>,</span>
<span id="cb38-40"><a href="#cb38-40"></a>                            bbo_borgmoea_method, </span>
<span id="cb38-41"><a href="#cb38-41"></a>                            (variable_parameters_names <span class="op">=</span> variable_parameters_names, save_idxs <span class="op">=</span> [<span class="fl">1</span>], modelingtoolkit <span class="op">=</span> <span class="cn">true</span>, cell_dataset_optimization <span class="op">=</span> cell_dataset_optimization, maxtime <span class="op">=</span> <span class="fl">15</span><span class="op">*</span><span class="fl">60</span>,  plot_optimized_sweeps <span class="op">=</span> <span class="cn">false</span>, verbose <span class="op">=</span> <span class="cn">true</span> ) ) </span>
<span id="cb38-42"><a href="#cb38-42"></a></span>
<span id="cb38-43"><a href="#cb38-43"></a><span class="co"># Define Steps that perform manual parameter identification</span></span>
<span id="cb38-44"><a href="#cb38-44"></a>fix_urest_step <span class="op">=</span> <span class="fu">Step</span>(<span class="st">"fix_urest_step"</span>, fix_calibratable_method, (variable_parameter_name <span class="op">=</span> <span class="st">"u_rest"</span>, feature <span class="op">=</span> <span class="fu">allen_resting_potential_mV</span>()))</span>
<span id="cb38-45"><a href="#cb38-45"></a>fix_V_th_step <span class="op">=</span> <span class="fu">Step</span>(<span class="st">"fix_V_th_step"</span>, fix_calibratable_method, (variable_parameter_name <span class="op">=</span> <span class="st">"V_th"</span>, feature <span class="op">=</span> <span class="fu">allen_action_potential_peak_mV</span>()))</span>
<span id="cb38-46"><a href="#cb38-46"></a>fix_u_r_step <span class="op">=</span> <span class="fu">Step</span>(<span class="st">"fix_u_r_step"</span>, fix_calibratable_method, (variable_parameter_name <span class="op">=</span> <span class="st">"u_r"</span>, feature <span class="op">=</span> <span class="fu">allen_fast_trough_depth_mV</span>()))</span>
<span id="cb38-47"><a href="#cb38-47"></a></span>
<span id="cb38-48"><a href="#cb38-48"></a></span>
<span id="cb38-49"><a href="#cb38-49"></a><span class="co"># Perform the calibration</span></span>
<span id="cb38-50"><a href="#cb38-50"></a><span class="fu">multi_step_calibration!</span>((square_110_allen_association,), AdEx, (fix_urest_step, fix_V_th_step, fix_u_r_step, bbo_borgmoea_step))</span>
<span id="cb38-51"><a href="#cb38-51"></a></span>
<span id="cb38-52"><a href="#cb38-52"></a></span>
<span id="cb38-53"><a href="#cb38-53"></a><span class="co"># Plot results on training set</span></span>
<span id="cb38-54"><a href="#cb38-54"></a><span class="fu">plot_integrate_and_fire_calibration</span>(AdEx, <span class="fu">Vector</span><span class="dt">{Float64}</span>(<span class="fu">get_last_parameters_values</span>(AdEx.calibration_history)[<span class="fl">2</span><span class="op">:</span><span class="kw">end</span>]), square_110pA)</span>
<span id="cb38-55"><a href="#cb38-55"></a></span>
<span id="cb38-56"><a href="#cb38-56"></a><span class="co"># Plot results on test set</span></span>
<span id="cb38-57"><a href="#cb38-57"></a><span class="fu">plot_integrate_and_fire_calibration</span>(AdEx, <span class="fu">Vector</span><span class="dt">{Float64}</span>(<span class="fu">get_last_parameters_values</span>(AdEx.calibration_history)[<span class="fl">2</span><span class="op">:</span><span class="kw">end</span>]), square_150pA)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="demonstration-first-example-2" class="slide level2 smaller">
<h2>Demonstration: First Example #2</h2>
<p>Losses (in natural units) on train set <strong>before</strong> calibration:</p>
<div class="sourceCode" id="cb39"><pre class="sourceCode numberSource julia number-lines code-with-copy"><code class="sourceCode julia"><span id="cb39-1"><a href="#cb39-1"></a>loss_square110pA <span class="op">=</span> <span class="fu">neuron_optim_loss_closure</span>(AdEx, (square_110_allen_association,), all_variable_parameters_names,  [<span class="fl">1</span>], <span class="st">"borg_moea"</span>; modelingtoolkit <span class="op">=</span> <span class="cn">true</span>, cell_dataset_optimization  <span class="op">=</span> cell_dataset_optimization, plot_optimized_sweeps <span class="op">=</span>  <span class="cn">false</span>, verbose <span class="op">=</span> <span class="cn">true</span>);</span>
<span id="cb39-2"><a href="#cb39-2"></a></span>
<span id="cb39-3"><a href="#cb39-3"></a><span class="fu">loss_square110pA</span>(<span class="fu">Vector</span><span class="dt">{Float64}</span>(initial_parameters_values_AdEx[<span class="fl">2</span><span class="op">:</span><span class="kw">end</span>]))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb40"><pre class="sourceCode numberSource nothing number-lines code-with-copy"><code class="sourceCode"><span id="cb40-1"><a href="#cb40-1"></a>"allen_latency_to_first_spike_msec" =&gt; 28.16</span>
<span id="cb40-2"><a href="#cb40-2"></a>"allen_slow_troughs_depth_mV"       =&gt; 1.55801</span>
<span id="cb40-3"><a href="#cb40-3"></a>"coincidence_factor_msec"           =&gt; 1.03656</span>
<span id="cb40-4"><a href="#cb40-4"></a>"allen_last_spike_latency_msec"     =&gt; 0.536872</span>
<span id="cb40-5"><a href="#cb40-5"></a>"allen_average_isi_msec"            =&gt; 4.06293</span>
<span id="cb40-6"><a href="#cb40-6"></a>"allen_resting_potential_mV"        =&gt; 2.78894</span>
<span id="cb40-7"><a href="#cb40-7"></a>"allen_firing_frequency_Hz"         =&gt; 1.1811</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Losses (in natural units) on train set <strong>after</strong> calibration (analogous input code):</p>
<div class="sourceCode" id="cb41"><pre class="sourceCode numberSource nothing number-lines code-with-copy"><code class="sourceCode"><span id="cb41-1"><a href="#cb41-1"></a>"allen_latency_to_first_spike_msec" =&gt; 1.00498</span>
<span id="cb41-2"><a href="#cb41-2"></a>"allen_slow_troughs_depth_mV"       =&gt; 1.39227</span>
<span id="cb41-3"><a href="#cb41-3"></a>"coincidence_factor_msec"           =&gt; 0.874528</span>
<span id="cb41-4"><a href="#cb41-4"></a>"allen_last_spike_latency_msec"     =&gt; 0.59422</span>
<span id="cb41-5"><a href="#cb41-5"></a>"allen_average_isi_msec"            =&gt; 0.798626</span>
<span id="cb41-6"><a href="#cb41-6"></a>"allen_resting_potential_mV"        =&gt; 0.0140288</span>
<span id="cb41-7"><a href="#cb41-7"></a>"allen_firing_frequency_Hz"         =&gt; 0.393699</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>So the aggregated loss in around 5, which far less than what Druckmann deems acceptable.</p>
</section>
<section id="demonstration-first-example-3" class="slide level2 smaller">
<h2>Demonstration: First Example #3</h2>
<p>Model simulation <strong>before</strong> calibration superimposed to <code>square_110pA</code> sweeps:</p>
<p><img data-src="images/plots/plot_calibration_AdEx_untrained_over_square_110pA.png" style="width:80.0%" height="500"></p>
</section>
<section id="demonstration-first-example-4" class="slide level2 smaller">
<h2>Demonstration: First Example #4</h2>
<p>Model simulation <strong>after</strong> calibration superimposed to <code>square_110pA</code> sweeps:</p>
<p><img data-src="images/plots/plot_calibration_AdEx_trained_square_110pA_over_square_110pA.png" style="width:80.0%" height="500"></p>
</section>
<section id="demonstration-first-example-5" class="slide level2 smaller">
<h2>Demonstration: First Example #5</h2>
<p>Losses on test (square_150pA) <strong>after</strong> calibration:</p>
<div class="sourceCode" id="cb42"><pre class="sourceCode numberSource nothing number-lines code-with-copy"><code class="sourceCode"><span id="cb42-1"><a href="#cb42-1"></a>"allen_latency_to_first_spike_msec" =&gt; 4.24117 </span>
<span id="cb42-2"><a href="#cb42-2"></a>"allen_slow_troughs_depth_mV"       =&gt; 0.160079</span>
<span id="cb42-3"><a href="#cb42-3"></a>"coincidence_factor_msec"           =&gt; 1.076   </span>
<span id="cb42-4"><a href="#cb42-4"></a>"allen_last_spike_latency_msec"     =&gt; 1.72127 </span>
<span id="cb42-5"><a href="#cb42-5"></a>"allen_average_isi_msec"            =&gt; 15.2966 </span>
<span id="cb42-6"><a href="#cb42-6"></a>"allen_resting_potential_mV"        =&gt; 0.110215</span>
<span id="cb42-7"><a href="#cb42-7"></a>"allen_firing_frequency_Hz"         =&gt; 8.66138</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Which, if aggregated, returns around <span class="math inline">\(31\)</span>, that is greater than <span class="math inline">\(2 \times \text{num_features} = 2 \times 7 = 14\)</span>.</p>
<div class="fragment">
<p><span class="math inline">\(\rightarrow\)</span> We may improve this result by training on a wider dynamic range that extends below and above the <code>square_150pA</code>. For example, we could train on <code>square_110pA</code> and on <code>square_190pA</code>.</p>
</div>
</section>
<section id="demonstration-second-example-1" class="slide level2 smaller">
<h2>Demonstration: Second Example #1</h2>
<p>A complete example where we calibrate over <code>square_110pA</code> and <code>square_190pA</code> (for around 1 hour), test over <code>square_150pA</code>:</p>
<div class="sourceCode" id="cb43"><pre class="sourceCode numberSource julia number-lines code-with-copy"><code class="sourceCode julia"><span id="cb43-1"><a href="#cb43-1"></a><span class="im">using</span> <span class="bu">NeuronalModeling</span></span>
<span id="cb43-2"><a href="#cb43-2"></a></span>
<span id="cb43-3"><a href="#cb43-3"></a><span class="kw">const</span> manifest_path <span class="op">=</span> <span class="st">"path/to/allensdk/manifest"</span></span>
<span id="cb43-4"><a href="#cb43-4"></a></span>
<span id="cb43-5"><a href="#cb43-5"></a><span class="kw">const</span> initial_parameters_values_AdEx <span class="op">=</span> <span class="fu">collect</span>(<span class="fu">values</span>(NeuronalModeling.initial_parameters_values_AdEx_dict))</span>
<span id="cb43-6"><a href="#cb43-6"></a><span class="kw">const</span> parameters_priors_AdEx <span class="op">=</span> <span class="fu">get_uniform_priors</span>(initial_parameters_values_AdEx, range <span class="op">=</span> <span class="fl">1</span> )</span>
<span id="cb43-7"><a href="#cb43-7"></a></span>
<span id="cb43-8"><a href="#cb43-8"></a><span class="kw">const</span> cell_dataset <span class="op">=</span> <span class="fu">get_cell_dataset</span>(manifest_path,<span class="fl">488697163</span>)</span>
<span id="cb43-9"><a href="#cb43-9"></a></span>
<span id="cb43-10"><a href="#cb43-10"></a><span class="co"># Plot Sweeps and Input corresponding to a Type_Amplitude</span></span>
<span id="cb43-11"><a href="#cb43-11"></a>p_sweeps_square, p_input_square  <span class="op">=</span> <span class="fu">plot_type_amplitude</span>(cell_dataset[<span class="st">"data"</span>][<span class="st">"square - 2s suprathreshold"</span>][<span class="st">"110.0 pA"</span>]);</span>
<span id="cb43-12"><a href="#cb43-12"></a></span>
<span id="cb43-13"><a href="#cb43-13"></a><span class="co"># AdEx model</span></span>
<span id="cb43-14"><a href="#cb43-14"></a>AdEx <span class="op">=</span> <span class="fu">IFModel</span>( <span class="st">"Adaptive Exponential"</span>,</span>
<span id="cb43-15"><a href="#cb43-15"></a>                NeuronalModeling.AdEx_deterministic_dynamic!,</span>
<span id="cb43-16"><a href="#cb43-16"></a>                NeuronalModeling.get_AdEx_IC,</span>
<span id="cb43-17"><a href="#cb43-17"></a>                [name <span class="op">!=</span> <span class="st">"spike_times"</span> ? <span class="fu">Parameter</span>(name, val, prior,<span class="cn">true</span>) <span class="op">:</span> <span class="fu">Parameter</span>(name, val, prior,<span class="cn">false</span>) for (name, val, prior) <span class="kw">in</span> <span class="fu">zip</span>(NeuronalModeling.parameters_names_AdEx, initial_parameters_values_AdEx, parameters_priors_AdEx)],</span>
<span id="cb43-18"><a href="#cb43-18"></a>                NeuronalModeling.AdEx_firing_discrete_callback </span>
<span id="cb43-19"><a href="#cb43-19"></a>);  </span>
<span id="cb43-20"><a href="#cb43-20"></a></span>
<span id="cb43-21"><a href="#cb43-21"></a><span class="co"># Type_Amplitudes</span></span>
<span id="cb43-22"><a href="#cb43-22"></a><span class="kw">const</span> square_110pA           <span class="op">=</span> cell_dataset[<span class="st">"data"</span>][<span class="st">"square - 2s suprathreshold"</span>][<span class="st">"110.0 pA"</span>];</span>
<span id="cb43-23"><a href="#cb43-23"></a><span class="kw">const</span> square_150pA           <span class="op">=</span> cell_dataset[<span class="st">"data"</span>][<span class="st">"square - 2s suprathreshold"</span>][<span class="st">"150.0 pA"</span>];</span>
<span id="cb43-24"><a href="#cb43-24"></a><span class="kw">const</span> square_190pA           <span class="op">=</span> cell_dataset[<span class="st">"data"</span>][<span class="st">"square - 2s suprathreshold"</span>][<span class="st">"150.0 pA"</span>];</span>
<span id="cb43-25"><a href="#cb43-25"></a></span>
<span id="cb43-26"><a href="#cb43-26"></a><span class="co"># Features</span></span>
<span id="cb43-27"><a href="#cb43-27"></a><span class="kw">const</span> square_simple_features <span class="op">=</span> (<span class="fu">allen_firing_frequency_Hz</span>(),<span class="fu">allen_resting_potential_mV</span>(), <span class="fu">allen_latency_to_first_spike_msec</span>(),<span class="fu">allen_last_spike_latency_msec</span>(),<span class="fu">allen_average_isi_msec</span>(), <span class="fu">allen_slow_troughs_depth_mV</span>(), <span class="fu">coincidence_factor_msec</span>(<span class="fl">2</span>))</span>
<span id="cb43-28"><a href="#cb43-28"></a></span>
<span id="cb43-29"><a href="#cb43-29"></a><span class="co"># Associations</span></span>
<span id="cb43-30"><a href="#cb43-30"></a><span class="kw">const</span> square_110_allen_association <span class="op">=</span> <span class="fu">Association</span>(<span class="st">"square_110_allen_association"</span>,square_110pA, square_simple_features)</span>
<span id="cb43-31"><a href="#cb43-31"></a><span class="kw">const</span> square_190_allen_association <span class="op">=</span> <span class="fu">Association</span>(<span class="st">"square_190_allen_association"</span>,square_110pA, square_simple_features)</span>
<span id="cb43-32"><a href="#cb43-32"></a></span>
<span id="cb43-33"><a href="#cb43-33"></a><span class="co"># Define which parameters are fixed and which are variable</span></span>
<span id="cb43-34"><a href="#cb43-34"></a><span class="kw">const</span> variable_parameters_names <span class="op">=</span> [par_name for par_name <span class="kw">in</span> NeuronalModeling.parameters_names_AdEx if par_name <span class="op">‚àâ</span> [<span class="st">"spike_times"</span>, <span class="st">"u_rest"</span>, <span class="st">"V_th"</span>, <span class="st">"u_r"</span>] ]</span>
<span id="cb43-35"><a href="#cb43-35"></a><span class="kw">const</span> all_variable_parameters_names <span class="op">=</span> [par_name for par_name <span class="kw">in</span> NeuronalModeling.parameters_names_AdEx if par_name <span class="op">‚àâ</span> [<span class="st">"spike_times"</span>] ]</span>
<span id="cb43-36"><a href="#cb43-36"></a></span>
<span id="cb43-37"><a href="#cb43-37"></a><span class="co"># Define multi-objective evolutionary step</span></span>
<span id="cb43-38"><a href="#cb43-38"></a><span class="kw">const</span> cell_dataset_optimization <span class="op">=</span> <span class="fu">Cell_Dataset_Optimization</span>( <span class="cn">true</span>, <span class="cn">nothing</span>,  excluded_features <span class="op">=</span> (<span class="st">"custom_voltage_base_mV_druck"</span>,<span class="st">"custom_voltage_base_mV_l2"</span>,<span class="st">"custom_steady_state_voltage_stimend_mV_druck"</span>, <span class="st">"custom_steady_state_voltage_stimend_mV_l2"</span>, <span class="st">"custom_voltage_after_stim_mV_druck"</span>, <span class="st">"custom_voltage_after_stim_mV_l2"</span>, <span class="st">"spike_times_msec"</span>))</span>
<span id="cb43-39"><a href="#cb43-39"></a>bbo_borgmoea_step <span class="op">=</span> <span class="fu">Step</span>(   <span class="st">"bbo_borgmoea_step"</span>,</span>
<span id="cb43-40"><a href="#cb43-40"></a>                            bbo_borgmoea_method, </span>
<span id="cb43-41"><a href="#cb43-41"></a>                            (variable_parameters_names <span class="op">=</span> variable_parameters_names, save_idxs <span class="op">=</span> [<span class="fl">1</span>], modelingtoolkit <span class="op">=</span> <span class="cn">true</span>, cell_dataset_optimization <span class="op">=</span> cell_dataset_optimization, maxtime <span class="op">=</span> <span class="fl">60</span><span class="op">*</span><span class="fl">60</span>,  plot_optimized_sweeps <span class="op">=</span> <span class="cn">false</span>, verbose <span class="op">=</span> <span class="cn">true</span> ) ) </span>
<span id="cb43-42"><a href="#cb43-42"></a></span>
<span id="cb43-43"><a href="#cb43-43"></a><span class="co"># Define Steps that perform manual parameter identification</span></span>
<span id="cb43-44"><a href="#cb43-44"></a>fix_urest_step <span class="op">=</span> <span class="fu">Step</span>(<span class="st">"fix_urest_step"</span>, fix_calibratable_method, (variable_parameter_name <span class="op">=</span> <span class="st">"u_rest"</span>, feature <span class="op">=</span> <span class="fu">allen_resting_potential_mV</span>()))</span>
<span id="cb43-45"><a href="#cb43-45"></a>fix_V_th_step <span class="op">=</span> <span class="fu">Step</span>(<span class="st">"fix_V_th_step"</span>, fix_calibratable_method, (variable_parameter_name <span class="op">=</span> <span class="st">"V_th"</span>, feature <span class="op">=</span> <span class="fu">allen_action_potential_peak_mV</span>()))</span>
<span id="cb43-46"><a href="#cb43-46"></a>fix_u_r_step <span class="op">=</span> <span class="fu">Step</span>(<span class="st">"fix_u_r_step"</span>, fix_calibratable_method, (variable_parameter_name <span class="op">=</span> <span class="st">"u_r"</span>, feature <span class="op">=</span> <span class="fu">allen_fast_trough_depth_mV</span>()))</span>
<span id="cb43-47"><a href="#cb43-47"></a></span>
<span id="cb43-48"><a href="#cb43-48"></a></span>
<span id="cb43-49"><a href="#cb43-49"></a><span class="co"># Perform the calibration</span></span>
<span id="cb43-50"><a href="#cb43-50"></a><span class="fu">multi_step_calibration!</span>((square_110_allen_association,square_110_allen_association), AdEx, (fix_urest_step, fix_V_th_step, fix_u_r_step, bbo_borgmoea_step))</span>
<span id="cb43-51"><a href="#cb43-51"></a></span>
<span id="cb43-52"><a href="#cb43-52"></a></span>
<span id="cb43-53"><a href="#cb43-53"></a><span class="co"># Plot results on training set</span></span>
<span id="cb43-54"><a href="#cb43-54"></a><span class="fu">plot_integrate_and_fire_calibration</span>(AdEx, <span class="fu">Vector</span><span class="dt">{Float64}</span>(<span class="fu">get_last_parameters_values</span>(AdEx.calibration_history)[<span class="fl">2</span><span class="op">:</span><span class="kw">end</span>]), square_110pA)</span>
<span id="cb43-55"><a href="#cb43-55"></a><span class="fu">plot_integrate_and_fire_calibration</span>(AdEx, <span class="fu">Vector</span><span class="dt">{Float64}</span>(<span class="fu">get_last_parameters_values</span>(AdEx.calibration_history)[<span class="fl">2</span><span class="op">:</span><span class="kw">end</span>]), square_190pA)</span>
<span id="cb43-56"><a href="#cb43-56"></a></span>
<span id="cb43-57"><a href="#cb43-57"></a><span class="co"># Plot results on test set</span></span>
<span id="cb43-58"><a href="#cb43-58"></a><span class="fu">plot_integrate_and_fire_calibration</span>(AdEx, <span class="fu">Vector</span><span class="dt">{Float64}</span>(<span class="fu">get_last_parameters_values</span>(AdEx.calibration_history)[<span class="fl">2</span><span class="op">:</span><span class="kw">end</span>]), square_150pA)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="demonstration-second-example-2" class="slide level2 smaller">
<h2>Demonstration: Second Example #2</h2>
<p>Losses (in natural units) on train set <code>square_110pA</code> <strong>after</strong> calibration:</p>
<div class="sourceCode" id="cb44"><pre class="sourceCode numberSource nothing number-lines code-with-copy"><code class="sourceCode"><span id="cb44-1"><a href="#cb44-1"></a>"allen_latency_to_first_spike_msec_square__2s_suprathreshold_110_0_pA" =&gt; 5.14464</span>
<span id="cb44-2"><a href="#cb44-2"></a>"allen_slow_troughs_depth_mV_square__2s_suprathreshold_110_0_pA"       =&gt; 3.71556</span>
<span id="cb44-3"><a href="#cb44-3"></a>"coincidence_factor_msec_square__2s_suprathreshold_110_0_pA"           =&gt; 1.0252</span>
<span id="cb44-4"><a href="#cb44-4"></a>"allen_last_spike_latency_msec_square__2s_suprathreshold_110_0_pA"     =&gt; 0.518066</span>
<span id="cb44-5"><a href="#cb44-5"></a>"allen_average_isi_msec_square__2s_suprathreshold_110_0_pA"            =&gt; 0.439908</span>
<span id="cb44-6"><a href="#cb44-6"></a>"allen_resting_potential_mV_square__2s_suprathreshold_110_0_pA"        =&gt; 0.0162544</span>
<span id="cb44-7"><a href="#cb44-7"></a>"allen_firing_frequency_Hz_square__2s_suprathreshold_110_0_pA"         =&gt; 0.393699</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>We have two losses above 2 SD <span class="math inline">\(\rightarrow\)</span> we pay something.</p>
</section>
<section id="demonstration-second-example-3" class="slide level2 smaller">
<h2>Demonstration: Second Example #3</h2>
<p>Losses on train set <code>square_190pA</code> <strong>before</strong> calibration:</p>
<div class="sourceCode" id="cb45"><pre class="sourceCode numberSource nothing number-lines code-with-copy"><code class="sourceCode"><span id="cb45-1"><a href="#cb45-1"></a>"allen_latency_to_first_spike_msec" =&gt; 20.3146</span>
<span id="cb45-2"><a href="#cb45-2"></a>"allen_slow_troughs_depth_mV"       =&gt; 2.75719</span>
<span id="cb45-3"><a href="#cb45-3"></a>"coincidence_factor_msec"           =&gt; 0.994487</span>
<span id="cb45-4"><a href="#cb45-4"></a>"allen_last_spike_latency_msec"     =&gt; 0.306099</span>
<span id="cb45-5"><a href="#cb45-5"></a>"allen_average_isi_msec"            =&gt; 25.8072</span>
<span id="cb45-6"><a href="#cb45-6"></a>"allen_resting_potential_mV"        =&gt; 2.80781</span>
<span id="cb45-7"><a href="#cb45-7"></a>"allen_firing_frequency_Hz"         =&gt; 13.435</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Whose aggregation is around 66.</p>
<p>Losses on train set <code>square_190pA</code> <strong>after</strong> calibration:</p>
<div class="sourceCode" id="cb46"><pre class="sourceCode numberSource nothing number-lines code-with-copy"><code class="sourceCode"><span id="cb46-1"><a href="#cb46-1"></a>"allen_latency_to_first_spike_msec_square__2s_suprathreshold_190_0_pA" =&gt; 2.17963</span>
<span id="cb46-2"><a href="#cb46-2"></a>"allen_slow_troughs_depth_mV_square__2s_suprathreshold_190_0_pA"       =&gt; 0.0694215</span>
<span id="cb46-3"><a href="#cb46-3"></a>"coincidence_factor_msec_square__2s_suprathreshold_190_0_pA"           =&gt; 0.980084</span>
<span id="cb46-4"><a href="#cb46-4"></a>"allen_last_spike_latency_msec_square__2s_suprathreshold_190_0_pA"     =&gt; 0.140696</span>
<span id="cb46-5"><a href="#cb46-5"></a>"allen_average_isi_msec_square__2s_suprathreshold_190_0_pA"            =&gt; 0.696329</span>
<span id="cb46-6"><a href="#cb46-6"></a>"allen_resting_potential_mV_square__2s_suprathreshold_190_0_pA"        =&gt; 0.0588253</span>
<span id="cb46-7"><a href="#cb46-7"></a>"allen_firing_frequency_Hz_square__2s_suprathreshold_190_0_pA"         =&gt; 0.707107</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Only one loss slightly above 2 SD <span class="math inline">\(\rightarrow\)</span> very good!</p>
</section>
<section id="demonstration-second-example-4" class="slide level2 smaller">
<h2>Demonstration: Second Example #4</h2>
<p>Losses on test set <code>square_150pA</code> <strong>after</strong> calibration:</p>
<div class="sourceCode" id="cb47"><pre class="sourceCode numberSource nothing number-lines code-with-copy"><code class="sourceCode"><span id="cb47-1"><a href="#cb47-1"></a>"allen_latency_to_first_spike_msec_square__2s_suprathreshold_150_0_pA" =&gt; 3.17513</span>
<span id="cb47-2"><a href="#cb47-2"></a>"allen_slow_troughs_depth_mV_square__2s_suprathreshold_150_0_pA"       =&gt; 1.2069</span>
<span id="cb47-3"><a href="#cb47-3"></a>"coincidence_factor_msec_square__2s_suprathreshold_150_0_pA"           =&gt; 1.15644</span>
<span id="cb47-4"><a href="#cb47-4"></a>"allen_last_spike_latency_msec_square__2s_suprathreshold_150_0_pA"     =&gt; 0.520282</span>
<span id="cb47-5"><a href="#cb47-5"></a>"allen_average_isi_msec_square__2s_suprathreshold_150_0_pA"            =&gt; 4.2622</span>
<span id="cb47-6"><a href="#cb47-6"></a>"allen_resting_potential_mV_square__2s_suprathreshold_150_0_pA"        =&gt; 0.0998484</span>
<span id="cb47-7"><a href="#cb47-7"></a>"allen_firing_frequency_Hz_square__2s_suprathreshold_150_0_pA"         =&gt; 3.14959</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Whose aggregation is around 13.5 <span class="math inline">\(\rightarrow\)</span> much less than before (31) <span class="math inline">\(\rightarrow\)</span> better generalization!</p>
</section>
<section id="demonstration-second-example-5" class="slide level2 smaller">
<h2>Demonstration: Second Example #5</h2>
<p><img data-src="images/plots/plot_calibration_AdEx_trained_square_110pA_square_190pA_over_square_110pA.png" style="width:80.0%" height="500"></p>
</section>
<section id="demonstration-second-example-6" class="slide level2 smaller">
<h2>Demonstration: Second Example #6</h2>
<p><img data-src="images/plots/plot_calibration_AdEx_trained_square_110pA_square_190pA_over_square_190pA.png" style="width:80.0%" height="500"></p>
</section>
<section id="demonstration-second-example-7" class="slide level2 smaller">
<h2>Demonstration: Second Example #7</h2>
<p><img data-src="images/plots/plot_calibration_AdEx_trained_square_110pA_square_190pA_over_square_150pA.png" style="width:80.0%" height="500"></p>
</section></section>
<section>
<section id="neuronalmodelling.jl-3" class="title-slide slide level1 center">
<h1><span class="semi-transparent">NeuronalModelling.jl</span></h1>
<ol type="1">
<li><p><span class="semi-transparent">Why Julia?</span></p></li>
<li><p><span class="semi-transparent">Overview;</span></p></li>
<li><p><span class="semi-transparent">Demonstration;</span></p></li>
<li><p>Future developments:</p>
<p>4.1 Hodgkin-Huxley models;</p>
<p>4.2 Macros;</p>
<p>4.3 Other improvements;</p></li>
</ol>
</section>
<section id="future-developments-hodgkin-huxley-models" class="slide level2 smaller scrollable">
<h2>Future developments: Hodgkin-Huxley models</h2>
<ul>
<li>Earlier versions of the package were centered around Hodgkin-Huxley models. Although we managed to calibrate them, they presented much harder challenges;</li>
</ul>
<div class="fragment">
<ul>
<li>We therefore switched in favor of AdNLIF models. Now that we perfected the pipeline for the simpler AdNLIF case, we may feel more confident to walk the HH path again.</li>
</ul>
</div>
<div class="fragment">
<div class="sourceCode" id="cb48"><pre class="sourceCode numberSource julia number-lines code-with-copy"><code class="sourceCode julia"><span id="cb48-1"><a href="#cb48-1"></a><span class="co"># function that outputs initial conditions for fractions of open channels, given the value of the resting potential.</span></span>
<span id="cb48-2"><a href="#cb48-2"></a><span class="co">## The idea behind this function has been drawn from http://indico.ictp.it/event/a13235/session/99/contribution/371/material/0/1.pdf</span></span>
<span id="cb48-3"><a href="#cb48-3"></a><span class="co">## Note: it MUST take all parameters values as argument, for later ease of use in the neuron_optim_loss_closure</span></span>
<span id="cb48-4"><a href="#cb48-4"></a><span class="kw">function</span> <span class="fu">get_HH__Na_Kd_M_L_mf_exp_IC</span>(V_rest<span class="op">::</span><span class="dt">Float64</span>, all_parameters_values<span class="op">::</span><span class="dt">Array{Float64,1}</span>, type_amplitude<span class="op">::</span><span class="dt">String</span>)</span>
<span id="cb48-5"><a href="#cb48-5"></a>    C,     g_Na,  V_Na,        g_K,   g_M,   V_K,   g_L,   V_Ca,  g_l, V_l, V_T,</span>
<span id="cb48-6"><a href="#cb48-6"></a>    m_Œ±_A, m_Œ±_C,       m_Œ≤_A, m_Œ≤_C,</span>
<span id="cb48-7"><a href="#cb48-7"></a>    h_Œ±_A, h_Œ±_C,       h_Œ≤_A, h_Œ≤_C,</span>
<span id="cb48-8"><a href="#cb48-8"></a>    n_Œ±_A, n_Œ±_C,       n_Œ≤_A, n_Œ≤_C,</span>
<span id="cb48-9"><a href="#cb48-9"></a>    p_0_B, p_0_C, œÑ_p_max_exp, œÑ_p_A, œÑ_p_B, œÑ_p_C,</span>
<span id="cb48-10"><a href="#cb48-10"></a>    q_Œ±_A, q_Œ±_B, q_Œ±_C,       q_Œ≤_A, q_Œ≤_B, q_Œ≤_C,</span>
<span id="cb48-11"><a href="#cb48-11"></a>    r_Œ±_A, r_Œ±_B, r_Œ±_C,       r_Œ≤_A, r_Œ≤_B, r_Œ≤_C    <span class="op">=</span> all_parameters_values</span>
<span id="cb48-12"><a href="#cb48-12"></a></span>
<span id="cb48-13"><a href="#cb48-13"></a>    Œ±‚Çò <span class="op">=</span> (<span class="op">-</span> m_Œ±_A <span class="op">*</span> ( V_rest <span class="op">-</span> V_T <span class="op">-</span> <span class="fl">13.0</span> ) <span class="op">/</span> (<span class="fu">exp</span>( <span class="op">-</span> ( V_rest <span class="op">-</span> V_T <span class="op">-</span> <span class="fl">13.0</span> ) <span class="op">/</span> m_Œ±_C) ) <span class="op">-</span><span class="fl">1.0</span> )</span>
<span id="cb48-14"><a href="#cb48-14"></a>    Œ≤‚Çò <span class="op">=</span> (m_Œ≤_A <span class="op">*</span> ( V_rest <span class="op">-</span> V_T <span class="op">-</span> <span class="fl">40.0</span> ) <span class="op">/</span> ( <span class="fu">exp</span>( ( V_rest <span class="op">-</span> V_T <span class="op">-</span> <span class="fl">40.0</span> ) <span class="op">/</span> m_Œ≤_C) ) <span class="op">-</span> <span class="fl">1.0</span> )</span>
<span id="cb48-15"><a href="#cb48-15"></a></span>
<span id="cb48-16"><a href="#cb48-16"></a>    Œ±‚Çï <span class="op">=</span>  (h_Œ±_A <span class="op">*</span> <span class="fu">exp</span>( <span class="op">-</span> ( V_rest <span class="op">-</span> V_T <span class="op">-</span> <span class="fl">17.0</span> ) <span class="op">/</span> h_Œ±_C ) )</span>
<span id="cb48-17"><a href="#cb48-17"></a>    Œ≤‚Çï <span class="op">=</span>  (h_Œ≤_A  <span class="op">/</span>( <span class="fl">1.0</span> <span class="op">+</span> <span class="fu">exp</span>( <span class="op">-</span> ( V_rest <span class="op">-</span> V_T <span class="op">-</span> <span class="fl">40.0</span>  ) <span class="op">/</span> h_Œ≤_C )) )</span>
<span id="cb48-18"><a href="#cb48-18"></a></span>
<span id="cb48-19"><a href="#cb48-19"></a>    Œ±‚Çô <span class="op">=</span> (<span class="op">-</span> n_Œ±_A <span class="op">*</span> ( V_rest <span class="op">-</span> V_T <span class="op">-</span> <span class="fl">15.0</span> ) <span class="op">/</span> (<span class="fu">exp</span>( <span class="op">-</span> ( V_rest <span class="op">-</span> V_T <span class="op">-</span> <span class="fl">15.0</span>  ) <span class="op">/</span> n_Œ±_C) ) <span class="op">-</span> <span class="fl">1.0</span>) </span>
<span id="cb48-20"><a href="#cb48-20"></a>    Œ≤‚Çô <span class="op">=</span> (n_Œ≤_A <span class="op">*</span> <span class="fu">exp</span>( <span class="op">-</span> ( V_rest <span class="op">-</span> V_T <span class="op">-</span> <span class="fl">10.0</span> ) <span class="op">/</span> n_Œ≤_C) )</span>
<span id="cb48-21"><a href="#cb48-21"></a></span>
<span id="cb48-22"><a href="#cb48-22"></a>    x‚ÇÄ <span class="op">=</span> ( (<span class="fl">1.0</span> <span class="op">/</span> ( <span class="fl">1.0</span> <span class="op">+</span> <span class="fu">exp</span>( <span class="op">-</span> ( V_rest <span class="op">+</span> p_0_B )<span class="op">/</span>p_0_C ) ) ) )</span>
<span id="cb48-23"><a href="#cb48-23"></a></span>
<span id="cb48-24"><a href="#cb48-24"></a>    Œ±_4 <span class="op">=</span>  ( ( q_Œ±_A <span class="op">*</span> <span class="fu">exp</span>(<span class="op">-</span> V_rest <span class="op">-</span> q_Œ±_B ) ) <span class="op">/</span>(<span class="fu">exp</span>((<span class="op">-</span> V_rest <span class="op">-</span> q_Œ±_B )<span class="op">/</span>q_Œ±_C ) <span class="op">-</span> <span class="fl">1.0</span>) )</span>
<span id="cb48-25"><a href="#cb48-25"></a>    Œ≤_4 <span class="op">=</span> ( q_Œ≤_A <span class="op">*</span> <span class="fu">exp</span>((<span class="op">-</span> V_rest <span class="op">-</span> q_Œ≤_B ) <span class="op">/</span> q_Œ≤_C) )</span>
<span id="cb48-26"><a href="#cb48-26"></a></span>
<span id="cb48-27"><a href="#cb48-27"></a>    Œ±·µ£ <span class="op">=</span> ( r_Œ±_A <span class="op">*</span> <span class="fu">exp</span>((<span class="op">-</span> V_rest <span class="op">-</span> r_Œ±_B ) <span class="op">/</span> r_Œ±_C) )</span>
<span id="cb48-28"><a href="#cb48-28"></a>    Œ≤·µ£ <span class="op">=</span> ( r_Œ≤_A   <span class="op">/</span>(<span class="fu">exp</span>((<span class="op">-</span> V_rest <span class="op">-</span> r_Œ≤_B )<span class="op">/</span>r_Œ≤_C ) <span class="op">+</span> <span class="fl">1.0</span>) )</span>
<span id="cb48-29"><a href="#cb48-29"></a></span>
<span id="cb48-30"><a href="#cb48-30"></a>    m‚ÇÄ <span class="op">=</span> Œ±‚Çò <span class="op">/</span> ( Œ±‚Çò <span class="op">+</span> Œ≤‚Çò )</span>
<span id="cb48-31"><a href="#cb48-31"></a>    h‚ÇÄ <span class="op">=</span> Œ±‚Çï <span class="op">/</span> ( Œ±‚Çï <span class="op">+</span> Œ≤‚Çï  )</span>
<span id="cb48-32"><a href="#cb48-32"></a>    n‚ÇÄ <span class="op">=</span> Œ±‚Çô <span class="op">/</span> ( Œ±‚Çô <span class="op">+</span> Œ≤‚Çô  )</span>
<span id="cb48-33"><a href="#cb48-33"></a>    p‚ÇÄ <span class="op">=</span> x‚ÇÄ_p</span>
<span id="cb48-34"><a href="#cb48-34"></a>    q‚ÇÄ <span class="op">=</span> Œ±_q <span class="op">/</span> (Œ±_q <span class="op">+</span> Œ≤_q)</span>
<span id="cb48-35"><a href="#cb48-35"></a>    r‚ÇÄ <span class="op">=</span> Œ±·µ£ <span class="op">/</span> (Œ±·µ£ <span class="op">+</span> Œ≤·µ£ )</span>
<span id="cb48-36"><a href="#cb48-36"></a></span>
<span id="cb48-37"><a href="#cb48-37"></a>    <span class="cf">return</span> <span class="fu">vcat</span>(V_rest, m‚ÇÄ, h‚ÇÄ, n‚ÇÄ, p‚ÇÄ, q‚ÇÄ, r‚ÇÄ)</span>
<span id="cb48-38"><a href="#cb48-38"></a><span class="kw">end</span></span>
<span id="cb48-39"><a href="#cb48-39"></a></span>
<span id="cb48-40"><a href="#cb48-40"></a><span class="kw">function</span> <span class="fu">get_HH__Na_Kd_M_L_mf_tanh_IC</span>(V_rest<span class="op">::</span><span class="dt">Float64</span>, all_parameters_values<span class="op">::</span><span class="dt">Vector{Float64}</span>, type_amplitude <span class="op">=</span> <span class="st">""</span>)</span>
<span id="cb48-41"><a href="#cb48-41"></a>    C,   g_Na, V_Na, g_K,     g_M,   V_K,   g_L, V_Ca, g_l, V_l,</span>
<span id="cb48-42"><a href="#cb48-42"></a>    V_m, Œ∫_m,  œÑ‚ÇÄ_m, œÑ_max_m, V_œÑ_m, œÉ_m, </span>
<span id="cb48-43"><a href="#cb48-43"></a>    V_h, Œ∫_h,  œÑ‚ÇÄ_h, œÑ_max_h, V_œÑ_h, œÉ_h,</span>
<span id="cb48-44"><a href="#cb48-44"></a>    V_n, Œ∫_n,  œÑ‚ÇÄ_n, œÑ_max_n, V_œÑ_n, œÉ_n,</span>
<span id="cb48-45"><a href="#cb48-45"></a>    V_p, Œ∫_p,  œÑ‚ÇÄ_p, œÑ_max_p, V_œÑ_p, œÉ_p,</span>
<span id="cb48-46"><a href="#cb48-46"></a>    V_q, Œ∫_q,  œÑ‚ÇÄ_q, œÑ_max_q, V_œÑ_q, œÉ_q,</span>
<span id="cb48-47"><a href="#cb48-47"></a>    V_r, Œ∫_r,  œÑ‚ÇÄ_r, œÑ_max_r, V_œÑ_r, œÉ_r     <span class="op">=</span> all_parameters_values</span>
<span id="cb48-48"><a href="#cb48-48"></a></span>
<span id="cb48-49"><a href="#cb48-49"></a>    m‚ÇÄ <span class="op">=</span> (<span class="fl">1</span><span class="op">/</span><span class="fl">2</span>) <span class="op">*</span> (<span class="fl">1</span> <span class="op">+</span> <span class="fu">tanh</span>( (V_rest <span class="op">-</span> V_m) <span class="op">/</span> Œ∫_m ) )</span>
<span id="cb48-50"><a href="#cb48-50"></a>    h‚ÇÄ <span class="op">=</span> (<span class="fl">1</span><span class="op">/</span><span class="fl">2</span>) <span class="op">*</span> (<span class="fl">1</span> <span class="op">+</span> <span class="fu">tanh</span>( (V_rest <span class="op">-</span> V_h) <span class="op">/</span> Œ∫_h ) )</span>
<span id="cb48-51"><a href="#cb48-51"></a>    n‚ÇÄ <span class="op">=</span> (<span class="fl">1</span><span class="op">/</span><span class="fl">2</span>) <span class="op">*</span> (<span class="fl">1</span> <span class="op">+</span> <span class="fu">tanh</span>( (V_rest <span class="op">-</span> V_n) <span class="op">/</span> Œ∫_n ) )</span>
<span id="cb48-52"><a href="#cb48-52"></a>    p‚ÇÄ <span class="op">=</span> (<span class="fl">1</span><span class="op">/</span><span class="fl">2</span>) <span class="op">*</span> (<span class="fl">1</span> <span class="op">+</span> <span class="fu">tanh</span>( (V_rest <span class="op">-</span> V_p) <span class="op">/</span> Œ∫_p ) )</span>
<span id="cb48-53"><a href="#cb48-53"></a>    q‚ÇÄ <span class="op">=</span> (<span class="fl">1</span><span class="op">/</span><span class="fl">2</span>) <span class="op">*</span> (<span class="fl">1</span> <span class="op">+</span> <span class="fu">tanh</span>( (V_rest <span class="op">-</span> V_q) <span class="op">/</span> Œ∫_q ) )</span>
<span id="cb48-54"><a href="#cb48-54"></a>    r‚ÇÄ <span class="op">=</span> (<span class="fl">1</span><span class="op">/</span><span class="fl">2</span>) <span class="op">*</span> (<span class="fl">1</span> <span class="op">+</span> <span class="fu">tanh</span>( (V_rest <span class="op">-</span> V_r) <span class="op">/</span> Œ∫_r ) )</span>
<span id="cb48-55"><a href="#cb48-55"></a></span>
<span id="cb48-56"><a href="#cb48-56"></a>    <span class="cf">return</span> <span class="fu">vcat</span>(V_rest, m‚ÇÄ, h‚ÇÄ, n‚ÇÄ, p‚ÇÄ, q‚ÇÄ, r‚ÇÄ )</span>
<span id="cb48-57"><a href="#cb48-57"></a><span class="kw">end</span></span>
<span id="cb48-58"><a href="#cb48-58"></a></span>
<span id="cb48-59"><a href="#cb48-59"></a></span>
<span id="cb48-60"><a href="#cb48-60"></a></span>
<span id="cb48-61"><a href="#cb48-61"></a><span class="kw">function</span> <span class="fu">HH__Na_Kd_M_L_mf_exp_deterministic_dynamic!</span>(I_series<span class="op">::</span><span class="dt">F</span>) <span class="kw">where</span> {F <span class="op">&lt;:</span><span class="dt">Function</span>}</span>
<span id="cb48-62"><a href="#cb48-62"></a>    <span class="kw">function</span> <span class="fu">parametrized_HH__Na_Kd_M_L_mf_exp_deterministic_dynamic!</span>(du, u, p, t )</span>
<span id="cb48-63"><a href="#cb48-63"></a>        </span>
<span id="cb48-64"><a href="#cb48-64"></a>        C,     g_Na,  V_Na,        g_K,   g_M,   V_K,   g_L,   V_Ca,  g_l, V_l, V_T,</span>
<span id="cb48-65"><a href="#cb48-65"></a>        m_Œ±_A, m_Œ±_C,       m_Œ≤_A, m_Œ≤_C,</span>
<span id="cb48-66"><a href="#cb48-66"></a>        h_Œ±_A, h_Œ±_C,       h_Œ≤_A, h_Œ≤_C,</span>
<span id="cb48-67"><a href="#cb48-67"></a>        n_Œ±_A, n_Œ±_C,       n_Œ≤_A, n_Œ≤_C,</span>
<span id="cb48-68"><a href="#cb48-68"></a>        p_0_B, p_0_C, œÑ_p_max_exp, œÑ_p_A, œÑ_p_B, œÑ_p_C,</span>
<span id="cb48-69"><a href="#cb48-69"></a>        q_Œ±_A, q_Œ±_B, q_Œ±_C,       q_Œ≤_A, q_Œ≤_B, q_Œ≤_C,</span>
<span id="cb48-70"><a href="#cb48-70"></a>        r_Œ±_A, r_Œ±_B, r_Œ±_C,       r_Œ≤_A, r_Œ≤_B, r_Œ≤_C    <span class="op">=</span> p </span>
<span id="cb48-71"><a href="#cb48-71"></a>        </span>
<span id="cb48-72"><a href="#cb48-72"></a>        <span class="co"># State variables</span></span>
<span id="cb48-73"><a href="#cb48-73"></a>        V <span class="op">=</span> <span class="pp">@view</span> u[<span class="fl">1</span>]</span>
<span id="cb48-74"><a href="#cb48-74"></a>        m <span class="op">=</span> <span class="pp">@view</span> u[<span class="fl">2</span>]</span>
<span id="cb48-75"><a href="#cb48-75"></a>        h <span class="op">=</span> <span class="pp">@view</span> u[<span class="fl">3</span>] </span>
<span id="cb48-76"><a href="#cb48-76"></a>        n <span class="op">=</span> <span class="pp">@view</span> u[<span class="fl">4</span>] </span>
<span id="cb48-77"><a href="#cb48-77"></a>        p <span class="op">=</span> <span class="pp">@view</span> u[<span class="fl">5</span>]</span>
<span id="cb48-78"><a href="#cb48-78"></a>        q <span class="op">=</span> <span class="pp">@view</span> u[<span class="fl">6</span>]</span>
<span id="cb48-79"><a href="#cb48-79"></a>        r <span class="op">=</span> <span class="pp">@view</span> u[<span class="fl">7</span>]</span>
<span id="cb48-80"><a href="#cb48-80"></a></span>
<span id="cb48-81"><a href="#cb48-81"></a>        <span class="co"># State variables</span></span>
<span id="cb48-82"><a href="#cb48-82"></a>        dV <span class="op">=</span> <span class="pp">@view</span> du[<span class="fl">1</span>]</span>
<span id="cb48-83"><a href="#cb48-83"></a>        dm <span class="op">=</span> <span class="pp">@view</span> du[<span class="fl">2</span>]</span>
<span id="cb48-84"><a href="#cb48-84"></a>        dh <span class="op">=</span> <span class="pp">@view</span> du[<span class="fl">3</span>] </span>
<span id="cb48-85"><a href="#cb48-85"></a>        dn <span class="op">=</span> <span class="pp">@view</span> du[<span class="fl">4</span>] </span>
<span id="cb48-86"><a href="#cb48-86"></a>        dp <span class="op">=</span> <span class="pp">@view</span> du[<span class="fl">5</span>]</span>
<span id="cb48-87"><a href="#cb48-87"></a>        dq <span class="op">=</span> <span class="pp">@view</span> du[<span class="fl">6</span>]</span>
<span id="cb48-88"><a href="#cb48-88"></a>        dr <span class="op">=</span> <span class="pp">@view</span> du[<span class="fl">7</span>]</span>
<span id="cb48-89"><a href="#cb48-89"></a></span>
<span id="cb48-90"><a href="#cb48-90"></a></span>
<span id="cb48-91"><a href="#cb48-91"></a>        dV <span class="op">.=</span> (<span class="op">-</span><span class="fl">1.0</span> <span class="op">/</span> C ) <span class="op">.*</span> ( g_Na <span class="op">.*</span> (m <span class="op">.^</span> <span class="fl">3</span>) <span class="op">.*</span> h <span class="op">.*</span> ( V <span class="op">.-</span> V_Na ) <span class="op">.+</span> g_K <span class="op">.*</span> (n <span class="op">.^</span> <span class="fl">4</span> ) <span class="op">.*</span> ( V <span class="op">.-</span> V_K ) <span class="op">.+</span> g_M <span class="op">.*</span> p <span class="op">.*</span> (V <span class="op">-</span> V_K) <span class="op">.+</span> g_L <span class="op">.*</span> (q<span class="op">.^</span><span class="fl">2</span>)<span class="fu">*r*</span>(V <span class="op">.-</span> V_Ca ) <span class="op">.+</span> g_l <span class="op">.*</span> ( V <span class="op">.-</span> V_l ) <span class="op">.-</span> <span class="fu">I_series</span>(t)   ) </span>
<span id="cb48-92"><a href="#cb48-92"></a></span>
<span id="cb48-93"><a href="#cb48-93"></a>        @. dm <span class="op">=</span>  (<span class="op">-</span> m_Œ±_A <span class="op">*</span> ( V <span class="op">-</span> V_T <span class="op">-</span> <span class="fl">13.0</span> ) <span class="op">/</span> (<span class="fu">exp</span>( <span class="op">-</span> ( V <span class="op">-</span> V_T <span class="op">-</span> <span class="fl">13.0</span> ) <span class="op">/</span> m_Œ±_C) ) <span class="op">-</span><span class="fl">1.0</span> )  <span class="op">*</span> ( <span class="fl">1</span> <span class="op">-</span> m ) <span class="op">-</span>  (m_Œ≤_A <span class="op">*</span> ( V <span class="op">-</span> V_T <span class="op">-</span> <span class="fl">40.0</span> ) <span class="op">/</span> ( <span class="fu">exp</span>( ( V <span class="op">-</span> V_T <span class="op">-</span> <span class="fl">40.0</span> ) <span class="op">/</span> m_Œ≤_C) ) <span class="op">-</span> <span class="fl">1.0</span> )  <span class="op">*</span> m   </span>
<span id="cb48-94"><a href="#cb48-94"></a></span>
<span id="cb48-95"><a href="#cb48-95"></a>        @. dh <span class="op">=</span>  (h_Œ±_A <span class="op">*</span> <span class="fu">exp</span>( <span class="op">-</span> ( V <span class="op">-</span> V_T <span class="op">-</span> <span class="fl">17.0</span> ) <span class="op">/</span> h_Œ±_C ) )  <span class="op">*</span> ( <span class="fl">1</span> <span class="op">-</span> h ) <span class="op">-</span> (h_Œ≤_A  <span class="op">/</span>( <span class="fl">1.0</span> <span class="op">+</span> <span class="fu">exp</span>( <span class="op">-</span> ( V <span class="op">-</span> V_T <span class="op">-</span> <span class="fl">40.0</span>  ) <span class="op">/</span> h_Œ≤_C )) ) <span class="op">*</span> h  </span>
<span id="cb48-96"><a href="#cb48-96"></a></span>
<span id="cb48-97"><a href="#cb48-97"></a>        @. dn <span class="op">=</span>  (<span class="op">-</span> n_Œ±_A <span class="op">*</span> ( V <span class="op">-</span> V_T <span class="op">-</span> <span class="fl">15.0</span> ) <span class="op">/</span> (<span class="fu">exp</span>( <span class="op">-</span> ( V <span class="op">-</span> V_T <span class="op">-</span> <span class="fl">15.0</span>  ) <span class="op">/</span> n_Œ±_C) ) <span class="op">-</span> <span class="fl">1.0</span>) <span class="op">*</span> ( <span class="fl">1</span> <span class="op">-</span> n ) <span class="op">-</span> (n_Œ≤_A <span class="op">*</span> <span class="fu">exp</span>( <span class="op">-</span> ( V <span class="op">-</span> V_T <span class="op">-</span> <span class="fl">10.0</span> ) <span class="op">/</span> n_Œ≤_C) ) <span class="op">*</span> n </span>
<span id="cb48-98"><a href="#cb48-98"></a></span>
<span id="cb48-99"><a href="#cb48-99"></a>        @. dp <span class="op">=</span> ( (<span class="fl">1</span>. <span class="op">/</span> ( <span class="fl">1</span> <span class="op">+</span> <span class="fu">exp</span>( <span class="op">-</span> ( V <span class="op">+</span> p_0_B )<span class="op">/</span>p_0_C ) ) ) <span class="op">-</span> p) <span class="op">/</span>  (œÑ_p_max_exp <span class="op">/</span> (œÑ_p_A <span class="op">*</span> <span class="fu">exp</span>( (V <span class="op">+</span> œÑ_p_B)<span class="op">/</span>œÑ_p_C ) <span class="op">+</span> <span class="fu">exp</span>(<span class="op">-</span> ( V <span class="op">+</span> œÑ_p_B )<span class="op">/</span>œÑ_p_C ) ) )</span>
<span id="cb48-100"><a href="#cb48-100"></a></span>
<span id="cb48-101"><a href="#cb48-101"></a>        @. dq <span class="op">=</span> ( ( q_Œ±_A <span class="op">*</span> <span class="fu">exp</span>(<span class="op">-</span> V <span class="op">-</span> q_Œ±_B ) ) <span class="op">/</span>(<span class="fu">exp</span>((<span class="op">-</span> V <span class="op">-</span> q_Œ±_B )<span class="op">/</span>q_Œ±_C ) <span class="op">-</span> <span class="fl">1.0</span>) ) <span class="op">*</span> (<span class="fl">1</span><span class="op">-</span>q) <span class="op">-</span> ( q_Œ≤_A <span class="op">*</span> <span class="fu">exp</span>((<span class="op">-</span> V <span class="op">-</span> q_Œ≤_B ) <span class="op">/</span> q_Œ≤_C) ) <span class="op">*</span> q</span>
<span id="cb48-102"><a href="#cb48-102"></a></span>
<span id="cb48-103"><a href="#cb48-103"></a>        @. dr <span class="op">=</span> ( r_Œ±_A <span class="op">*</span> <span class="fu">exp</span>((<span class="op">-</span> V <span class="op">-</span> r_Œ±_B ) <span class="op">/</span> r_Œ±_C) ) <span class="op">*</span> (<span class="fl">1</span><span class="op">-</span>r) <span class="op">-</span> ( r_Œ≤_A   <span class="op">/</span>(<span class="fu">exp</span>((<span class="op">-</span> V <span class="op">-</span> r_Œ≤_B )<span class="op">/</span>r_Œ≤_C ) <span class="op">+</span> <span class="fl">1.0</span>) ) <span class="op">*</span> r</span>
<span id="cb48-104"><a href="#cb48-104"></a></span>
<span id="cb48-105"><a href="#cb48-105"></a>    <span class="kw">end</span></span>
<span id="cb48-106"><a href="#cb48-106"></a><span class="kw">end</span></span>
<span id="cb48-107"><a href="#cb48-107"></a></span>
<span id="cb48-108"><a href="#cb48-108"></a></span>
<span id="cb48-109"><a href="#cb48-109"></a><span class="kw">function</span> <span class="fu">HH__Na_Kd_M_L_mf_tanh_deterministic_dynamic!</span>(I_series<span class="op">::</span><span class="dt">F</span>) <span class="kw">where</span> {F <span class="op">&lt;:</span><span class="dt">Function</span>}</span>
<span id="cb48-110"><a href="#cb48-110"></a>    <span class="kw">function</span> <span class="fu">parametrized_HH__Na_Kd_M_L_tanh_deterministic_dynamic!</span>(du, u, p, t)</span>
<span id="cb48-111"><a href="#cb48-111"></a></span>
<span id="cb48-112"><a href="#cb48-112"></a>        C,   g_Na, V_Na, g_K,     g_M,   V_K,   g_L, V_Ca, g_l, V_l,</span>
<span id="cb48-113"><a href="#cb48-113"></a>        V_m, Œ∫_m,  œÑ‚ÇÄ_m, œÑ_max_m, V_œÑ_m, œÉ_m, </span>
<span id="cb48-114"><a href="#cb48-114"></a>        V_h, Œ∫_h,  œÑ‚ÇÄ_h, œÑ_max_h, V_œÑ_h, œÉ_h,</span>
<span id="cb48-115"><a href="#cb48-115"></a>        V_n, Œ∫_n,  œÑ‚ÇÄ_n, œÑ_max_n, V_œÑ_n, œÉ_n,</span>
<span id="cb48-116"><a href="#cb48-116"></a>        V_p, Œ∫_p,  œÑ‚ÇÄ_p, œÑ_max_p, V_œÑ_p, œÉ_p,</span>
<span id="cb48-117"><a href="#cb48-117"></a>        V_q, Œ∫_q,  œÑ‚ÇÄ_q, œÑ_max_q, V_œÑ_q, œÉ_q,</span>
<span id="cb48-118"><a href="#cb48-118"></a>        V_r, Œ∫_r,  œÑ‚ÇÄ_r, œÑ_max_r, V_œÑ_r, œÉ_r        <span class="op">=</span> p</span>
<span id="cb48-119"><a href="#cb48-119"></a></span>
<span id="cb48-120"><a href="#cb48-120"></a>        <span class="co"># State variables</span></span>
<span id="cb48-121"><a href="#cb48-121"></a>        V <span class="op">=</span> <span class="pp">@view</span> u[<span class="fl">1</span>]</span>
<span id="cb48-122"><a href="#cb48-122"></a>        m <span class="op">=</span> <span class="pp">@view</span> u[<span class="fl">2</span>]</span>
<span id="cb48-123"><a href="#cb48-123"></a>        h <span class="op">=</span> <span class="pp">@view</span> u[<span class="fl">3</span>] </span>
<span id="cb48-124"><a href="#cb48-124"></a>        n <span class="op">=</span> <span class="pp">@view</span> u[<span class="fl">4</span>] </span>
<span id="cb48-125"><a href="#cb48-125"></a>        p <span class="op">=</span> <span class="pp">@view</span> u[<span class="fl">5</span>]</span>
<span id="cb48-126"><a href="#cb48-126"></a>        q <span class="op">=</span> <span class="pp">@view</span> u[<span class="fl">6</span>]</span>
<span id="cb48-127"><a href="#cb48-127"></a>        r <span class="op">=</span> <span class="pp">@view</span> u[<span class="fl">7</span>]</span>
<span id="cb48-128"><a href="#cb48-128"></a></span>
<span id="cb48-129"><a href="#cb48-129"></a>        <span class="co"># State variables</span></span>
<span id="cb48-130"><a href="#cb48-130"></a>        dV <span class="op">=</span> <span class="pp">@view</span> du[<span class="fl">1</span>]</span>
<span id="cb48-131"><a href="#cb48-131"></a>        dm <span class="op">=</span> <span class="pp">@view</span> du[<span class="fl">2</span>]</span>
<span id="cb48-132"><a href="#cb48-132"></a>        dh <span class="op">=</span> <span class="pp">@view</span> du[<span class="fl">3</span>] </span>
<span id="cb48-133"><a href="#cb48-133"></a>        dn <span class="op">=</span> <span class="pp">@view</span> du[<span class="fl">4</span>] </span>
<span id="cb48-134"><a href="#cb48-134"></a>        dp <span class="op">=</span> <span class="pp">@view</span> du[<span class="fl">5</span>]</span>
<span id="cb48-135"><a href="#cb48-135"></a>        dq <span class="op">=</span> <span class="pp">@view</span> du[<span class="fl">6</span>]</span>
<span id="cb48-136"><a href="#cb48-136"></a>        dr <span class="op">=</span> <span class="pp">@view</span> du[<span class="fl">7</span>]</span>
<span id="cb48-137"><a href="#cb48-137"></a></span>
<span id="cb48-138"><a href="#cb48-138"></a>        dV <span class="op">.=</span> (<span class="op">.-</span><span class="fl">1.0</span> <span class="op">./</span> C ) <span class="op">.*</span> ( g_Na <span class="op">.*</span> (m <span class="op">.^</span> <span class="fl">3</span>) <span class="op">.*</span> h <span class="op">.*</span> ( V <span class="op">.-</span> V_Na ) <span class="op">.+</span> g_K <span class="op">.*</span> (n <span class="op">.^</span> <span class="fl">4</span> ) <span class="op">.*</span> ( V <span class="op">.-</span> V_K ) <span class="op">.+</span> g_M <span class="op">.*</span> p <span class="op">.*</span> (V <span class="op">.-</span> V_K) <span class="op">.+</span> g_L <span class="op">.*</span> (q<span class="op">.^</span><span class="fl">2</span>)<span class="fu">*r*</span>(V <span class="op">.-</span> V_Ca ) <span class="op">.+</span> g_l <span class="op">.*</span> ( V <span class="op">.-</span> V_l ) <span class="op">.-</span> <span class="fu">I_series</span>(t)   ) </span>
<span id="cb48-139"><a href="#cb48-139"></a></span>
<span id="cb48-140"><a href="#cb48-140"></a>        @. dm <span class="op">=</span> ( (<span class="fl">1</span><span class="op">/</span><span class="fl">2</span>) <span class="op">*</span> (<span class="fl">1</span> <span class="op">+</span> <span class="fu">tanh</span>( (V <span class="op">-</span> V_m) <span class="op">/</span> Œ∫_m ) ) <span class="op">-</span> m ) <span class="op">/</span> ( œÑ‚ÇÄ_m <span class="op">+</span> œÑ_max_m <span class="op">*</span> ( <span class="fl">1</span> <span class="op">-</span> <span class="fu">tanh</span>( ( V <span class="op">-</span> V_œÑ_m  ) <span class="op">/</span> œÉ_m ) <span class="op">^</span> <span class="fl">2</span> ) )  </span>
<span id="cb48-141"><a href="#cb48-141"></a></span>
<span id="cb48-142"><a href="#cb48-142"></a>        @. dh <span class="op">=</span> ( (<span class="fl">1</span><span class="op">/</span><span class="fl">2</span>) <span class="op">*</span> (<span class="fl">1</span> <span class="op">+</span> <span class="fu">tanh</span>( (V <span class="op">-</span> V_h) <span class="op">/</span> Œ∫_h ) ) <span class="op">-</span> h ) <span class="op">/</span> ( œÑ‚ÇÄ_h <span class="op">+</span> œÑ_max_h <span class="op">*</span> ( <span class="fl">1</span> <span class="op">-</span> <span class="fu">tanh</span>( ( V <span class="op">-</span> V_œÑ_h  ) <span class="op">/</span> œÉ_h ) <span class="op">^</span> <span class="fl">2</span> ) )</span>
<span id="cb48-143"><a href="#cb48-143"></a></span>
<span id="cb48-144"><a href="#cb48-144"></a>        @. dn <span class="op">=</span> ( (<span class="fl">1</span><span class="op">/</span><span class="fl">2</span>) <span class="op">*</span> (<span class="fl">1</span> <span class="op">+</span> <span class="fu">tanh</span>( (V <span class="op">-</span> V_n) <span class="op">/</span> Œ∫_n ) ) <span class="op">-</span> n ) <span class="op">/</span> ( œÑ‚ÇÄ_n <span class="op">+</span> œÑ_max_n <span class="op">*</span> ( <span class="fl">1</span> <span class="op">-</span> <span class="fu">tanh</span>( ( V <span class="op">-</span> V_œÑ_n  ) <span class="op">/</span> œÉ_n ) <span class="op">^</span> <span class="fl">2</span> ) ) </span>
<span id="cb48-145"><a href="#cb48-145"></a></span>
<span id="cb48-146"><a href="#cb48-146"></a>        @. dp <span class="op">=</span> ( (<span class="fl">1</span><span class="op">/</span><span class="fl">2</span>) <span class="op">*</span> (<span class="fl">1</span> <span class="op">+</span> <span class="fu">tanh</span>( (V <span class="op">-</span> V_p) <span class="op">/</span> Œ∫_p ) ) <span class="op">-</span> p ) <span class="op">/</span> ( œÑ‚ÇÄ_p <span class="op">+</span> œÑ_max_p <span class="op">*</span> ( <span class="fl">1</span> <span class="op">-</span> <span class="fu">tanh</span>( ( V <span class="op">-</span> V_œÑ_p  ) <span class="op">/</span> œÉ_p ) <span class="op">^</span> <span class="fl">2</span> ) ) </span>
<span id="cb48-147"><a href="#cb48-147"></a></span>
<span id="cb48-148"><a href="#cb48-148"></a>        @. dq <span class="op">=</span> ( (<span class="fl">1</span><span class="op">/</span><span class="fl">2</span>) <span class="op">*</span> (<span class="fl">1</span> <span class="op">+</span> <span class="fu">tanh</span>( (V <span class="op">-</span> V_q) <span class="op">/</span> Œ∫_q ) ) <span class="op">-</span> q ) <span class="op">/</span> ( œÑ‚ÇÄ_q <span class="op">+</span> œÑ_max_q <span class="op">*</span> ( <span class="fl">1</span> <span class="op">-</span> <span class="fu">tanh</span>( ( V <span class="op">-</span> V_œÑ_q  ) <span class="op">/</span> œÉ_q ) <span class="op">^</span> <span class="fl">2</span> ) ) </span>
<span id="cb48-149"><a href="#cb48-149"></a></span>
<span id="cb48-150"><a href="#cb48-150"></a>        @. dr <span class="op">=</span> ( (<span class="fl">1</span><span class="op">/</span><span class="fl">2</span>) <span class="op">*</span> (<span class="fl">1</span> <span class="op">+</span> <span class="fu">tanh</span>( (V <span class="op">-</span> V_r) <span class="op">/</span> Œ∫_r ) ) <span class="op">-</span> r ) <span class="op">/</span> ( œÑ‚ÇÄ_r <span class="op">+</span> œÑ_max_r <span class="op">*</span> ( <span class="fl">1</span> <span class="op">-</span> <span class="fu">tanh</span>( ( V <span class="op">-</span> V_œÑ_r  ) <span class="op">/</span> œÉ_r ) <span class="op">^</span> <span class="fl">2</span> ) ) </span>
<span id="cb48-151"><a href="#cb48-151"></a></span>
<span id="cb48-152"><a href="#cb48-152"></a>    <span class="kw">end</span></span>
<span id="cb48-153"><a href="#cb48-153"></a><span class="kw">end</span></span>
<span id="cb48-154"><a href="#cb48-154"></a></span>
<span id="cb48-155"><a href="#cb48-155"></a><span class="kw">const</span> initial_parameters_values_HH__Na_Kd_M_L_mf_dict<span class="op">=</span><span class="fu">OrderedDict</span>( <span class="st">"C"</span>     <span class="op">=&gt;</span> <span class="fl">1.0</span>   , <span class="st">"g_Na"</span>  <span class="op">=&gt;</span> <span class="fl">50.0</span>, <span class="st">"V_Na"</span>  <span class="op">=&gt;</span> <span class="fl">50.0</span>, <span class="st">"g_K"</span> <span class="op">=&gt;</span> <span class="fl">5.0</span>, <span class="st">"g_M "</span><span class="op">=&gt;</span> <span class="fl">0.004</span> , <span class="st">"V_K"</span> <span class="op">=&gt;</span> <span class="op">-</span><span class="fl">90.0</span>, <span class="st">"g_L"</span> <span class="op">=&gt;</span> <span class="fl">0.1</span>, <span class="st">"V_Ca"</span> <span class="op">=&gt;</span> <span class="fl">120.0</span>,  <span class="st">"g_l"</span> <span class="op">=&gt;</span> <span class="fl">0.01</span>, <span class="st">"V_l"</span> <span class="op">=&gt;</span> <span class="op">-</span><span class="fl">70.61</span>,  <span class="st">"V_T"</span> <span class="op">=&gt;</span> <span class="op">-</span><span class="fl">50.0</span> ,</span>
<span id="cb48-156"><a href="#cb48-156"></a></span>
<span id="cb48-157"><a href="#cb48-157"></a>                                                                <span class="st">"m_Œ±_A"</span>       <span class="op">=&gt;</span> <span class="fl">0.32</span>    , <span class="st">"m_Œ±_C"</span> <span class="op">=&gt;</span> <span class="fl">4.0</span> ,                                  <span class="co"># Œ±‚Çò</span></span>
<span id="cb48-158"><a href="#cb48-158"></a>                                                                <span class="st">"m_Œ≤_A"</span>       <span class="op">=&gt;</span> <span class="fl">0.28</span>    , <span class="st">"m_Œ≤_C"</span> <span class="op">=&gt;</span> <span class="fl">5.0</span> ,                                  <span class="co"># Œ≤‚Çò</span></span>
<span id="cb48-159"><a href="#cb48-159"></a>                                                                <span class="st">"h_Œ±_A"</span>       <span class="op">=&gt;</span> <span class="fl">0.128</span>   , <span class="st">"h_Œ±_C"</span> <span class="op">=&gt;</span> <span class="fl">18.0</span>,                                  <span class="co"># Œ±‚Çï</span></span>
<span id="cb48-160"><a href="#cb48-160"></a>                                                                <span class="st">"h_Œ≤_A"</span>       <span class="op">=&gt;</span> <span class="fl">4.0</span>     , <span class="st">"h_Œ≤_C"</span> <span class="op">=&gt;</span> <span class="fl">5.0</span> ,                                  <span class="co"># Œ≤‚Çï</span></span>
<span id="cb48-161"><a href="#cb48-161"></a>                                                                <span class="st">"n_Œ±_A"</span>       <span class="op">=&gt;</span> <span class="fl">0.032</span>   , <span class="st">"n_Œ±_C"</span> <span class="op">=&gt;</span> <span class="fl">5.0</span> ,                                  <span class="co"># Œ±‚Çô</span></span>
<span id="cb48-162"><a href="#cb48-162"></a>                                                                <span class="st">"n_Œ≤_A"</span>       <span class="op">=&gt;</span> <span class="fl">0.5</span>     , <span class="st">"n_Œ≤_C"</span> <span class="op">=&gt;</span> <span class="fl">40.0</span>,                                  <span class="co"># Œ≤‚Çô</span></span>
<span id="cb48-163"><a href="#cb48-163"></a>                                                                <span class="st">"p_0_B"</span>       <span class="op">=&gt;</span> <span class="fl">35.0</span>    , <span class="st">"p_0_C"</span> <span class="op">=&gt;</span> <span class="fl">10.0</span>,                                  <span class="co"># p_x‚ÇÄ</span></span>
<span id="cb48-164"><a href="#cb48-164"></a>                                                                <span class="st">"œÑ_p_max_exp"</span> <span class="op">=&gt;</span> <span class="fl">4000.0</span>  , <span class="st">"œÑ_p_A"</span> <span class="op">=&gt;</span> <span class="fl">3.3</span> , <span class="st">"œÑ_p_B"</span> <span class="op">=&gt;</span> <span class="fl">35.0</span>, <span class="st">"œÑ_p_C"</span><span class="op">=&gt;</span> <span class="fl">20.0</span>,  <span class="co"># p_œÑ</span></span>
<span id="cb48-165"><a href="#cb48-165"></a>                                                                <span class="st">"q_Œ±_A"</span>       <span class="op">=&gt;</span> <span class="fl">0.055</span>   , <span class="st">"q_Œ±_B"</span> <span class="op">=&gt;</span> <span class="fl">27.0</span>, <span class="st">"q_Œ±_C"</span> <span class="op">=&gt;</span> <span class="fl">3.8</span> ,                  <span class="co">#Œ±_q</span></span>
<span id="cb48-166"><a href="#cb48-166"></a>                                                                <span class="st">"q_Œ≤_A"</span>       <span class="op">=&gt;</span> <span class="fl">0.94</span>    , <span class="st">"q_Œ≤_B"</span> <span class="op">=&gt;</span> <span class="fl">75.0</span>, <span class="st">"q_Œ≤_C"</span> <span class="op">=&gt;</span> <span class="fl">17.0</span>,                  <span class="co"># Œ≤_q</span></span>
<span id="cb48-167"><a href="#cb48-167"></a>                                                                <span class="st">"r_Œ±_A"</span>       <span class="op">=&gt;</span> <span class="fl">0.000457</span>, <span class="st">"r_Œ±_B"</span> <span class="op">=&gt;</span> <span class="fl">13.0</span>, <span class="st">"r_Œ±_C"</span> <span class="op">=&gt;</span> <span class="fl">50.0</span>,                  <span class="co"># Œ±_r</span></span>
<span id="cb48-168"><a href="#cb48-168"></a>                                                                <span class="st">"r_Œ≤_A"</span>       <span class="op">=&gt;</span> <span class="fl">0.0065</span>  , <span class="st">"r_Œ≤_B"</span> <span class="op">=&gt;</span> <span class="fl">15.0</span>, <span class="st">"r_Œ≤_C"</span> <span class="op">=&gt;</span> <span class="fl">28.0</span>                   <span class="co"># Œ≤_r</span></span>
<span id="cb48-169"><a href="#cb48-169"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<aside class="notes">
<ul>
<li><p>The exp version is more common in literature and easier to implement;</p></li>
<li><p>The tanh version yields higher numerical performances;</p></li>
<li><p>We also implemented a mechanism that would allow to switch between the two.</p></li>
</ul>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</div>
</section>
<section id="future-developments-macros-1" class="slide level2 smaller">
<h2>Future developments: Macros #1</h2>
<ul>
<li>One of Julia‚Äôs most advanced features is <em>metaprogramming</em>:</li>
</ul>
<div class="sourceCode" id="cb49"><pre class="sourceCode numberSource julia number-lines code-with-copy"><code class="sourceCode julia"><span id="cb49-1"><a href="#cb49-1"></a><span class="cf">for</span> op <span class="op">=</span> (<span class="op">:</span>sin, <span class="op">:</span>cos, <span class="op">:</span>tan, <span class="op">:</span>log, <span class="op">:</span>exp)</span>
<span id="cb49-2"><a href="#cb49-2"></a>    <span class="pp">@eval</span> <span class="bu">Base</span><span class="op">.$</span><span class="fu">op</span>(a<span class="op">::</span><span class="dt">MyNumber</span>) <span class="op">=</span> <span class="fu">MyNumber</span>(<span class="op">$</span><span class="fu">op</span>(a.x))</span>
<span id="cb49-3"><a href="#cb49-3"></a><span class="cf">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="fragment">
<ul>
<li><code>@macro</code>s are special functions that allow code generation at run-time. Here is an example from NeuronalModeling.jl:</li>
</ul>
<div class="sourceCode" id="cb50"><pre class="sourceCode numberSource julia number-lines code-with-copy"><code class="sourceCode julia"><span id="cb50-1"><a href="#cb50-1"></a> loss_expr <span class="op">=</span> <span class="op">:</span>( </span>
<span id="cb50-2"><a href="#cb50-2"></a>            </span>
<span id="cb50-3"><a href="#cb50-3"></a>        <span class="kw">function</span> <span class="fu">borg_moea_loss</span>(theta<span class="op">::</span><span class="dt">Vector{Float64}</span>)<span class="op">::</span><span class="dt">NTuple{$num_features,Float64}</span></span>
<span id="cb50-4"><a href="#cb50-4"></a></span>
<span id="cb50-5"><a href="#cb50-5"></a>            losses_values_by_feature_dict <span class="op">=</span> <span class="fu">hh_neuron_loss_intermediate</span>(<span class="op">$</span>hh_model, theta, <span class="op">$</span>fixed_parameters_indexes, <span class="op">$</span>variable_parameters_indexes, <span class="fu">deepcopy</span>(<span class="op">$</span>fixed_parameters_values), <span class="op">$</span>save_idxs, <span class="op">$</span>filter, <span class="op">$</span>resting_potentials_values_by_type_amplitude, <span class="op">$</span>features_targets_lossKwargs_by_type_amplitude, <span class="op">$</span>opt_trim_associations, <span class="op">$</span>fast_problems_by_type_amplitude_dict, <span class="op">$</span>time_steps_by_type_amplitude_dict, <span class="op">$</span>tstops_by_type_amplitude_dict, <span class="op">$</span>features_counts_dict, <span class="op">$</span>electrophysiology_backend, <span class="op">$</span>aggregation_strategy_of_same_feature_across_different_type_amplitudes)</span>
<span id="cb50-6"><a href="#cb50-6"></a></span>
<span id="cb50-7"><a href="#cb50-7"></a>            <span class="cf">return</span> <span class="fu">NTuple</span><span class="dt">{$num_features,Float64}</span>([loss_val <span class="op">&lt;=</span> <span class="fl">1000.0</span> ? loss_val <span class="op">:</span> <span class="fl">1000.0</span> for loss_val <span class="kw">in</span> <span class="fu">values</span>(losses_values_by_feature_dict)]) <span class="co"># length(losses_values_by_feature_dict)</span></span>
<span id="cb50-8"><a href="#cb50-8"></a>        <span class="kw">end</span></span>
<span id="cb50-9"><a href="#cb50-9"></a>    )</span>
<span id="cb50-10"><a href="#cb50-10"></a></span>
<span id="cb50-11"><a href="#cb50-11"></a>    <span class="kw">end</span></span>
<span id="cb50-12"><a href="#cb50-12"></a></span>
<span id="cb50-13"><a href="#cb50-13"></a></span>
<span id="cb50-14"><a href="#cb50-14"></a>    <span class="cf">return</span> <span class="pp">@RuntimeGeneratedFunction</span>(loss_expr)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="future-developments-macros-2" class="slide level2 smaller">
<h2>Future developments: Macros #2</h2>
<ul>
<li>From the code of the AdEx and the HH models, it should be evident that they are quite hard and error prone to code by hand;</li>
</ul>
<div class="fragment">
<ul>
<li>Due to standard patterns occurring during the definition of both AdNLIF and HH models, we may implement macros to greatly ease their instantiation;</li>
</ul>
</div>
<div class="fragment">
<ul>
<li>They would look something like:</li>
</ul>
<div class="sourceCode" id="cb51"><pre class="sourceCode numberSource julia number-lines code-with-copy"><code class="sourceCode julia"><span id="cb51-1"><a href="#cb51-1"></a><span class="co"># AdNLIF</span></span>
<span id="cb51-2"><a href="#cb51-2"></a><span class="pp">@AdNLIF</span> [nonlinearity] [n¬∞ auxiliary variables]</span>
<span id="cb51-3"><a href="#cb51-3"></a></span>
<span id="cb51-4"><a href="#cb51-4"></a><span class="co"># HH</span></span>
<span id="cb51-5"><a href="#cb51-5"></a></span>
<span id="cb51-6"><a href="#cb51-6"></a><span class="pp">@HH</span> [currents]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="fragment">
<ul>
<li>Should be easy for <code>@AdNLIF</code>;</li>
</ul>
</div>
</section>
<section id="future-developments-macros-3" class="slide level2 smaller">
<h2>Future developments: Macros #3</h2>
<ul>
<li>For <code>@HH</code>, we may adopt packages like <a href="https://github.com/wsphillips/Conductor.jl"><code>Conductor.jl</code></a>, or make us of our already-existing implementation of <code>Current</code>s:</li>
</ul>
<div class="sourceCode" id="cb52"><pre class="sourceCode numberSource julia number-lines code-with-copy"><code class="sourceCode julia"><span id="cb52-1"><a href="#cb52-1"></a><span class="kw">mutable struct</span> Gating_Variable_Boltzmann_Term{F<span class="op">&lt;:</span><span class="dt">Function</span>}</span>
<span id="cb52-2"><a href="#cb52-2"></a>    names<span class="op">::</span><span class="dt">Vector{String}</span></span>
<span id="cb52-3"><a href="#cb52-3"></a>    evaluation<span class="op">::</span><span class="dt">F</span></span>
<span id="cb52-4"><a href="#cb52-4"></a><span class="kw">end</span></span>
<span id="cb52-5"><a href="#cb52-5"></a></span>
<span id="cb52-6"><a href="#cb52-6"></a><span class="co"># struct that represents a gating variable rate</span></span>
<span id="cb52-7"><a href="#cb52-7"></a><span class="kw">mutable struct</span> Gating_Variable_Rate{F<span class="op">&lt;:</span><span class="dt">Function</span>}</span>
<span id="cb52-8"><a href="#cb52-8"></a>    names<span class="op">::</span><span class="dt">Vector{String}</span></span>
<span id="cb52-9"><a href="#cb52-9"></a>    evaluation<span class="op">::</span><span class="dt">F</span></span>
<span id="cb52-10"><a href="#cb52-10"></a><span class="kw">end</span></span>
<span id="cb52-11"><a href="#cb52-11"></a></span>
<span id="cb52-12"><a href="#cb52-12"></a><span class="co"># struct that represents a gating variable</span></span>
<span id="cb52-13"><a href="#cb52-13"></a><span class="co"># https://github.com/mauro3/Parameters.jl and https://discourse.julialang.org/t/keyword-argument-constructor-breaks-incomplete-constructor/34198</span></span>
<span id="cb52-14"><a href="#cb52-14"></a><span class="pp">@with_kw</span> <span class="kw">mutable struct</span> Gating_Variable</span>
<span id="cb52-15"><a href="#cb52-15"></a>    name<span class="op">::</span><span class="dt">String</span></span>
<span id="cb52-16"><a href="#cb52-16"></a>    x‚ÇÄ<span class="op">::</span><span class="dt">Gating_Variable_Boltzmann_Term</span></span>
<span id="cb52-17"><a href="#cb52-17"></a>    œÑ<span class="op">::</span><span class="dt">Gating_Variable_Boltzmann_Term</span></span>
<span id="cb52-18"><a href="#cb52-18"></a><span class="kw">end</span></span>
<span id="cb52-19"><a href="#cb52-19"></a></span>
<span id="cb52-20"><a href="#cb52-20"></a><span class="co">#keyword constructor using rates</span></span>
<span id="cb52-21"><a href="#cb52-21"></a><span class="kw">function</span> <span class="fu">Gating_Variable</span>(name<span class="op">::</span><span class="dt">String</span>; Œ±<span class="op">::</span><span class="dt">Gating_Variable_Rate</span>, Œ≤<span class="op">::</span><span class="dt">Gating_Variable_Rate</span>)</span>
<span id="cb52-22"><a href="#cb52-22"></a>    names<span class="op">::</span><span class="dt">Vector{String} </span><span class="op">=</span> <span class="fu">vcat</span>(Œ±.names, Œ≤.names)</span>
<span id="cb52-23"><a href="#cb52-23"></a>    x‚ÇÄ_evaluation <span class="op">=</span> <span class="kw">function</span> (V<span class="op">::</span><span class="dt">Float64</span>, p<span class="op">::</span><span class="dt">Vector{Float64}</span>)</span>
<span id="cb52-24"><a href="#cb52-24"></a>        <span class="cf">return</span> Œ±.<span class="fu">evaluation</span>(V, p[<span class="fl">1</span><span class="op">:</span><span class="fu">length</span>(Œ±.names)]) <span class="op">/</span> (Œ±.<span class="fu">evaluation</span>(V, p[<span class="fl">1</span><span class="op">:</span><span class="fu">length</span>(Œ±.names)]) <span class="op">+</span> Œ≤.<span class="fu">evaluation</span>(V, p[<span class="fu">length</span>(Œ±.names)<span class="op">+</span><span class="fl">1</span><span class="op">:</span><span class="kw">end</span>]))</span>
<span id="cb52-25"><a href="#cb52-25"></a>    <span class="kw">end</span></span>
<span id="cb52-26"><a href="#cb52-26"></a>    x‚ÇÄ<span class="op">::</span><span class="dt">Gating_Variable_Boltzmann_Term </span><span class="op">=</span> <span class="fu">Gating_Variable_Boltzmann_Term</span>(names, x‚ÇÄ_evaluation)</span>
<span id="cb52-27"><a href="#cb52-27"></a>    œÑ_evaluation <span class="op">=</span> <span class="kw">function</span> (V<span class="op">::</span><span class="dt">Float64</span>, p<span class="op">::</span><span class="dt">Vector{Float64}</span>)</span>
<span id="cb52-28"><a href="#cb52-28"></a>        <span class="cf">return</span> <span class="fl">1</span> <span class="op">/</span> (Œ±.<span class="fu">evaluation</span>(V, p[<span class="fl">1</span><span class="op">:</span><span class="fu">length</span>(Œ±.names)]) <span class="op">+</span> Œ≤.<span class="fu">evaluation</span>(V, p[<span class="fu">length</span>(Œ±.names)<span class="op">+</span><span class="fl">1</span><span class="op">:</span><span class="kw">end</span>]))</span>
<span id="cb52-29"><a href="#cb52-29"></a>    <span class="kw">end</span></span>
<span id="cb52-30"><a href="#cb52-30"></a>    œÑ<span class="op">::</span><span class="dt">Gating_Variable_Boltzmann_Term </span><span class="op">=</span> <span class="fu">Gating_Variable_Boltzmann_Term</span>(names, œÑ_evaluation)</span>
<span id="cb52-31"><a href="#cb52-31"></a>    <span class="cf">return</span> <span class="fu">Gating_Variable</span>(name<span class="op">=</span>name, x‚ÇÄ<span class="op">=</span>x‚ÇÄ, œÑ<span class="op">=</span>œÑ)</span>
<span id="cb52-32"><a href="#cb52-32"></a></span>
<span id="cb52-33"><a href="#cb52-33"></a><span class="kw">end</span></span>
<span id="cb52-34"><a href="#cb52-34"></a></span>
<span id="cb52-35"><a href="#cb52-35"></a><span class="co"># struct that represents a current</span></span>
<span id="cb52-36"><a href="#cb52-36"></a><span class="co"># https://docs.julialang.org/en/v1/manual/faq/#faq-nothing</span></span>
<span id="cb52-37"><a href="#cb52-37"></a><span class="kw">mutable struct</span> Current</span>
<span id="cb52-38"><a href="#cb52-38"></a>    activating<span class="op">::</span><span class="dt">Union{Gating_Variable,Nothing}</span></span>
<span id="cb52-39"><a href="#cb52-39"></a>    deactivating<span class="op">::</span><span class="dt">Union{Gating_Variable,Nothing}</span></span>
<span id="cb52-40"><a href="#cb52-40"></a>    gating_variables_names<span class="op">::</span><span class="dt">Vector{String}</span></span>
<span id="cb52-41"><a href="#cb52-41"></a>    activating_exponent<span class="op">::</span><span class="dt">Float64</span></span>
<span id="cb52-42"><a href="#cb52-42"></a>    deactivating_exponent<span class="op">::</span><span class="dt">Float64</span></span>
<span id="cb52-43"><a href="#cb52-43"></a>    all_parameter_names<span class="op">::</span><span class="dt">Union{Vector{String},Nothing}</span></span>
<span id="cb52-44"><a href="#cb52-44"></a>    gating_variables_indexes<span class="op">::</span><span class="dt">Dict{String,Dict{String,Vector{Int64}}}</span></span>
<span id="cb52-45"><a href="#cb52-45"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="future-developments-other-improvements" class="slide level2">
<h2>Future developments: Other improvements</h2>
<ul>
<li><a href="https://github.com/InPhyT/NeuronalModeling.jl/issues/33">Initial condition calibration</a> <span class="math inline">\(\rightarrow\)</span> attempt 2009 challenge!</li>
</ul>
<div class="fragment">
<ul>
<li><a href="https://github.com/InPhyT/NeuronalModeling.jl/issues/36">Switch from AllenSDK to IPFX</a>;</li>
</ul>
</div>
<div class="fragment">
<ul>
<li>Statistical calibration, Kalman Filters, Simulation Based Inference (see <a href="https://github.com/InPhyT/NeuronalModeling.jl/issues/38">#38</a>, <a href="https://github.com/InPhyT/NeuronalModeling.jl/issues/35">#35</a> and <a href="https://github.com/InPhyT/NeuronalModeling.jl/issues/34">#34</a>);</li>
</ul>
</div>
<div class="fragment">
<ul>
<li><a href="https://github.com/InPhyT/NeuronalModeling.jl/issues/29">Automate handling of units of measure with <code>Unitful.jl</code></a>;</li>
</ul>
</div>
<div class="fragment">
<ul>
<li><em>Etc.</em></li>
</ul>
</div>
</section></section>
<section>
<section id="related-packages" class="title-slide slide level1 center">
<h1><span class="emoji" data-emoji="package">üì¶</span> Related Packages</h1>

</section>
<section id="related-packages-1" class="slide level2">
<h2>Related Packages</h2>
<div class="columns">
<div class="column" style="width:50%;">
<h3 id="julia">Julia</h3>
<ul>
<li><a href="https://github.com/robertfeldt/BlackBoxOptim.jl"><strong>BlackBoxOptim</strong></a></li>
<li><a href="https://github.com/SciML/DifferentialEquations.jl"><strong>DifferentialEquations</strong></a></li>
<li><a href="https://github.com/wildart/Evolutionary.jl"><strong>Evolutionary</strong></a></li>
<li><a href="https://github.com/jmejia8/Metaheuristics.jl"><strong>Metaheuristics</strong></a></li>
<li><a href="https://github.com/SciML/ModelingToolkit.jl"><strong>ModelingToolkit</strong></a></li>
<li><a href="https://github.com/JuliaNLSolvers/Optim.jl"><strong>Optim</strong></a></li>
<li><a href="https://github.com/TuringLang/Turing.jl">Turing</a></li>
<li><a href="https://github.com/wsphillips/Conductor.jl">Conductor</a></li>
</ul>
<p><img data-src="images/logo/JuliaDots.svg" class="absolute" style="top: 83px; left: 130px; width: 5%; "></p>
</div><div class="column" style="width:50%;">
<h3 id="python">Python</h3>
<ul>
<li><a href="https://github.com/AllenInstitute/AllenSDK"><strong>AllenSDK</strong></a></li>
<li><a href="https://github.com/BlueBrain/BluePyEfe">BluePyEfe</a></li>
<li><a href="https://github.com/BlueBrain/BluePyOpt">BluePyOpt</a></li>
<li><a href="https://github.com/BlueBrain/eFEL"><strong>eFEL</strong></a></li>
<li><a href="https://github.com/neuronsimulator/nrn">NEURON</a></li>
<li><a href="https://github.com/KaliLab/optimizer">Optimizer</a></li>
<li><a href="https://nest-simulator.readthedocs.io/en/stable/tutorials/index.html">PyNEST</a></li>
</ul>
<p><img data-src="images/logo/Python.png" class="absolute" style="top: 83px; right: 260px; width: 5%; "></p>
</div>
</div>
</section></section>
<section>
<section id="references" class="title-slide slide level1 center">
<h1><span class="emoji" data-emoji="books">üìö</span> References</h1>

</section>
<section id="references-1" class="slide level2 smaller">
<h2>References</h2>
<div class="columns">
<div class="column" style="width:35%;">
<h3 id="present">Present</h3>
<ul>
<li><a href="https://doi.org/10.1152/jn.00686.2005">Brette and Gerstner (2005)</a></li>
<li><a href="https://doi.org/10.1007/s00422-008-0263-8">Pospischil et al.&nbsp;(2008)</a></li>
<li><a href="https://doi.org/10.3389/neuro.01.1.1.001.2007">Druckmann et al.&nbsp;(2007)</a></li>
<li><a href="https://doi.org/10.1007/s00422-008-0269-2">Druckmann et al.&nbsp;(2008)</a></li>
<li><a href="https://doi.org/10.1007/s00422-008-0261-x">Jolivet et al.&nbsp;(2008)</a></li>
<li><a href="https://doi.org/10.1126/science.1181936">Gerstner and Naud (2009)</a></li>
<li><a href="https://doi.org/10.1371/journal.pcbi.1002133">Druckmann et al.&nbsp;(2011)</a></li>
<li><a href="https://doi.org/10.1007/s00422-011-0459-1">Toth et al.&nbsp;(2011)</a></li>
<li><a href="https://infoscience.epfl.ch/record/168813?ln=en">Naud et al.&nbsp;(2012)</a></li>
<li><a href="https://doi.org/10.1007/978-1-4614-8094-5_28">Druckmann (2013)</a></li>
<li><a href="https://doi.org/10.1017/cbo9781107447615">Gerstner et al.&nbsp;(2014)</a></li>
</ul>
</div><div class="column" style="width:35%;">
<h3 id="future">Future</h3>
<ul>
<li><a href="https://doi.org/10.1007/s00422-008-0257-6">Van Geit et al.&nbsp;(2008)</a></li>
<li><a href="https://doi.org/10.3389/neuro.10.009.2009">Kobayashi et al.&nbsp;(2009)</a></li>
<li><a href="https://doi.org/10.1186/1471-2202-10-s1-p260">Smolinski et al.&nbsp;(2009)</a></li>
<li><a href="https://doi.org/10.1162/neco_a_00208">Naud et al.&nbsp;(2011)</a></li>
<li><a href="https://doi.org/10.1007/s12021-012-9140-7">Svensson et al.&nbsp;(2012)</a></li>
<li><a href="https://doi.org/10.3389/fninf.2014.00063">Friedrich et al.&nbsp;(2014)</a></li>
<li><a href="https://doi.org/10.1007/978-1-4614-7320-6_159-1">Druckmann (2014)</a></li>
<li><a href="https://doi.org/10.1007/s00422-014-0615-5">Meliza et al.&nbsp;(2014)</a></li>
<li><a href="https://doi.org/10.3389/fninf.2015.00010">Lynch and Houghton (2015)</a></li>
<li><a href="https://doi.org/10.3389/fninf.2016.00017">Van Geit et al.&nbsp;(2016)</a></li>
<li><a href="https://doi.org/10.3389/fncel.2017.00071">Masoli et al.&nbsp;(2017)</a></li>
</ul>
</div><div class="column" style="width:30%;">
<h3 id="future-1">Future</h3>
<ul>
<li><a href="https://doi.org/10.7554/elife.56261">Gon√ßalves et al.&nbsp;(2020)</a></li>
<li><a href="https://doi.org/10.1109/ijcnn48605.2020.9206692">Mohacsi et al.&nbsp;(2020)</a></li>
<li><a href="https://doi.org/10.1371/journal.pcbi.1008114">Saray et al.&nbsp;(2021)</a></li>
<li><a href="https://doi.org/10.1038/s43588-021-00030-1">Gala et al.&nbsp;(2021)</a></li>
<li><a href="https://doi.org/10.3389/fninf.2022.771730">AbdelAty et al.&nbsp;(2022)</a></li>
<li><a href="https://doi.org/10.1007/978-1-0716-1006-0_409">Kreuz et al.&nbsp;(2022)</a></li>
<li><a href="https://doi.org/10.1016/j.celrep.2022.111176">Nandi et al.&nbsp;(2022)</a></li>
</ul>
</div>
</div>
<aside class="notes">
<p>‚Ä¶</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section></section>
<section>
<section id="thanks" class="title-slide slide level1 center">
<h1>Thanks <span class="emoji" data-emoji="pray">üôè</span></h1>

</section>
<section id="section-1" class="slide level2 smaller">
<h2></h2>
<h3 id="outline-1">Outline</h3>
<p><span class="emoji" data-emoji="one">1Ô∏è‚É£</span> <a href="#/Objectives">Objectives</a></p>
<p><span class="emoji" data-emoji="two">2Ô∏è‚É£</span> <a href="#/Motivations">Motivations</a></p>
<p><span class="emoji" data-emoji="three">3Ô∏è‚É£</span> <a href="#/Methods">Methods</a></p>
<p><span class="emoji" data-emoji="four">4Ô∏è‚É£</span> <a href="#/Tools">Tools</a></p>
<p><span class="emoji" data-emoji="five">5Ô∏è‚É£</span> <a href="#/Results">Results</a></p>
<h3 id="resources-1">Resources</h3>
<p><img data-src="images/logo/JuliaDots.svg" class="absolute" style="left: 0px; bottom: 252px; width: 3.2%; "> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Package: <a href="https://github.com/InPhyT/ModellingFramework.jl">ModellingFramework.jl</a></p>
<p><img data-src="images/logo/JuliaDots.svg" class="absolute" style="left: 0px; bottom: 205px; width: 3.2%; "> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Package: <a href="https://github.com/InPhyT/NeuronalModelling.jl">NeuronalModelling.jl</a></p>
<p><img data-src="images/logo/GitHub.svg" class="absolute" style="left: 0px; bottom: 155px; width: 3.2%; "> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Data: <a href="https://github.com/InPhyT/Quantitative_Single_Neuron_Modeling_Competition_2007">Competition (2007)</a></p>
<p><img data-src="images/logo/GitHub.svg" class="absolute" style="left: 0px; bottom: 107px; width: 3.2%; "> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Data: <a href="https://github.com/InPhyT/Quantitative_Single_Neuron_Modeling_Competition_2009">Competition (2009)</a></p>
<p><img data-src="images/logo/GitHub.svg" class="absolute" style="left: 0px; bottom: 59px; width: 3.2%; "> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Data: <a href="https://github.com/AllenInstitute/AllenSDK">Allen Brain Atlas (2023)</a></p>
<p><img data-src="images/logo/NeuronalModelling.svg" class="absolute" style="bottom: 120px; right: 0px; width: 45%; "></p>
<aside class="notes">
<p>‚Ä¶</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
<p><img src="images/logo/unito.svg" class="slide-logo"></p>
<div class="footer footer-default">
<p><a href="https://github.com/InPhyT/NeuronalModelling.jl">NeuronalModelling.jl: Quantitative Single-Neuron Modelling in Julia</a></p>
</div>
</section></section>

    </div>
  </div>

  <script>window.backupDefine = window.define; window.define = undefined;</script>
  <script src="index_files/libs/revealjs/dist/reveal.js"></script>
  <!-- reveal.js plugins -->
  <script src="index_files/libs/revealjs/plugin/quarto-line-highlight/line-highlight.js"></script>
  <script src="index_files/libs/revealjs/plugin/pdf-export/pdfexport.js"></script>
  <script src="index_files/libs/revealjs/plugin/reveal-menu/menu.js"></script>
  <script src="index_files/libs/revealjs/plugin/reveal-menu/quarto-menu.js"></script>
  <script src="index_files/libs/revealjs/plugin/reveal-chalkboard/plugin.js"></script>
  <script src="index_files/libs/revealjs/plugin/quarto-support/support.js"></script>
  

  <script src="index_files/libs/revealjs/plugin/notes/notes.js"></script>
  <script src="index_files/libs/revealjs/plugin/search/search.js"></script>
  <script src="index_files/libs/revealjs/plugin/zoom/zoom.js"></script>
  <script src="index_files/libs/revealjs/plugin/math/math.js"></script>
  <script>window.define = window.backupDefine; window.backupDefine = undefined;</script>

  <script>

      // Full list of configuration options available at:
      // https://revealjs.com/config/
      Reveal.initialize({
'controlsAuto': true,
'previewLinksAuto': true,
'smaller': false,
'pdfSeparateFragments': false,
'autoAnimateEasing': "ease",
'autoAnimateDuration': 1,
'autoAnimateUnmatched': true,
'menu': {"side":"left","useTextContentForMissingTitles":true,"markers":false,"loadIcons":false,"custom":[{"title":"Tools","icon":"<i class=\"fas fa-gear\"></i>","content":"<ul class=\"slide-menu-items\">\n<li class=\"slide-tool-item active\" data-item=\"0\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.fullscreen(event)\"><kbd>f</kbd> Fullscreen</a></li>\n<li class=\"slide-tool-item\" data-item=\"1\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.speakerMode(event)\"><kbd>s</kbd> Speaker View</a></li>\n<li class=\"slide-tool-item\" data-item=\"2\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.overview(event)\"><kbd>o</kbd> Slide Overview</a></li>\n<li class=\"slide-tool-item\" data-item=\"3\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.togglePdfExport(event)\"><kbd>e</kbd> PDF Export Mode</a></li>\n<li class=\"slide-tool-item\" data-item=\"4\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.toggleChalkboard(event)\"><kbd>b</kbd> Toggle Chalkboard</a></li>\n<li class=\"slide-tool-item\" data-item=\"5\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.toggleNotesCanvas(event)\"><kbd>c</kbd> Toggle Notes Canvas</a></li>\n<li class=\"slide-tool-item\" data-item=\"6\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.downloadDrawings(event)\"><kbd>d</kbd> Download Drawings</a></li>\n<li class=\"slide-tool-item\" data-item=\"7\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.keyboardHelp(event)\"><kbd>?</kbd> Keyboard Help</a></li>\n</ul>"}],"openButton":true},
'chalkboard': {"buttons":false},
'smaller': false,
 
        // Display controls in the bottom right corner
        controls: false,

        // Help the user learn the controls by providing hints, for example by
        // bouncing the down arrow when they first encounter a vertical slide
        controlsTutorial: false,

        // Determines where controls appear, "edges" or "bottom-right"
        controlsLayout: 'edges',

        // Visibility rule for backwards navigation arrows; "faded", "hidden"
        // or "visible"
        controlsBackArrows: 'faded',

        // Display a presentation progress bar
        progress: true,

        // Display the page number of the current slide
        slideNumber: 'c/t',

        // 'all', 'print', or 'speaker'
        showSlideNumber: 'all',

        // Add the current slide number to the URL hash so that reloading the
        // page/copying the URL will return you to the same slide
        hash: true,

        // Start with 1 for the hash rather than 0
        hashOneBasedIndex: false,

        // Flags if we should monitor the hash and change slides accordingly
        respondToHashChanges: true,

        // Push each slide change to the browser history
        history: true,

        // Enable keyboard shortcuts for navigation
        keyboard: true,

        // Enable the slide overview mode
        overview: true,

        // Disables the default reveal.js slide layout (scaling and centering)
        // so that you can use custom CSS layout
        disableLayout: false,

        // Vertical centering of slides
        center: false,

        // Enables touch navigation on devices with touch input
        touch: true,

        // Loop the presentation
        loop: false,

        // Change the presentation direction to be RTL
        rtl: false,

        // see https://revealjs.com/vertical-slides/#navigation-mode
        navigationMode: 'linear',

        // Randomizes the order of slides each time the presentation loads
        shuffle: false,

        // Turns fragments on and off globally
        fragments: true,

        // Flags whether to include the current fragment in the URL,
        // so that reloading brings you to the same fragment position
        fragmentInURL: false,

        // Flags if the presentation is running in an embedded mode,
        // i.e. contained within a limited portion of the screen
        embedded: false,

        // Flags if we should show a help overlay when the questionmark
        // key is pressed
        help: true,

        // Flags if it should be possible to pause the presentation (blackout)
        pause: true,

        // Flags if speaker notes should be visible to all viewers
        showNotes: false,

        // Global override for autoplaying embedded media (null/true/false)
        autoPlayMedia: null,

        // Global override for preloading lazy-loaded iframes (null/true/false)
        preloadIframes: null,

        // Number of milliseconds between automatically proceeding to the
        // next slide, disabled when set to 0, this value can be overwritten
        // by using a data-autoslide attribute on your slides
        autoSlide: 0,

        // Stop auto-sliding after user input
        autoSlideStoppable: true,

        // Use this method for navigation when auto-sliding
        autoSlideMethod: null,

        // Specify the average time in seconds that you think you will spend
        // presenting each slide. This is used to show a pacing timer in the
        // speaker view
        defaultTiming: null,

        // Enable slide navigation via mouse wheel
        mouseWheel: false,

        // The display mode that will be used to show slides
        display: 'block',

        // Hide cursor if inactive
        hideInactiveCursor: true,

        // Time before the cursor is hidden (in ms)
        hideCursorTime: 5000,

        // Opens links in an iframe preview overlay
        previewLinks: false,

        // Transition style (none/fade/slide/convex/concave/zoom)
        transition: 'none',

        // Transition speed (default/fast/slow)
        transitionSpeed: 'default',

        // Transition style for full page slide backgrounds
        // (none/fade/slide/convex/concave/zoom)
        backgroundTransition: 'none',

        // Number of slides away from the current that are visible
        viewDistance: 3,

        // Number of slides away from the current that are visible on mobile
        // devices. It is advisable to set this to a lower number than
        // viewDistance in order to save resources.
        mobileViewDistance: 2,

        // The "normal" size of the presentation, aspect ratio will be preserved
        // when the presentation is scaled to fit different resolutions. Can be
        // specified using percentage units.
        width: 1050,

        height: 700,

        // Factor of the display size that should remain empty around the content
        margin: 0.1,

        math: {
          mathjax: 'https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js',
          config: 'TeX-AMS_HTML-full',
          tex2jax: {
            inlineMath: [['\\(','\\)']],
            displayMath: [['\\[','\\]']],
            balanceBraces: true,
            processEscapes: false,
            processRefs: true,
            processEnvironments: true,
            preview: 'TeX',
            skipTags: ['script','noscript','style','textarea','pre','code'],
            ignoreClass: 'tex2jax_ignore',
            processClass: 'tex2jax_process'
          },
        },

        // reveal.js plugins
        plugins: [QuartoLineHighlight, PdfExport, RevealMenu, RevealChalkboard, QuartoSupport,

          RevealMath,
          RevealNotes,
          RevealSearch,
          RevealZoom
        ]
      });
    </script>
    <script id="quarto-html-after-body" type="application/javascript">
    window.document.addEventListener("DOMContentLoaded", function (event) {
      const toggleBodyColorMode = (bsSheetEl) => {
        const mode = bsSheetEl.getAttribute("data-mode");
        const bodyEl = window.document.querySelector("body");
        if (mode === "dark") {
          bodyEl.classList.add("quarto-dark");
          bodyEl.classList.remove("quarto-light");
        } else {
          bodyEl.classList.add("quarto-light");
          bodyEl.classList.remove("quarto-dark");
        }
      }
      const toggleBodyColorPrimary = () => {
        const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
        if (bsSheetEl) {
          toggleBodyColorMode(bsSheetEl);
        }
      }
      toggleBodyColorPrimary();  
      const tabsets =  window.document.querySelectorAll(".panel-tabset-tabby")
      tabsets.forEach(function(tabset) {
        const tabby = new Tabby('#' + tabset.id);
      });
      const isCodeAnnotation = (el) => {
        for (const clz of el.classList) {
          if (clz.startsWith('code-annotation-')) {                     
            return true;
          }
        }
        return false;
      }
      const clipboard = new window.ClipboardJS('.code-copy-button', {
        text: function(trigger) {
          const codeEl = trigger.previousElementSibling.cloneNode(true);
          for (const childEl of codeEl.children) {
            if (isCodeAnnotation(childEl)) {
              childEl.remove();
            }
          }
          return codeEl.innerText;
        }
      });
      clipboard.on('success', function(e) {
        // button target
        const button = e.trigger;
        // don't keep focus
        button.blur();
        // flash "checked"
        button.classList.add('code-copy-button-checked');
        var currentTitle = button.getAttribute("title");
        button.setAttribute("title", "Copied!");
        let tooltip;
        if (window.bootstrap) {
          button.setAttribute("data-bs-toggle", "tooltip");
          button.setAttribute("data-bs-placement", "left");
          button.setAttribute("data-bs-title", "Copied!");
          tooltip = new bootstrap.Tooltip(button, 
            { trigger: "manual", 
              customClass: "code-copy-button-tooltip",
              offset: [0, -8]});
          tooltip.show();    
        }
        setTimeout(function() {
          if (tooltip) {
            tooltip.hide();
            button.removeAttribute("data-bs-title");
            button.removeAttribute("data-bs-toggle");
            button.removeAttribute("data-bs-placement");
          }
          button.setAttribute("title", currentTitle);
          button.classList.remove('code-copy-button-checked');
        }, 1000);
        // clear code selection
        e.clearSelection();
      });
      function tippyHover(el, contentFn) {
        const config = {
          allowHTML: true,
          content: contentFn,
          maxWidth: 500,
          delay: 100,
          arrow: false,
          appendTo: function(el) {
              return el.closest('section.slide') || el.parentElement;
          },
          interactive: true,
          interactiveBorder: 10,
          theme: 'light-border',
          placement: 'bottom-start'
        };
          config['offset'] = [0,0];
          config['maxWidth'] = 700;
        window.tippy(el, config); 
      }
      const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
      for (var i=0; i<noterefs.length; i++) {
        const ref = noterefs[i];
        tippyHover(ref, function() {
          // use id or data attribute instead here
          let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
          try { href = new URL(href).hash; } catch {}
          const id = href.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          return note.innerHTML;
        });
      }
      const findCites = (el) => {
        const parentEl = el.parentElement;
        if (parentEl) {
          const cites = parentEl.dataset.cites;
          if (cites) {
            return {
              el,
              cites: cites.split(' ')
            };
          } else {
            return findCites(el.parentElement)
          }
        } else {
          return undefined;
        }
      };
      var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
      for (var i=0; i<bibliorefs.length; i++) {
        const ref = bibliorefs[i];
        const citeInfo = findCites(ref);
        if (citeInfo) {
          tippyHover(citeInfo.el, function() {
            var popup = window.document.createElement('div');
            citeInfo.cites.forEach(function(cite) {
              var citeDiv = window.document.createElement('div');
              citeDiv.classList.add('hanging-indent');
              citeDiv.classList.add('csl-entry');
              var biblioDiv = window.document.getElementById('ref-' + cite);
              if (biblioDiv) {
                citeDiv.innerHTML = biblioDiv.innerHTML;
              }
              popup.appendChild(citeDiv);
            });
            return popup.innerHTML;
          });
        }
      }
    });
    </script>
    

</body></html>